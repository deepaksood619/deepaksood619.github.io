<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-databases/data-warehouses/databricks/03-optimizations" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Optimizations | Deep Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://deepaksood619.github.io/img/timeline_compressed.webp"><meta data-rh="true" name="twitter:image" content="https://deepaksood619.github.io/img/timeline_compressed.webp"><meta data-rh="true" property="og:url" content="https://deepaksood619.github.io/databases/data-warehouses/databricks/03-optimizations"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Optimizations | Deep Notes"><meta data-rh="true" name="description" content="Delta Lake Files - S3 Effect"><meta data-rh="true" property="og:description" content="Delta Lake Files - S3 Effect"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://deepaksood619.github.io/databases/data-warehouses/databricks/03-optimizations"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/databases/data-warehouses/databricks/03-optimizations" hreflang="en"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/databases/data-warehouses/databricks/03-optimizations" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X3OY8NGHVH-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZSZMJXWSH3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZSZMJXWSH3",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-TN3KBF4",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>


<link rel="search" type="application/opensearchdescription+xml" title="Deep Notes" href="/opensearch.xml">
<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(53, 120, 229)">

<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5616865131274062" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.34fe0275.css">
<script src="/assets/js/runtime~main.79740ea6.js" defer="defer"></script>
<script src="/assets/js/main.68dc7d0c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TN3KBF4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Deep Notes</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/deepaksood619" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.linkedin.com/in/deepaksood619/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/about-deepak-sood/">About Deepak Sood</a><button aria-label="Expand sidebar category &#x27;About Deepak Sood&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ai/">AI</a><button aria-label="Expand sidebar category &#x27;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/algorithms/">Algorithms</a><button aria-label="Expand sidebar category &#x27;Algorithms&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/book-summaries/">Book Summaries</a><button aria-label="Expand sidebar category &#x27;Book Summaries&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud/">Cloud</a><button aria-label="Expand sidebar category &#x27;Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/computer-science/">Computer Science</a><button aria-label="Expand sidebar category &#x27;Computer Science&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/courses/">Courses / Certifications</a><button aria-label="Expand sidebar category &#x27;Courses / Certifications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-structures/">Data Structures</a><button aria-label="Expand sidebar category &#x27;Data Structures&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/databases/">Databases</a><button aria-label="Collapse sidebar category &#x27;Databases&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/concepts/">Databases Concepts</a><button aria-label="Expand sidebar category &#x27;Databases Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/databases/data-warehouses/">Data Warehouses</a><button aria-label="Collapse sidebar category &#x27;Data Warehouses&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/clickhouse">ClickHouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/comparisions">Comparisions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/data-warehouses/concepts/">Data Warehouse - Concepts</a><button aria-label="Expand sidebar category &#x27;Data Warehouse - Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/databases/data-warehouses/databricks/">Databricks</a><button aria-label="Collapse sidebar category &#x27;Databricks&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/01-databricks">Databricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/02-databricks-getting-started">Databricks in 5 minutes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/databases/data-warehouses/databricks/03-optimizations">Optimizations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/04-workflow">Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/10-medallion-architecture">Medallion Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/20-delta-live-tables">Delta Live Tables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/30-unity-catalog">Unity Catalog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/40-databricks-commands">Databricks-commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/databricks/99-others">Others</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/databases/data-warehouses/list-of-data-warehouses">List of Data Warehouses</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/data-warehouses/snowflake/">Snowflake</a><button aria-label="Expand sidebar category &#x27;Snowflake&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/indexing/">Indexing</a><button aria-label="Expand sidebar category &#x27;Indexing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/modeling/">Modeling</a><button aria-label="Expand sidebar category &#x27;Modeling&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/nosql-databases/">NoSQL Databases</a><button aria-label="Expand sidebar category &#x27;NoSQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/others/">Others</a><button aria-label="Expand sidebar category &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/databases/sql-databases/">SQL Databases</a><button aria-label="Expand sidebar category &#x27;SQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/decentralized-applications/">Decentralized Applications</a><button aria-label="Expand sidebar category &#x27;Decentralized Applications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/devops/">DevOps</a><button aria-label="Expand sidebar category &#x27;DevOps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/economics/">Economics</a><button aria-label="Expand sidebar category &#x27;Economics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/">Frontend</a><button aria-label="Expand sidebar category &#x27;Frontend&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/knowledge/">Knowledge</a><button aria-label="Expand sidebar category &#x27;Knowledge&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/languages/">Languages</a><button aria-label="Expand sidebar category &#x27;Languages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/management/">Management</a><button aria-label="Expand sidebar category &#x27;Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mathematics/">Mathematics</a><button aria-label="Expand sidebar category &#x27;Mathematics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/networking/">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/psychology/">Psychology</a><button aria-label="Expand sidebar category &#x27;Psychology&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/python/">Python</a><button aria-label="Expand sidebar category &#x27;Python&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Deepak&#x27;s Wiki</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/technologies/">Technologies</a><button aria-label="Expand sidebar category &#x27;Technologies&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/databases/"><span itemprop="name">Databases</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/databases/data-warehouses/"><span itemprop="name">Data Warehouses</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/databases/data-warehouses/databricks/"><span itemprop="name">Databricks</span></a><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Optimizations</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Optimizations</h1></header>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="delta-lake-files---s3-effect">Delta Lake Files - S3 Effect<a href="#delta-lake-files---s3-effect" class="hash-link" aria-label="Direct link to Delta Lake Files - S3 Effect" title="Direct link to Delta Lake Files - S3 Effect">​</a></h3>
<p><a href="https://medium.com/the-nobodys-of-tech/save-on-storage-costs-with-databricks-on-aws-374931708fa0" target="_blank" rel="noopener noreferrer">Save on storage costs with Databricks on AWS | Medium</a></p>
<p>The only way to delete files no longer needed for the table’s state is by running the <a href="https://docs.delta.io/latest/delta-utility.html#vacuum" target="_blank" rel="noopener noreferrer"><em>VACUUM</em></a> command on the table. The command takes a threshold (days), and only removes files beyond the threshold days so that the time-travel/restore is available for the threshold period. This is great and appears to have solved the problem of exponential file duplication, but there is one more caveat. Unless the S3 bucket backing the delta table is disabled for <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/versioning-workflows.html" target="_blank" rel="noopener noreferrer"><em>versioning</em></a>, the previous delete operation only adds a <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/DeleteMarker.html" target="_blank" rel="noopener noreferrer"><em>Delete Marker</em></a> to the files, and the actual version is still retained for X number of days for general purpose restoration. The X number of days is defined in the <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html" target="_blank" rel="noopener noreferrer"><em>Lifecycle Policy</em></a> of the S3 bucket.</p>
<p>Bottom line, if the delta tables are backed by a version enabled S3 Bucket with a very generous lifecycle policy, the storage cost will increase exponentially and mitigation efforts through VACUUM has very little effect. The bitter truth is, after a while, much of your S3 cost is towards the files that does not make up your table.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices-delta-lake">Best practices: Delta Lake<a href="#best-practices-delta-lake" class="hash-link" aria-label="Direct link to Best practices: Delta Lake" title="Direct link to Best practices: Delta Lake">​</a></h3>
<ul>
<li>Provide data location hints</li>
<li>Compact files</li>
<li>Replace the content or schema of a table</li>
<li>Spark caching</li>
<li>Differences between Delta Lake and Parquet on Apache Spark</li>
<li>Improve performance for Delta Lake merge</li>
<li>Manage data recency</li>
<li>Enhanced checkpoints for low-latency queries</li>
<li>Manage column-level statistics in checkpoints</li>
<li>Enable enhanced checkpoints for Structured Streaming queries</li>
</ul>
<p><a href="https://docs.databricks.com/delta/best-practices.html" target="_blank" rel="noopener noreferrer">Best practices: Delta Lake | Databricks on AWS</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="databricks-runtime-performance-enhancements">Databricks Runtime performance enhancements<a href="#databricks-runtime-performance-enhancements" class="hash-link" aria-label="Direct link to Databricks Runtime performance enhancements" title="Direct link to Databricks Runtime performance enhancements">​</a></h4>
<ul>
<li><a href="https://docs.databricks.com/optimizations/disk-cache.html" target="_blank" rel="noopener noreferrer">Disk caching</a> accelerates repeated reads against Parquet data files by loading data to disk volumes attached to compute clusters.</li>
<li><a href="https://docs.databricks.com/optimizations/dynamic-file-pruning.html" target="_blank" rel="noopener noreferrer">Dynamic file pruning</a> improves query performance by skipping directories that do not contain data files that match query predicates.</li>
<li><a href="https://docs.databricks.com/optimizations/low-shuffle-merge.html" target="_blank" rel="noopener noreferrer">Low shuffle merge</a> reduces the number of data files rewritten by <code>MERGE</code> operations and reduces the need to recalculate <code>ZORDER</code> clusters.<!-- -->
<ul>
<li><a href="https://www.youtube.com/watch?v=At1IrqsM_sE" target="_blank" rel="noopener noreferrer">Advancing Spark - Understanding Low Shuffle Merge - YouTube</a></li>
</ul>
</li>
<li>Apache Spark 3.0 introduced <a href="https://docs.databricks.com/optimizations/aqe.html" target="_blank" rel="noopener noreferrer">adaptive query execution</a>, which provides enhanced performance for many operations.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="databricks-recommendations-for-enhanced-performance">Databricks recommendations for enhanced performance<a href="#databricks-recommendations-for-enhanced-performance" class="hash-link" aria-label="Direct link to Databricks recommendations for enhanced performance" title="Direct link to Databricks recommendations for enhanced performance">​</a></h4>
<ul>
<li>You can <a href="https://docs.databricks.com/optimizations/clone.html" target="_blank" rel="noopener noreferrer">clone</a> tables on Databricks to make deep or shallow copies of source datasets.</li>
<li>The <a href="https://docs.databricks.com/optimizations/cbo.html" target="_blank" rel="noopener noreferrer">cost-based optimizer</a> accelerates query performance by leveraging table statistics.</li>
<li>You can <a href="https://docs.databricks.com/optimizations/auto-optimize.html" target="_blank" rel="noopener noreferrer">auto optimize</a> Delta tables using optimized writes and automatic file compaction; this is especially useful for long-running Structured Streaming jobs.</li>
<li>You can use Spark SQL to interact with <a href="https://docs.databricks.com/optimizations/semi-structured.html" target="_blank" rel="noopener noreferrer">semi-structured JSON data</a> without parsing strings.</li>
<li><a href="https://docs.databricks.com/optimizations/higher-order-lambda-functions.html" target="_blank" rel="noopener noreferrer">Higher order functions</a> provide built-in, optimized performance for many operations that do not have common Spark operators. Higher order functions provide a performance benefit over user defined functions.</li>
<li>Databricks provides a number of built-in operators and special syntax for working with <a href="https://docs.databricks.com/optimizations/complex-types.html" target="_blank" rel="noopener noreferrer">complex data types</a>, including arrays, structs, and JSON strings.</li>
<li>You can manually tune settings for joins that include <a href="https://docs.databricks.com/optimizations/range-join.html" target="_blank" rel="noopener noreferrer">ranges</a> or contain data with substanial <a href="https://docs.databricks.com/optimizations/skew-join.html" target="_blank" rel="noopener noreferrer">skew</a>.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="opt-in-behaviors">Opt-in behaviors<a href="#opt-in-behaviors" class="hash-link" aria-label="Direct link to Opt-in behaviors" title="Direct link to Opt-in behaviors">​</a></h4>
<ul>
<li>Databricks provides a write serializable isolation guarantee by default; changing the <a href="https://docs.databricks.com/optimizations/isolation-level.html" target="_blank" rel="noopener noreferrer">isolation level</a> to serializable can reduce throughput for concurrent operations, but might be necessary when read serializability is required.</li>
<li>You can use <a href="https://docs.databricks.com/optimizations/bloom-filters.html" target="_blank" rel="noopener noreferrer">bloom filter indexes</a> to reduce the likelihood of scanning data files that don’t contain records matching a given condition.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimize-your-file-size-for-fast-file-pruning">Optimize your file size for fast file pruning<a href="#optimize-your-file-size-for-fast-file-pruning" class="hash-link" aria-label="Direct link to Optimize your file size for fast file pruning" title="Direct link to Optimize your file size for fast file pruning">​</a></h2>
<p>Two of the biggest time sinks in an Apache Spark query are the time spent reading data from cloud storage and the need to read all underlying files. With <a href="https://docs.databricks.com/delta/optimizations/file-mgmt.html#data-skipping" target="_blank" rel="noopener noreferrer">data skipping</a> on Delta Lake, queries can selectively read only the Delta files containing relevant data, saving significant time. Data skipping can help with static file pruning, dynamic file pruning, static partition pruning and dynamic partition pruning.</p>
<p>One of the first things to consider when setting up data skipping is the ideal data file size - too small and you will have too many files (the well-known &quot;small-file problem&quot;); too large and you won’t be able to skip enough data.</p>
<p>A good file size range is 32-128MB (<code>1024*1024*32 = 33554432</code> for 32MB of course). Again, the idea is that if the file size is too big, the dynamic file pruning will skip to the right file or files, but they will be so large it will still have a lot of work to do. By <a href="https://docs.databricks.com/delta/optimizations/file-mgmt.html#id4" target="_blank" rel="noopener noreferrer">creating smaller files</a>, you can benefit from file pruning and minimize the I/O retrieving the data you need to join.</p>
<p>You can set the file size value for the entire notebook in Python:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">spark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">conf</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;spark.databricks.delta.targetFileSize&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">33554432</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or in SQL:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> spark</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">databricks</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">targetFileSize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">33554432</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or you can set it only for a specific table using:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">database</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">table</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SET</span><span class="token plain"> TBLPROPERTIES </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">targetFileSize</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">33554432</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you happen to be reading this article after you have already created tables, you can still set the table property for the file size and, when optimizing and creating the ZORDER, the files will be proportioned to the new file size. If you have already added a ZORDER, you can add and/or remove a column to force a re-write before arriving at the final ZORDER configuration.</p>
<p>As Databricks continues to add features and capabilities, we can also Auto Tune the file size based on the table size. For smaller databases, the above setting will likely provide better performance but for larger tables and/or just to make it simpler, you can follow the guidance <a href="https://docs.databricks.com/delta/optimizations/file-mgmt.html#autotune-based-on-table-size" target="_blank" rel="noopener noreferrer">here</a> and implement the <code>delta.tuneFileSizesForRewrites</code> table property.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-z-order-on-your-fact-tables">Create a Z-Order on your fact tables<a href="#create-a-z-order-on-your-fact-tables" class="hash-link" aria-label="Direct link to Create a Z-Order on your fact tables" title="Direct link to Create a Z-Order on your fact tables">​</a></h3>
<p><img decoding="async" loading="lazy" alt="z-order" src="/assets/images/Pasted image 20230320173453-da483f6d5887f1d0235983c1f967df60.jpg" width="1000" height="764" class="img_ev3q"></p>
<p>If you expect a column to be commonly used in query predicates and if that column has high cardinality (that is, a large number of distinct values), then use <code>ZORDER BY</code>.</p>
<p>You can specify multiple columns for <code>ZORDER BY</code> as a comma-separated list. However, the effectiveness of the locality drops with each extra column. Z-ordering on columns that do not have statistics collected on them would be ineffective and a waste of resources. This is because data skipping requires column-local stats such as min, max, and count. You can configure statistics collection on certain columns by reordering columns in the schema, or you can increase the number of columns to collect statistics on.</p>
<p>To improve query speed, Delta Lake supports the ability to optimize the layout of data stored in cloud storage with <a href="https://docs.databricks.com/delta/optimizations/file-mgmt.html" target="_blank" rel="noopener noreferrer">Z-Ordering</a>, also known as multi-dimensional clustering. Z-Orders are used in similar situations as clustered indexes in the database world, though they are not actually an auxiliary structure. A Z-Order will cluster the data in the Z-Order definition, so that rows like column values from the Z-order definition are collocated in as few files as possible.</p>
<p>Most database systems introduced indexing as a way to improve query performance. Indexes are files, and thus as the data grows in size, they can become another big data problem to solve. Instead, Delta Lake orders the data in the Parquet files to make range selection on object storage more efficient. Combined with the stats collection process and data skipping, Z-Order is similar to seek vs. scan operations in databases, which indexes solved, without creating another compute bottleneck to find the data a query is looking for.</p>
<p>For Z-Ordering, the best practice is to limit the number of columns in the Z-Order to the best 1-4. We chose the foreign keys (foreign keys by use, not actually enforced foreign keys) of the 3 largest dimensions which were too large to broadcast to the workers.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">OPTIMIZE</span><span class="token plain"> MY_FACT_TABLE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ZORDER </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">LARGEST_DIM_FK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> NEXT_LARGEST_DIM_FK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Additionally, if you have tremendous scale and 100&#x27;s of billions of rows or Petabytes of data in your fact table, you should consider partitioning to further improve file skipping. Partitions are effective when you are actively filtering on a partitioned field.</p>
<p><a href="https://docs.databricks.com/delta/data-skipping.html" target="_blank" rel="noopener noreferrer">Data skipping with Z-order indexes for Delta Lake | Databricks on AWS</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-z-orders-on-your-dimension-key-fields-and-most-likely-predicates">Create Z-Orders on your dimension key fields and most likely predicates<a href="#create-z-orders-on-your-dimension-key-fields-and-most-likely-predicates" class="hash-link" aria-label="Direct link to Create Z-Orders on your dimension key fields and most likely predicates" title="Direct link to Create Z-Orders on your dimension key fields and most likely predicates">​</a></h3>
<p>Although Databricks does not enforce primary keys on a Delta table, since you are reading this blog, you likely have dimensions and a surrogate key exists - one that is an integer or big integer and is validated and expected to be unique.</p>
<p>One of the dimensions we were working with had over 1 billion rows and benefitted from the file skipping and dynamic file pruning after adding our predicates into the Z-Order. Our smaller dimensions also had Z-Orders on the dimension key field and were broadcasted in the join to the facts. Similar to the advice on fact tables, limit the number of columns in the Z-Order to the 1-4 fields in the dimension that are most likely to be included in a filter in addition to the key.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">OPTIMIZE</span><span class="token plain"> MY_BIG_DIM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ZORDER </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MY_BIG_DIM_PK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LIKELY_FIELD_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> LIKELY_FIELD_2</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="partitions-vs-z-ordering">Partitions vs Z-Ordering<a href="#partitions-vs-z-ordering" class="hash-link" aria-label="Direct link to Partitions vs Z-Ordering" title="Direct link to Partitions vs Z-Ordering">​</a></h2>
<ul>
<li>Z-order works in tandem with the <code>OPTIMIZE</code> command. You cannot combine files across partition boundaries, and so Z-order clustering can only occur within a partition. For unpartitioned tables, files can be combined across the entire table.</li>
<li>Partitioning works well only for low or known cardinality fields (for example, date fields or physical locations), but not for fields with high cardinality such as timestamps. Z-order works for all fields, including high cardinality fields and fields that may grow infinitely (for example, timestamps or the customer ID in a transactions or orders table).</li>
</ul>
<p><a href="https://docs.databricks.com/tables/partitions.html" target="_blank" rel="noopener noreferrer">When to partition tables on Databricks | Databricks on AWS</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="analyze-table-to-gather-statistics-for-adaptive-query-execution-optimizer">Analyze Table to gather statistics for Adaptive Query Execution Optimizer<a href="#analyze-table-to-gather-statistics-for-adaptive-query-execution-optimizer" class="hash-link" aria-label="Direct link to Analyze Table to gather statistics for Adaptive Query Execution Optimizer" title="Direct link to Analyze Table to gather statistics for Adaptive Query Execution Optimizer">​</a></h2>
<p>One of the major advancements in Apache Spark 3.0 was the Adaptive Query Execution, or AQE for short. As of Spark 3.0, there are three major features in AQE, including coalescing post-shuffle partitions, converting sort-merge join to broadcast join, and skew join optimization. Together, these features enable the accelerated performance of dimensional models in Spark.</p>
<p>In order for AQE to know which plan to choose for you, we need to collect statistics about the tables. You do this by issuing the ANALYZE TABLE command. Customers have reported that collecting table statistics has significantly reduced query execution for dimensional models, including complex joins.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">ANALYZE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> MY_BIG_DIM </span><span class="token keyword" style="color:#00009f">COMPUTE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">STATISTICS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FOR</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ALL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">COLUMNS</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="photon-runtime">Photon runtime<a href="#photon-runtime" class="hash-link" aria-label="Direct link to Photon runtime" title="Direct link to Photon runtime">​</a></h3>
<p><a href="https://docs.databricks.com/runtime/photon.html" target="_blank" rel="noopener noreferrer">Photon runtime | Databricks on AWS</a></p>
<p><a href="https://docs.databricks.com/optimizations/index.html" target="_blank" rel="noopener noreferrer">Optimization recommendations on Databricks | Databricks on AWS</a></p>
<p><a href="https://www.databricks.com/blog/2022/05/20/five-simple-steps-for-implementing-a-star-schema-in-databricks-with-delta-lake.html" target="_blank" rel="noopener noreferrer">How to Get the Best Performance from Delta Lake Star Schema Databases - The Databricks Blog</a></p>
<p><a href="https://www.databricks.com/blog/2022/10/20/data-modeling-best-practices-implementation-modern-lakehouse.html" target="_blank" rel="noopener noreferrer">What’s a Dimensional Model and How to Implement It on the Databricks Lakehouse Platform - The Databricks Blog</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="findings">Findings<a href="#findings" class="hash-link" aria-label="Direct link to Findings" title="Direct link to Findings">​</a></h2>
<ul>
<li>using createdAtDate vs createdAt::date doesn&#x27;t make any difference in run query</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compute">Compute<a href="#compute" class="hash-link" aria-label="Direct link to Compute" title="Direct link to Compute">​</a></h2>
<p>Databricks supports various <a href="https://docs.databricks.com/clusters/index.html" target="_blank" rel="noopener noreferrer">cluster types</a>:</p>
<ul>
<li>All-purpose clusters</li>
<li>Job clusters</li>
<li>SQL Warehouses (Classic and Serverless)</li>
</ul>
<p>All-purpose clusters are dedicated for <strong>interactive</strong> usage, e.g.:</p>
<ul>
<li>exploration of the datasets using Notebooks</li>
<li>development of new ETL pipelines</li>
<li>interactive ML model development</li>
<li>Multiple users might use the same cluster at the same time</li>
</ul>
<p>It&#x27;s <strong>not recommended to use all-purpose clusters</strong> for any kind of <strong>automated workflow deploy and launch</strong>. For such cases, use job clusters - by this you&#x27;ll ensure proper resource isolation and independence of any other activities of other users on the all-purpose clusters.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="others">Others<a href="#others" class="hash-link" aria-label="Direct link to Others" title="Direct link to Others">​</a></h2>
<p><a href="https://www.databricks.com/blog/2022/11/08/optimizing-aws-s3-access-databricks.html" target="_blank" rel="noopener noreferrer">Optimizing AWS S3 Access for Databricks - The Databricks Blog</a></p>
<ul>
<li>S3 Endpoint is almost always better than NAT Gateway.</li>
</ul>
<p><a href="https://www.databricks.com/blog/2021/08/11/how-we-achieved-high-bandwidth-connectivity-with-bi-tools.html" target="_blank" rel="noopener noreferrer">How to Extract Large Query Results Through Cloud Object Stores - The Databricks Blog</a></p>
<p><a href="https://www.databricks.com/blog/2019/11/11/databricks-pools-speed-up-data-pipelines.html" target="_blank" rel="noopener noreferrer">Speed Up Your Data Pipeline with Databricks Pools</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/databases/data-warehouses/databricks/03-optimizations.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-12-18T20:45:26.000Z" itemprop="dateModified">Dec 18, 2024</time></b> by <b>Deepak</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/databases/data-warehouses/databricks/02-databricks-getting-started"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Databricks in 5 minutes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/databases/data-warehouses/databricks/04-workflow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#delta-lake-files---s3-effect" class="table-of-contents__link toc-highlight">Delta Lake Files - S3 Effect</a></li><li><a href="#best-practices-delta-lake" class="table-of-contents__link toc-highlight">Best practices: Delta Lake</a></li><li><a href="#optimize-your-file-size-for-fast-file-pruning" class="table-of-contents__link toc-highlight">Optimize your file size for fast file pruning</a><ul><li><a href="#create-a-z-order-on-your-fact-tables" class="table-of-contents__link toc-highlight">Create a Z-Order on your fact tables</a></li><li><a href="#create-z-orders-on-your-dimension-key-fields-and-most-likely-predicates" class="table-of-contents__link toc-highlight">Create Z-Orders on your dimension key fields and most likely predicates</a></li></ul></li><li><a href="#partitions-vs-z-ordering" class="table-of-contents__link toc-highlight">Partitions vs Z-Ordering</a></li><li><a href="#analyze-table-to-gather-statistics-for-adaptive-query-execution-optimizer" class="table-of-contents__link toc-highlight">Analyze Table to gather statistics for Adaptive Query Execution Optimizer</a><ul><li><a href="#photon-runtime" class="table-of-contents__link toc-highlight">Photon runtime</a></li></ul></li><li><a href="#findings" class="table-of-contents__link toc-highlight">Findings</a></li><li><a href="#compute" class="table-of-contents__link toc-highlight">Compute</a></li><li><a href="#others" class="table-of-contents__link toc-highlight">Others</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Deep Notes, Built with ❤️</div></div></div></footer></div>
</body>
</html>