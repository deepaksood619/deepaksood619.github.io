<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technologies/kafka/kafka-architecture" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Kafka Architecture | Deep Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://deepaksood619.github.io/img/timeline_blurred.webp"><meta data-rh="true" name="twitter:image" content="https://deepaksood619.github.io/img/timeline_blurred.webp"><meta data-rh="true" property="og:url" content="https://deepaksood619.github.io/technologies/kafka/kafka-architecture"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kafka Architecture | Deep Notes"><meta data-rh="true" name="description" content="Kafka consists of brokers that take messages from the producers and add to a partition of a topic. Brokers provide the messages to the consumers from the partitions."><meta data-rh="true" property="og:description" content="Kafka consists of brokers that take messages from the producers and add to a partition of a topic. Brokers provide the messages to the consumers from the partitions."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://deepaksood619.github.io/technologies/kafka/kafka-architecture"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/technologies/kafka/kafka-architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/technologies/kafka/kafka-architecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X3OY8NGHVH-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Technologies","item":"https://deepaksood619.github.io/technologies/"},{"@type":"ListItem","position":2,"name":"Kafka","item":"https://deepaksood619.github.io/technologies/kafka/"},{"@type":"ListItem","position":3,"name":"Kafka Architecture","item":"https://deepaksood619.github.io/technologies/kafka/kafka-architecture"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZSZMJXWSH3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZSZMJXWSH3",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-TN3KBF4",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Deep Notes" href="/opensearch.xml">
<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(53, 120, 229)">


<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5616865131274062" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.9f55d0bd.css">
<script src="/assets/js/runtime~main.7b3a7cc3.js" defer="defer"></script>
<script src="/assets/js/main.c96be3a1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TN3KBF4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Deep Notes</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/deepaksood619" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.linkedin.com/in/deepaksood619/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/about-deepak-sood/">About Deepak Sood</a><button aria-label="Expand sidebar category &#x27;About Deepak Sood&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ai/">AI</a><button aria-label="Expand sidebar category &#x27;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/algorithms/">Algorithms</a><button aria-label="Expand sidebar category &#x27;Algorithms&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/book-summaries/">Book Summaries</a><button aria-label="Expand sidebar category &#x27;Book Summaries&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud/">Cloud</a><button aria-label="Expand sidebar category &#x27;Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/computer-science/">Computer Science</a><button aria-label="Expand sidebar category &#x27;Computer Science&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/courses/">Courses / Certifications</a><button aria-label="Expand sidebar category &#x27;Courses / Certifications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-structures/">Data Structures</a><button aria-label="Expand sidebar category &#x27;Data Structures&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-warehouses/">Data Warehouses</a><button aria-label="Expand sidebar category &#x27;Data Warehouses&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases/">Databases</a><button aria-label="Expand sidebar category &#x27;Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases-nosql/">NoSQL Databases</a><button aria-label="Expand sidebar category &#x27;NoSQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases-sql/">SQL Databases</a><button aria-label="Expand sidebar category &#x27;SQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/decentralized-applications/">Decentralized Applications</a><button aria-label="Expand sidebar category &#x27;Decentralized Applications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/devops/">DevOps</a><button aria-label="Expand sidebar category &#x27;DevOps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/economics/">Economics</a><button aria-label="Expand sidebar category &#x27;Economics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/education/">Education</a><button aria-label="Expand sidebar category &#x27;Education&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/">Frontend</a><button aria-label="Expand sidebar category &#x27;Frontend&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/knowledge/">Knowledge</a><button aria-label="Expand sidebar category &#x27;Knowledge&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/languages/">Languages</a><button aria-label="Expand sidebar category &#x27;Languages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/management/">Management</a><button aria-label="Expand sidebar category &#x27;Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mathematics/">Mathematics</a><button aria-label="Expand sidebar category &#x27;Mathematics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/networking/">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/psychology/">Psychology</a><button aria-label="Expand sidebar category &#x27;Psychology&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/python/">Python</a><button aria-label="Expand sidebar category &#x27;Python&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Deepak&#x27;s Wiki</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/technologies/">Technologies</a><button aria-label="Collapse sidebar category &#x27;Technologies&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache/">Apache</a><button aria-label="Expand sidebar category &#x27;Apache&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-airflow/">Airflow</a><button aria-label="Expand sidebar category &#x27;Airflow&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-hadoop/">Apache Hadoop</a><button aria-label="Expand sidebar category &#x27;Apache Hadoop&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-spark/">Apache Spark</a><button aria-label="Expand sidebar category &#x27;Apache Spark&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/brokers/">Brokers</a><button aria-label="Expand sidebar category &#x27;Brokers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/celery/">Celery</a><button aria-label="Expand sidebar category &#x27;Celery&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/confluent/">Confluent</a><button aria-label="Expand sidebar category &#x27;Confluent&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/elasticsearch/">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/flink/">Apache Flink</a><button aria-label="Expand sidebar category &#x27;Apache Flink&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/git/">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/technologies/kafka/">Kafka</a><button aria-label="Collapse sidebar category &#x27;Kafka&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/comparison">Comparison</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/installing-kafka">Installing Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/intro-to-kafka">Intro to Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/technologies/kafka/kafka-architecture">Kafka Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-brokers">Kafka Brokers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-commands">Kafka Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-configurations">Kafka Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-connect">Kafka Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-consumers">Kafka Consumers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-guarantees">Kafka Guarantees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-listeners">Kafka Listeners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-message-key">Kafka Message Key</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-partitions">Partitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-producers">Kafka Producers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-python">kafka-python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-rest-proxy">kafka-rest proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-schema-registry-compatibility-rules">Kafka Schema Registry Compatibility Rules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-schema-registry">Kafka Schema Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-streams">Kafka Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-topic-replication">Kafka Topic/Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-topics">Kafka Topics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafkacat-kcat">kafkacat / kcat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kraft">Kafka without Zookeeper (Kafka with KRaft Mode)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/log-compaction">Log Compaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/migration-mirroring-replication">Migration / Mirroring / Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/others">Others</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/releases-upgrades-changelogs">Releases / Upgrades / Change logs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/kafka/security/">Security</a><button aria-label="Expand sidebar category &#x27;Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/strimzi">Strimzi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/use-cases">Use Cases</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/others/">Others</a><button aria-label="Expand sidebar category &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/technologies/"><span>Technologies</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/technologies/kafka/"><span>Kafka</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Kafka Architecture</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kafka Architecture</h1></header>
<p>Kafka consists of brokers that take messages from the producers and add to a partition of a topic. Brokers provide the messages to the consumers from the partitions.</p>
<ul>
<li>A topic is divided into multiple partitions</li>
<li>The messages are added to the partitions at one end and consumed in the same order</li>
<li>Each partition acts as a message queue</li>
<li>Consumers are divided into consumer groups</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-kafka-so-fast">Why is Kafka so Fast?<a href="#why-is-kafka-so-fast" class="hash-link" aria-label="Direct link to Why is Kafka so Fast?" title="Direct link to Why is Kafka so Fast?">​</a></h2>
<ol>
<li>The first one is Kafka’s reliance on Sequential I/O.</li>
<li>The second design choice that gives Kafka its performance advantage is its focus on efficiency: zero copy principle.</li>
</ol>
<p>Kafka relies heavily on the OS kernel to move data around quickly. It relies on the principals of <a href="https://en.wikipedia.org/wiki/Zero-copy" target="_blank" rel="noopener noreferrer">Zero Copy</a>. Kafka enables you to batch data records into chunks. These batches of data can be seen end to end from Producer to file system (Kafka Topic Log) to the Consumer. Batching allows for more efficient data compression and reduces I/O latency. Kafka writes to the immutable commit log to the disk sequential; thus, avoids random disk access, slow disk seeking. Kafka provides horizontal Scale through sharding. It shards a Topic Log into hundreds potentially thousands of partitions to thousands of servers. This sharding allows Kafka to handle massive load.</p>
<p>Zero-copy means that Kafka sends messages from the file (or more likely, the Linux filesystem cache) directly to the network channel without any intermediate buffers.</p>
<p><img decoding="async" loading="lazy" alt="Why is Kafka Fast" src="/assets/images/Pasted image 20240213012230-fe58daa64c3bca48d272dfa690a1702d.jpg" width="999" height="1203" class="img_ev3q"></p>
<p><a href="https://www.youtube.com/channel/UCZgt6AzoyjslHTC9dz0UoTw/community?lb=UgkxKPCx8UjOik2iB9rKHDWqgzv_y59aCrDW" target="_blank" rel="noopener noreferrer">ByteByteGo - YouTube</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="zero-copy">Zero-copy<a href="#zero-copy" class="hash-link" aria-label="Direct link to Zero-copy" title="Direct link to Zero-copy">​</a></h3>
<p>&quot;<strong>Zero-copy</strong>&quot; describes computer operations in which the <a href="https://en.wikipedia.org/wiki/Central_processing_unit" target="_blank" rel="noopener noreferrer">CPU</a> does not perform the task of copying data from one <a href="https://en.wikipedia.org/wiki/RAM" target="_blank" rel="noopener noreferrer">memory</a> area to another. This is frequently used to save CPU cycles and memory bandwidth when transmitting a file over a network.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kafka-zero-copy">Kafka Zero Copy<a href="#kafka-zero-copy" class="hash-link" aria-label="Direct link to Kafka Zero Copy" title="Direct link to Kafka Zero Copy">​</a></h3>
<p>Ideally, the data written to the log segment is written in protocol format. That is, what gets written to disk is exactly what gets sent over the wire. This allows for zero-copy reads. Let&#x27;s take a look at how this otherwise works.</p>
<p>When you read messages from the log, the kernel will attempt to pull the data from the page cache. If it&#x27;s not there, it will be read from disk. The data is copied from disk to page cache, which all happens in kernel space. Next, the data is copied into the application (i.e. user space). This all happens with the read system call. Now the application writes the data out to a socket using send, which is going to copy it back into kernel space to a socket buffer before it&#x27;s copied one last time to the NIC. All in all, we have four copies (including one from page cache) and two system calls.</p>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Architecture-image2-8a664a31a2ddcf0809cc2ee20bbad21e.jpg" width="999" height="401" class="img_ev3q"></p>
<p>However, if the data is already in wire format, we can bypass user space entirely using the send filesystem call, which will copy the data directly from the page cache to the NIC buffer - two copies (including one from page cache) and one system call. This turns out to be an important optimization, especially in garbage-collected languages since we&#x27;re bringing less data into application memory. Zero-copy also reduces CPU cycles and memory bandwidth.</p>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Architecture-image3-cd81da28ba7e25b3bf27ebfe34f80266.jpg" width="997" height="320" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="other-optimizations---messages-batching--compression">Other Optimizations - Messages batching &amp; Compression<a href="#other-optimizations---messages-batching--compression" class="hash-link" aria-label="Direct link to Other Optimizations - Messages batching &amp; Compression" title="Direct link to Other Optimizations - Messages batching &amp; Compression">​</a></h3>
<p><a href="https://en.wikipedia.org/wiki/Zero-copy" target="_blank" rel="noopener noreferrer">https://en.wikipedia.org/wiki/Zero-copy</a></p>
<p><a href="https://bravenewgeek.com/building-a-distributed-log-from-scratch-part-1-storage-mechanics" target="_blank" rel="noopener noreferrer">https://bravenewgeek.com/building-a-distributed-log-from-scratch-part-1-storage-mechanics</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="concepts">Concepts<a href="#concepts" class="hash-link" aria-label="Direct link to Concepts" title="Direct link to Concepts">​</a></h2>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Architecture-image1-f9c3459df4492e1f82065aef699896dd.jpg" width="1000" height="584" class="img_ev3q"></p>
<ul>
<li>Zookeeper</li>
<li>Producer</li>
<li>Consumer</li>
<li>Kafka cluster</li>
<li>Failovers</li>
<li>ISRs</li>
<li>Kafka disaster recovery</li>
<li>Topic</li>
<li>Topic Partition</li>
<li>Consumer Group</li>
<li>Offsets</li>
</ul>
<p>Starting from version 0.8.2.0, the offsets committed by the consumers aren&#x27;t saved in <a href="https://dzone.com/articles/an-introduction-to-zookeeper-1" target="_blank" rel="noopener noreferrer">ZooKeeper</a> but on a partitioned and replicated topic named <code>__consumer_offsets</code>, which is hosted on the Kafka brokers in the cluster.</p>
<p>When a consumer commits some offsets (for different partitions), it sends a message to the broker to the <code>__consumer_offsets</code> topic. The message has the following structure :</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">key = [group, topic, partition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">value = offset</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts">Key concepts<a href="#key-concepts" class="hash-link" aria-label="Direct link to Key concepts" title="Direct link to Key concepts">​</a></h2>
<table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>topic</td><td>Defines a logical name for producing and consuming records.</td></tr><tr><td>partition</td><td>Defines a non-overlapping subset of records within a topic.</td></tr><tr><td>offset</td><td>A unique sequential number assigned to each record within a topic partition.</td></tr><tr><td>record</td><td>A record contains a key, a value, a timestamp, and a list of headers.</td></tr><tr><td>broker</td><td>Servers where records are stored. Multiple brokers can be used to form a cluster.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="segment-file">Segment File<a href="#segment-file" class="hash-link" aria-label="Direct link to Segment File" title="Direct link to Segment File">​</a></h3>
<p>A Kafka <strong>Partition</strong> is technically a directory of files. It would be impossible to store all messages for a partition in a single massive file (it would be hard to delete old data or scale).</p>
<p>Instead, Kafka splits the partition log into smaller files called <strong>Segments</strong>.</p>
<ul>
<li><strong>Structure:</strong> A segment consists of a <code>.log</code> file (actual data) and an <code>.index</code> file (maps offsets to byte positions).</li>
<li><strong>Rolling:</strong> When a segment reaches a size limit (e.g., 1GB) or a time limit (e.g., 7 days), the file is closed, and a new &quot;active&quot; segment is created.</li>
<li><strong>Cleanup:</strong> Segment files are the unit of deletion. When a log cleanup policy kicks in (delete data older than X days), Kafka deletes the entire old segment file.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="retention-policy">Retention Policy<a href="#retention-policy" class="hash-link" aria-label="Direct link to Retention Policy" title="Direct link to Retention Policy">​</a></h2>
<table><thead><tr><th><strong>RETENTION POLICY</strong></th><th><strong>MEANING</strong></th></tr></thead><tbody><tr><td>log.retention.hours</td><td>The number of hours to keep a record on the broker.</td></tr><tr><td>log.retention.bytes</td><td>The maximum size of records retained in a partition.</td></tr></tbody></table>
<ol>
<li><strong>Time-based retention:</strong> Messages are retained for a specified duration of time. Once the time limit is reached, Kafka marks the messages as eligible for deletion. For example, you can set a retention period of 7 days, and any message older than 7 days will be deleted.</li>
<li><strong>Size-based retention:</strong> This policy determines the retention of messages based on the size of the topic log. Kafka allows you to set a maximum size for the topic&#x27;s log, and once that size is reached, Kafka starts deleting older messages to make room for new ones.</li>
</ol>
<p><strong>Retention Policies</strong></p>
<ol>
<li>Delete</li>
<li>Compact</li>
<li>Delete, Compact</li>
</ol>
<p><strong>Points to Remember</strong></p>
<ul>
<li>Active segments doesn&#x27;t participate in cleaning up<!-- -->
<ul>
<li>Cleanup is done in old and closed segments</li>
<li>If the latest message in the segment is greater than the retention time, then that segment gets cleaned up.</li>
</ul>
</li>
<li>A background process called the &quot;log cleaner&quot; scans the log segments.<!-- -->
<ul>
<li>For each key, it keeps the most recent message and removes older messages with the same key from the tail of the log.</li>
<li>Messages with a <code>null</code> payload (tombstones) are treated as delete markers and are also removed after a configurable period (default <code>delete.retention.ms</code> is 24 hours).</li>
<li>Message order is always maintained, and message offsets never change.</li>
</ul>
</li>
<li>Clean + Dirty = Total &gt;= 50%, then the cleanup gets triggered</li>
</ul>
<p><strong>Clean and Dirty Segments</strong></p>
<ul>
<li>﻿﻿Log segments that have been compacted are called clean segments</li>
<li>﻿﻿Log segments that have not been compacted are called dirty segments</li>
</ul>
<p><a href="https://docs.confluent.io/kafka/design/log_compaction.html" target="_blank" rel="noopener noreferrer">Kafka Log Compaction | Confluent Documentation</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kafka-internals-definitive-guide">Kafka Internals (Definitive Guide)<a href="#kafka-internals-definitive-guide" class="hash-link" aria-label="Direct link to Kafka Internals (Definitive Guide)" title="Direct link to Kafka Internals (Definitive Guide)">​</a></h2>
<ul>
<li>Cluster Membership<!-- -->
<ul>
<li>Kafka uses Apache Zookeeper to maintain the list of brokers that are currently members of a cluster</li>
</ul>
</li>
<li>Controller<!-- -->
<ul>
<li>The first broker that starts in the cluster becomes the controller by creating an ephemeral node in ZooKeeper called <code>/controller</code></li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="replication">Replication<a href="#replication" class="hash-link" aria-label="Direct link to Replication" title="Direct link to Replication">​</a></h3>
<p>Two types of replicas</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="leader-replica">Leader replica<a href="#leader-replica" class="hash-link" aria-label="Direct link to Leader replica" title="Direct link to Leader replica"> ​</a></h4>
<p>Each partition has a single replica designated as the leader. All produce and consume requests go through the leader, in order to guarantee consistency.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="follower-replica">Follower replica<a href="#follower-replica" class="hash-link" aria-label="Direct link to Follower replica" title="Direct link to Follower replica">​</a></h4>
<p>All replicas for a partition that are not leaders are called followers. Followers don&#x27;t serve client requests; their only job is to replicate messages from the leader and stay up-to-date with the most recent messages the leader has. In the event that a leader replica for a partition crashes, one of the follower replicas will be promoted to become the new leader for the partition.</p>
<ul>
<li>Replicas that are consistently asking for the latest messages, is called <em>in-sync replicas</em>. Only in-sync replicas are eligible to be elected as partition leaders in case the existing leader fails.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="request-processing">Request Processing<a href="#request-processing" class="hash-link" aria-label="Direct link to Request Processing" title="Direct link to Request Processing">​</a></h3>
<ul>
<li>Most of what a Kafka broker does is process requests sent to the partition leaders from clients, partition replicas, and the controller.</li>
<li>For each port the broker listens on, the broker runs an <em>acceptor</em> thread that creates a connection and hands it over to a <em>processor</em> thread for handling. The number of processor threads (also called <em>network threads</em>) is configurable. The network threads are responsible for taking requests from client connections, placing them in a <em>request queue</em>, and picking up responses from a <em>response queue</em> and sending them back to clients.</li>
<li>Once requests are placed on the request queue, <em>IO threads</em> are responsible for picking them up and processing them.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="the-most-common-types-of-requests-are">The most common types of requests are<a href="#the-most-common-types-of-requests-are" class="hash-link" aria-label="Direct link to The most common types of requests are" title="Direct link to The most common types of requests are">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="produce-requests">Produce requests<a href="#produce-requests" class="hash-link" aria-label="Direct link to Produce requests" title="Direct link to Produce requests">​</a></h5>
<p>Sent by producers and contain messages the clients write to Kafka brokers.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="fetch-requests">Fetch requests<a href="#fetch-requests" class="hash-link" aria-label="Direct link to Fetch requests" title="Direct link to Fetch requests">​</a></h5>
<p>Sent by consumers and follower replicas when they read messages from Kafka brokers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="physical-storage">Physical Storage<a href="#physical-storage" class="hash-link" aria-label="Direct link to Physical Storage" title="Direct link to Physical Storage">​</a></h3>
<p>The basic storage unit of Kafka is a partition replica.</p>
<ul>
<li>Partition allocation</li>
<li>File management</li>
<li>File format</li>
<li>Indexes</li>
<li>Compaction</li>
<li>Deleted Events<!-- -->
<ul>
<li>tombstone</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kafka-rebalancing-protocol">Kafka Rebalancing Protocol<a href="#kafka-rebalancing-protocol" class="hash-link" aria-label="Direct link to Kafka Rebalancing Protocol" title="Direct link to Kafka Rebalancing Protocol">​</a></h2>
<ol>
<li><strong>Eager Rebalancing Protocol (Stop the world rebalancing)</strong></li>
<li><strong>Incremental cooperative rebalancing</strong>
<ul>
<li>Incremental because the final desired state of rebalancing is reached in stages. A globally balanced final state does not have to be reached at the end of each round of rebalancing. A small number of consecutive rebalancing rounds can be used in order for the group of Kafka clients to converge to the desired state of balanced resources. In addition, you can configure a grace period to allow a departing member to return and regain its previously assigned resources.</li>
<li>Cooperative because each process in the group is asked to voluntarily release resources that need to be redistributed. These resources are then made available for rescheduling given that the client that was asked to release them does so on time</li>
</ul>
</li>
</ol>
<p><a href="https://www.confluent.io/blog/incremental-cooperative-rebalancing-in-kafka" target="_blank" rel="noopener noreferrer">https://www.confluent.io/blog/incremental-cooperative-rebalancing-in-kafka</a></p>
<p><a href="https://medium.com/streamthoughts/apache-kafka-rebalance-protocol-or-the-magic-behind-your-streams-applications-e94baf68e4f2" target="_blank" rel="noopener noreferrer">https://medium.com/streamthoughts/apache-kafka-rebalance-protocol-or-the-magic-behind-your-streams-applications-e94baf68e4f2</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="compression">Compression<a href="#compression" class="hash-link" aria-label="Direct link to Compression" title="Direct link to Compression">​</a></h2>
<p>compression.type: Specify the final compression type for a given topic. This configuration accepts the standard compression codecs (&#x27;gzip&#x27;, &#x27;snappy&#x27;, &#x27;lz4&#x27;, &#x27;zstd&#x27;). It additionally accepts &#x27;uncompressed&#x27; which is equivalent to no compression; and &#x27;producer&#x27; which means retain the original compression codec set by the producer</p>
<ul>
<li><strong>Type</strong>: string</li>
<li><strong>Default</strong>: producer</li>
<li><strong>Valid Values</strong>: [uncompressed, zstd, lz4, snappy, gzip, producer]</li>
<li><strong>Server Default Property</strong>: compression.type</li>
<li><strong>Importance</strong>: medium</li>
</ul>
<p>In Kafka compression, multiple messages are bundled and compressed. Then the compressed messages are turned into a special kind of message and appended to Kafka&#x27;s log file. The reason to compress a batch of messages, rather than individual messages, is to increase compression efficiency, i.e., compressors work better with bigger data.</p>
<p>There are tradeoffs with enabling compression that should be considered. Compression, of course, saves space needed for data storage. On the other hand, it consumes extra computing resources, namely CPU cycles and memory, to perform compression. The use of compression should be therefore decided with consideration of the balance of cost and benefit. To make the compression applicable to wider usages of Kafka, we set out to improve Kafka compression support by reducing the cost.</p>
<p><a href="https://www.confluent.io/blog/compression-in-apache-kafka-is-now-34-percent-faster" target="_blank" rel="noopener noreferrer">https://www.confluent.io/blog/compression-in-apache-kafka-is-now-34-percent-faster</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unclean-leader-election">Unclean Leader Election<a href="#unclean-leader-election" class="hash-link" aria-label="Direct link to Unclean Leader Election" title="Direct link to Unclean Leader Election">​</a></h2>
<p>Another caveat with Kafka is unclean leader elections. That is, if all replicas become unavailable, there are two options: choose the first replica to come back to life (not necessarily in the ISR) and elect this replica as leader (which could result in data loss) or wait for a replica in the ISR to come back to life and elect it as leader (which could result in prolonged unavailability). Initially, Kafka favoured availability by default by choosing the first strategy. If you preferred consistency, you needed to set <code>unclean.leader.election.enable</code> to <code>false</code>. However, as of 0.11, <code>unclean.leader.election.enable</code> now defaults to this.</p>
<p>When <code>unclean.leader.election.enable</code> is set to <code>true</code> in Kafka, it means that Kafka allows an out-of-sync replica to become the leader during a leader election if there are no in-sync replicas available. This is considered an &quot;unclean&quot; leader election because the selected leader might not have all the messages that were written while it was down.</p>
<p>how Kafka knows if the new leader is &quot;clean&quot; or not, when <code>unclean.leader.election.enable</code> is true:</p>
<ul>
<li><strong>Kafka does not explicitly check if the new leader is &quot;clean.&quot;</strong> The setting allows for the possibility of unclean leader elections, acknowledging that the elected leader might not be in sync with the latest messages.</li>
<li><strong>The leader may not have all the messages written while it was down.</strong> This is an accepted trade-off for cases where ensuring availability is prioritized over strict consistency.</li>
<li><strong>Efficiency vs. Consistency trade-off:</strong> Storing the latest offset for each received message in a distributed storage system like ZooKeeper for every leader replica could be resource-intensive and may introduce additional latency. Kafka&#x27;s design, in this case, prioritizes availability and responsiveness.</li>
</ul>
<p>If strict consistency is a higher priority for your use case, you might choose to keep <code>unclean.leader.election.enable</code> set to <code>false</code> (the default) to prevent unclean leader elections and ensure that a new leader must be fully caught up with the latest messages.</p>
<p>Here&#x27;s how Kafka determines whether a new leader is &quot;clean&quot; or not when <code>unclean.leader.election.enable</code> is set to <code>false</code>:</p>
<ol>
<li><strong>In-Sync Replica (ISR) Set:</strong> Kafka maintains a concept called the In-Sync Replica (ISR) set for each partition. The ISR set consists of replicas that are in sync with the leader.</li>
<li><strong>Leader Election:</strong> When a leader election occurs, only replicas in the ISR set are eligible to become the new leader.</li>
<li><strong>Replica Catch-Up:</strong> Before a replica becomes the leader, it needs to catch up with the leader&#x27;s log. If a replica is not in the ISR set or is lagging significantly behind the leader, it won&#x27;t be eligible to become the new leader.</li>
<li><strong>Out-of-Sync Replica Handling:</strong> If a replica is out of sync and cannot catch up within a configured time (controlled by the <code>replica.lag.time.max.ms</code> property), it may be removed from the ISR set, preventing it from becoming the leader.</li>
<li><strong>ZooKeeper Information:</strong> Kafka uses ZooKeeper to maintain metadata, including information about the ISR set. ZooKeeper keeps track of which replicas are in sync with the leader.</li>
</ol>
<p>By relying on the ISR set and ensuring that only replicas in sync are eligible for leadership, Kafka helps prevent the scenario where an out-of-sync replica becomes a leader. This mechanism contributes to maintaining data consistency and avoiding potential data loss during leader elections.</p>
<p>In summary, Kafka uses the ISR set, replica synchronization, and information stored in ZooKeeper to ensure that only in-sync replicas are considered for leadership when <code>unclean.leader.election.enable</code> is set to <code>false</code>.</p>
<p><a href="https://stackoverflow.com/questions/77716296/how-kafka-detects-unclean-leader-election" target="_blank" rel="noopener noreferrer">How Kafka detects unclean leader election? - Stack Overflow</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="others">Others<a href="#others" class="hash-link" aria-label="Direct link to Others" title="Direct link to Others">​</a></h2>
<ul>
<li>Idempotent Consumers</li>
<li>Idempotent Producers</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="http://cloudurable.com/blog/what-is-kafka/index.html" target="_blank" rel="noopener noreferrer">http://cloudurable.com/blog/what-is-kafka/index.html</a></li>
<li><a href="https://medium.com/swlh/why-kafka-is-so-fast-bde0d987cd03" target="_blank" rel="noopener noreferrer">https://medium.com/swlh/why-kafka-is-so-fast-bde0d987cd03</a></li>
<li><a href="https://www.youtube.com/playlist?list=PLa7VYi0yPIH14oEOfwbcE9_gM5lOZ4ICN" target="_blank" rel="noopener noreferrer">Apache Kafka® Architecture | Kafka&#x27;s Internal Components and How They Work - YouTube</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/technologies/kafka/kafka-architecture.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-01-29T17:38:54.000Z" itemprop="dateModified">Jan 29, 2026</time></b> by <b>Deepak Sood</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/technologies/kafka/intro-to-kafka"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Intro to Kafka</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/technologies/kafka/kafka-brokers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kafka Brokers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-is-kafka-so-fast" class="table-of-contents__link toc-highlight">Why is Kafka so Fast?</a><ul><li><a href="#zero-copy" class="table-of-contents__link toc-highlight">Zero-copy</a></li><li><a href="#kafka-zero-copy" class="table-of-contents__link toc-highlight">Kafka Zero Copy</a></li><li><a href="#other-optimizations---messages-batching--compression" class="table-of-contents__link toc-highlight">Other Optimizations - Messages batching &amp; Compression</a></li></ul></li><li><a href="#concepts" class="table-of-contents__link toc-highlight">Concepts</a></li><li><a href="#key-concepts" class="table-of-contents__link toc-highlight">Key concepts</a><ul><li><a href="#segment-file" class="table-of-contents__link toc-highlight">Segment File</a></li></ul></li><li><a href="#retention-policy" class="table-of-contents__link toc-highlight">Retention Policy</a></li><li><a href="#kafka-internals-definitive-guide" class="table-of-contents__link toc-highlight">Kafka Internals (Definitive Guide)</a><ul><li><a href="#replication" class="table-of-contents__link toc-highlight">Replication</a></li><li><a href="#request-processing" class="table-of-contents__link toc-highlight">Request Processing</a></li><li><a href="#physical-storage" class="table-of-contents__link toc-highlight">Physical Storage</a></li></ul></li><li><a href="#kafka-rebalancing-protocol" class="table-of-contents__link toc-highlight">Kafka Rebalancing Protocol</a></li><li><a href="#compression" class="table-of-contents__link toc-highlight">Compression</a></li><li><a href="#unclean-leader-election" class="table-of-contents__link toc-highlight">Unclean Leader Election</a></li><li><a href="#others" class="table-of-contents__link toc-highlight">Others</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Deep Notes, Built with ❤️</div></div></div></footer></div>
</body>
</html>