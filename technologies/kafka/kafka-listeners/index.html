<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-technologies/kafka/kafka-listeners" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Kafka Listeners | Deep Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://deepaksood619.github.io/img/timeline_compressed.webp"><meta data-rh="true" name="twitter:image" content="https://deepaksood619.github.io/img/timeline_compressed.webp"><meta data-rh="true" property="og:url" content="https://deepaksood619.github.io/technologies/kafka/kafka-listeners"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Kafka Listeners | Deep Notes"><meta data-rh="true" name="description" content="tl;dr : You need to set advertised.listeners (or KAFKAADVERTISEDLISTENERSif you&#x27;re using Docker images) to the external address (host/IP) so that clients can correctly connect to it. Otherwise they&#x27;ll try to connect to the internal host address and if that&#x27;s not reachable then problems ensue"><meta data-rh="true" property="og:description" content="tl;dr : You need to set advertised.listeners (or KAFKAADVERTISEDLISTENERSif you&#x27;re using Docker images) to the external address (host/IP) so that clients can correctly connect to it. Otherwise they&#x27;ll try to connect to the internal host address and if that&#x27;s not reachable then problems ensue"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://deepaksood619.github.io/technologies/kafka/kafka-listeners"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/technologies/kafka/kafka-listeners" hreflang="en"><link data-rh="true" rel="alternate" href="https://deepaksood619.github.io/technologies/kafka/kafka-listeners" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X3OY8NGHVH-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Technologies","item":"https://deepaksood619.github.io/technologies/"},{"@type":"ListItem","position":2,"name":"Kafka","item":"https://deepaksood619.github.io/technologies/kafka/"},{"@type":"ListItem","position":3,"name":"Kafka Listeners","item":"https://deepaksood619.github.io/technologies/kafka/kafka-listeners"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZSZMJXWSH3"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZSZMJXWSH3",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-TN3KBF4",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>



<link rel="search" type="application/opensearchdescription+xml" title="Deep Notes" href="/opensearch.xml">
<link rel="icon" href="/img/logo.webp">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(53, 120, 229)">


<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5616865131274062" async crossorigin="anonymous"></script><link rel="stylesheet" href="/assets/css/styles.9f55d0bd.css">
<script src="/assets/js/runtime~main.3b983314.js" defer="defer"></script>
<script src="/assets/js/main.73f95aa0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TN3KBF4" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.webp" alt="Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Deep Notes</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/deepaksood619" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://www.linkedin.com/in/deepaksood619/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/about-deepak-sood/">About Deepak Sood</a><button aria-label="Expand sidebar category &#x27;About Deepak Sood&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/ai/">AI</a><button aria-label="Expand sidebar category &#x27;AI&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/algorithms/">Algorithms</a><button aria-label="Expand sidebar category &#x27;Algorithms&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/book-summaries/">Book Summaries</a><button aria-label="Expand sidebar category &#x27;Book Summaries&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cloud/">Cloud</a><button aria-label="Expand sidebar category &#x27;Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/computer-science/">Computer Science</a><button aria-label="Expand sidebar category &#x27;Computer Science&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/courses/">Courses / Certifications</a><button aria-label="Expand sidebar category &#x27;Courses / Certifications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-structures/">Data Structures</a><button aria-label="Expand sidebar category &#x27;Data Structures&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/data-warehouses/">Data Warehouses</a><button aria-label="Expand sidebar category &#x27;Data Warehouses&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases/">Databases</a><button aria-label="Expand sidebar category &#x27;Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases-nosql/">NoSQL Databases</a><button aria-label="Expand sidebar category &#x27;NoSQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/databases-sql/">SQL Databases</a><button aria-label="Expand sidebar category &#x27;SQL Databases&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/decentralized-applications/">Decentralized Applications</a><button aria-label="Expand sidebar category &#x27;Decentralized Applications&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/devops/">DevOps</a><button aria-label="Expand sidebar category &#x27;DevOps&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/economics/">Economics</a><button aria-label="Expand sidebar category &#x27;Economics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/education/">Education</a><button aria-label="Expand sidebar category &#x27;Education&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/frontend/">Frontend</a><button aria-label="Expand sidebar category &#x27;Frontend&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/knowledge/">Knowledge</a><button aria-label="Expand sidebar category &#x27;Knowledge&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/languages/">Languages</a><button aria-label="Expand sidebar category &#x27;Languages&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/management/">Management</a><button aria-label="Expand sidebar category &#x27;Management&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/mathematics/">Mathematics</a><button aria-label="Expand sidebar category &#x27;Mathematics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/networking/">Networking</a><button aria-label="Expand sidebar category &#x27;Networking&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/psychology/">Psychology</a><button aria-label="Expand sidebar category &#x27;Psychology&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/python/">Python</a><button aria-label="Expand sidebar category &#x27;Python&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Deepak&#x27;s Wiki</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/technologies/">Technologies</a><button aria-label="Collapse sidebar category &#x27;Technologies&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache/">Apache</a><button aria-label="Expand sidebar category &#x27;Apache&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-airflow/">Airflow</a><button aria-label="Expand sidebar category &#x27;Airflow&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-hadoop/">Apache Hadoop</a><button aria-label="Expand sidebar category &#x27;Apache Hadoop&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/apache-spark/">Apache Spark</a><button aria-label="Expand sidebar category &#x27;Apache Spark&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/brokers/">Brokers</a><button aria-label="Expand sidebar category &#x27;Brokers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/celery/">Celery</a><button aria-label="Expand sidebar category &#x27;Celery&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/elasticsearch/">Elasticsearch</a><button aria-label="Expand sidebar category &#x27;Elasticsearch&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/git/">Git</a><button aria-label="Expand sidebar category &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/technologies/kafka/">Kafka</a><button aria-label="Collapse sidebar category &#x27;Kafka&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/azure-event-hubs">Azure Event Hubs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/comparison">Comparison</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/confluent-kafka">confluent-kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/installing-kafka">Installing Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/intro-to-kafka">Intro to Kafka</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/intro">Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-architecture">Kafka Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-commands">Kafka Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-connect">Kafka Connect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-consumers">Kafka Consumers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/technologies/kafka/kafka-listeners">Kafka Listeners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-producers">Kafka Producers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-python">kafka-python</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-rest-proxy">kafka-rest proxy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-schema-registry">Kafka schema-registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-streams">Kafka Streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafka-topic-replication">Kafka Topic/Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/kafkacat">kafkacat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/migration-mirroring-replication">Migration / Mirroring / Replication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/others">Others</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/strimzi">Strimzi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/technologies/kafka/warpstream">WarpStream</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/technologies/others/">Others</a><button aria-label="Expand sidebar category &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/technologies/"><span>Technologies</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/technologies/kafka/"><span>Kafka</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Kafka Listeners</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Kafka Listeners</h1></header>
<p>tl;dr : You need to set <code>advertised.listeners</code> (or <code>KAFKA_ADVERTISED_LISTENERS</code>if you&#x27;re using Docker images) to the external address (host/IP) so that clients can correctly connect to it. Otherwise they&#x27;ll try to connect to the internal host address and if that&#x27;s not reachable then problems ensue</p>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Listeners-image1-cdc6fddaeed7c9f176c6f1f3b183af77.jpg" width="999" height="489" class="img_ev3q"></p>
<p>In this post I&#x27;ll talk about <em>why</em> this is necessary, and then show <em>how</em> to do it, based on a couple of scenarios - Docker, and AWS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="is-anyone-listening">Is anyone listening?<a href="#is-anyone-listening" class="hash-link" aria-label="Direct link to Is anyone listening?" title="Direct link to Is anyone listening?">​</a></h2>
<p>Kafka is a distributed system. Data is read from &amp; written to the <em>Leader</em> for a given partition, which could be on any of the brokers in a cluster. When a client (producer/consumer) starts, it will request metadata about which broker is the leader for a partition - and it can do this from <em>any</em> broker. The metadata returned will include the endpoints available for the Leader broker for that partition, and the client will then use those endpoints to connect to the broker to read/write data as required.</p>
<p>It&#x27;s these endpoints that cause people trouble. On a <em>single machine, running &#x27;bare metal&#x27;</em> (no VMs, no Docker), everything might be the hostname (or just <em>localhost</em>) and it&#x27;s easy. But once you move into more complex networking setups, and multiple nodes, you have to pay more attention to it.</p>
<p>Let&#x27;s assume you have more than one network. This could be things like:</p>
<ul>
<li>Docker internal network(s) plus host machine</li>
<li>Brokers in the cloud (eg. AWS EC2), and on-premises machines locally (or even in another cloud)</li>
</ul>
<p>You need to tell Kafka how the brokers can reach each other, but also make sure that external clients (producers/consumers) can reach the broker they need to.</p>
<p>The key thing is that when you run a client, the broker you pass to it is just where it&#x27;s going to go and get the metadata about brokers in the cluster from. The actual host &amp; IP that it will connect to for reading/writing data is based on the data that the broker passes back in that initial connection - even if it&#x27;s just a single node and the broker returned is the same as the one connected to.</p>
<p>For configuring this correctly, you need to understand that Kafka brokers can have multiple <em>listeners</em>. A listener is a combination of</p>
<ol>
<li>Host/IP</li>
<li>Port</li>
<li>Protocol</li>
</ol>
<p>Let&#x27;s check out some config. Often the protocol is used for the listener name too, but here let&#x27;s make it nice and clear by using abstract names for the listeners:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KAFKA_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KAFKA_ADVERTISED_LISTENERS: LISTENER_BOB://kafka0:29092,LISTENER_FRED://localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: LISTENER_BOB:PLAINTEXT,LISTENER_FRED:PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KAFKA_INTER_BROKER_LISTENER_NAME: LISTENER_BOB</span><br></span></code></pre></div></div>
<p><em>I&#x27;m using the Docker config names - the equivalents if you&#x27;re configuring server.properties directly (e.g. on AWS etc) are shown indented in the following list</em></p>
<ul>
<li>KAFKA_LISTENERS is a comma-separated list of listeners, and the host/ip and port to which Kafka binds to on which to listen. For more complex networking this might be an IP address associated with a given network interface on a machine. The default is 0.0.0.0, which means listening on all interfaces. - <code>listeners</code></li>
<li>KAFKA_ADVERTISED_LISTENERS is a comma-separated list of listeners with their the host/ip and port. This is the metadata that&#x27;s passed back to clients. - <code>advertised.listeners</code></li>
<li>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP defines key/value pairs for the security protocol to use, per listener name. - <code>listener.security.protocol.map</code></li>
</ul>
<p><em>Kafka brokers communicate between themselves</em>, usually on the internal network (e.g. Docker network, AWS VPC, etc). To define which listener to use, specify KAFKA_INTER_BROKER_LISTENER_NAME (inter.broker.listener.name). The host/IP used must be accessible from the broker machine to others.</p>
<p>Kafka <em>clients</em> may well not be local to the broker&#x27;s network, and this is where the additional listeners come in.</p>
<p>Each listener will, when connected to, report back the address on which it can be reached. <em>The address on which you reach a broker depends on the network used</em>. If you&#x27;re connecting to the broker from an internal network it&#x27;s going to be a different host/IP than when connecting externally.</p>
<p>When connecting to a broker, the listener that will be returned to the client will be the listener to which you connected (based on the port).</p>
<p>kafkacat is a useful tool for exploring this. Using <code>-L</code> you can see the metadata for the listener to which you connected. Based on the same listener config as above (LISTENER_BOB / LISTENER_FRED), check out the respective entries for <strong>broker 0 at</strong>: -</p>
<ul>
<li>Connecting on port 9092 (which we map as LISTENER_FRED), the broker&#x27;s address is given back as localhost</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kafkacat -b kafka0:9092 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Metadata for all topics (from broker -1: kafka0:9092/bootstrap):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># broker 0 at localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Connecting on port 29092 (which we map as LISTENER_BOB), the brokers address is given back as kafka0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafkacat -b kafka0:29092 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Metadata for all topics (from broker 0: kafka0:29092/0):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># broker 0 at kafka0:29092</span><br></span></code></pre></div></div>
<p>You can also use tcpdump to examine the traffic from a client connecting to the broker, and spot the hostname that&#x27;s returned from the broker.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-can-i-connect-to-the-broker-but-the-client-still-fails">Why can I connect to the broker, but the client still fails?<a href="#why-can-i-connect-to-the-broker-but-the-client-still-fails" class="hash-link" aria-label="Direct link to Why can I connect to the broker, but the client still fails?" title="Direct link to Why can I connect to the broker, but the client still fails?">​</a></h2>
<p><em>tl;dr</em> Even if you can make the initial connection to the broker, the address returned in the metadata may still be for a hostname that is not accessible from your client.</p>
<p>Let&#x27;s walk this through step by step.</p>
<ol>
<li>We&#x27;ve got a broker on AWS. We want to send a message to it from our laptop. We know the external hostname for the EC2 instance (ec2-54-191-84-122.us-west-2.compute.amazonaws.com). We&#x27;ve created the necessary entry in the security group to open the broker&#x27;s port to our inbound traffic. We do smart things like checking that our local machine can connect to the port on the AWS instance:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ nc -vz ec2-54-191-84-122.us-west-2.compute.amazonaws.com 9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">found 0 associations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">found 1 connections:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1: flags=82&lt;CONNECTED,PREFERRED&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">outif utun5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">src 172.27.230.23 port 53352</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dst 54.191.84.122 port 9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rank info not available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TCP aux info available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection to ec2-54-191-84-122.us-west-2.compute.amazonaws.com port 9092 [tcp/XmlIpcRegSvc] succeeded!</span><br></span></code></pre></div></div>
<p>Things are looking good! We run:</p>
<p><code>echo &quot;test&quot;|kafka-console-producer --broker-list ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 --topic test</code></p>
<p>Now... what happens next?</p>
<ol start="2">
<li>
<p>Our laptop resolves ec2-54-191-84-122.us-west-2.compute.amazonaws.com successfully (to the IP address 54.191.84.122), and connects to the AWS machine on port 9092</p>
</li>
<li>
<p>The broker receives the inbound connection on port 9092. <em>It returns the metadata to the client, with the hostname ip-172-31-18-160.us-west-2.compute.internal</em> because this is the host name of the broker and the default value for listeners.</p>
</li>
<li>
<p>The client the tries to send data to the broker using the metadata it was given. Since ip-172-31-18-160.us-west-2.compute.internal is not resolvable from the internet, it fails.</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo &quot;test&quot;|kafka-console-producer --broker-list ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 --topic test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;[2018-07-30 15:08:41,932] ERROR Error when sending message to topic test with key: null, value: 4 bytes with error: (org.apache.kafka.clients.producer.internals.ErrorLoggingCallback)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">org.apache.kafka.common.errors.TimeoutException: Expiring 1 record(s) for test-0: 1547 ms has passed since batch creation plus linger time</span><br></span></code></pre></div></div>
<ol start="5">
<li>Puzzled, we try the same thing from the broker machine itself:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ echo &quot;foo&quot;|kafka-console-producer --broker-list ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 --topic test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kafka-console-consumer --bootstrap-server ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 --topic test --from-beginning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo</span><br></span></code></pre></div></div>
<p>It works fine! That&#x27;s because we are connecting to port 9092, which is configured as the <em>internal</em> listener, and thus reports back its hostname as ip-172-31-18-160.us-west-2.compute.internal which <em>is</em> resolvable from the broker machine (since it&#x27;s its own hostname!)</p>
<ol start="6">
<li>We can make life even easier by using <a href="https://docs.confluent.io/current/app-development/kafkacat-usage.html" target="_blank" rel="noopener noreferrer">kafkacat</a>. Using the -L flag we can see the metadata returned by the broker:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kafkacat -b ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata for all topics (from broker -1: ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092/bootstrap):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker 0 at ip-172-31-18-160.us-west-2.compute.internal:9092</span><br></span></code></pre></div></div>
<p>Clear as day, the <em>internal</em> hostname is returned. This also makes this seemingly-confusing error make a lot more sense - connecting to one hostname, getting a lookup error on another:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kafkacat -b ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092 -C -t test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">% ERROR: Local: Host resolution failure: ip-172-31-18-160.us-west-2.compute.internal:9092/0: Failed to resolve &#x27;ip-172-31-18-160.us-west-2.compute.internal:9092&#x27;: nodename nor servname provided, or not known</span><br></span></code></pre></div></div>
<p>Here we&#x27;re using kafkacat in producer mode (-C) from our local machine to try and read from the topic. As before, because we&#x27;re getting the <em>internal</em> listener hostname back from the broker in the metadata, the client cannot resolve that hostname to read/write from.</p>
<p>I saw a StackOverflow answer suggesting to just update my hosts file...isn&#x27;t that easier?</p>
<p>This is nothing more than a hack to workaround a mis-configuration, instead of actually fixing it.</p>
<p>If the broker is reporting back a hostname to which the client cannot connect, then hardcoding the hostname/IP combo into the local /etc/hosts may seem a nice fix. But this is a very brittle and manual solution. What happens when the IP changes, when you move hosts and forget to take the little hack with you, when other people want to do the same?</p>
<p>Much better is to understand and actually fix the advertised.listeners setting for your network.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="howto-connecting-to-kafka-on-docker">HOWTO: Connecting to Kafka on Docker<a href="#howto-connecting-to-kafka-on-docker" class="hash-link" aria-label="Direct link to HOWTO: Connecting to Kafka on Docker" title="Direct link to HOWTO: Connecting to Kafka on Docker">​</a></h2>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Listeners-image1-cdc6fddaeed7c9f176c6f1f3b183af77.jpg" width="999" height="489" class="img_ev3q"></p>
<p>Run within Docker, you will need to configure two listeners for Kafka:</p>
<ol>
<li>Communication <em>within the Docker network</em>. This could be inter-broker communication (i.e. between brokers), and between other components running in Docker such as Kafka Connect, or third-party clients or producers.</li>
</ol>
<p>For these comms, we need to use <em>the hostname of the Docker container(s)</em>. Each Docker container on the same Docker network will use the hostname of the Kafka broker container to reach it</p>
<ol start="2">
<li>Non-Docker network traffic. This could be clients running local on the Docker host machine, for example. The assumption is that they will connect on localhost, to a port exposed from the Docker container.</li>
</ol>
<p>Here&#x27;s the docker-compose snippet:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">kafka0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;confluentinc/cp-enterprise-kafka:5.0.0-rc3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;9092:9092&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">depends_on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> zookeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">KAFKA_ADVERTISED_LISTENERS</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LISTENER_BOB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//kafka0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">29092</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">LISTENER_FRED</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">9092</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> LISTENER_BOB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">LISTENER_FRED</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">...</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre></div></div>
<ol start="3">
<li>
<p>Clients <em>within</em> the Docker network connect using listener &quot;BOB&quot;, with port 29092 and hostname kafka0. In doing so, they get back the hostname kafka0 to which to connect. Each docker container will resolve kafka0 using Docker&#x27;s internal network, and be able to reach the broker.</p>
</li>
<li>
<p>Clients <em>external</em> to the Docker network connect using listener &quot;FRED&quot;, with port 9092 and hostname localhost. Port 9092 is exposed by the Docker container and so available to connect to. When clients connect, they are given the hostname localhost for the broker&#x27;s metadata, and so connect to this when reading/writing data.</p>
</li>
<li>
<p>The above configuration would <em>not</em> handle the scenario in which a client external to Docker <em>and</em> external to the host machine wants to connect. This is because neither kafka0 (the internal Docker hostname) <em>or</em> localhost (the loopback address for the Docker host machine) would be resolvable.</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="howto-connecting-to-kafka-on-awsiaas">HOWTO: Connecting to Kafka on AWS/IaaS<a href="#howto-connecting-to-kafka-on-awsiaas" class="hash-link" aria-label="Direct link to HOWTO: Connecting to Kafka on AWS/IaaS" title="Direct link to HOWTO: Connecting to Kafka on AWS/IaaS">​</a></h2>
<p><em>I&#x27;m naming AWS because it&#x27;s what the majority of people use, but this applies to any IaaS/Cloud solution.</em></p>
<p>Exactly the same concepts apply here as with Docker. The main difference is that whilst with Docker the external connections may well be just on localhost (as above), with Cloud-hosted Kafka (such as on AWS) the external connection will be from a machine not local to to the broker and which will need to be able to connect to the broker.</p>
<p>A further complication is that whilst Docker networks are heavily segregated from the host&#x27;s, on IaaS often the <em>external</em> hostname is resolvable <em>internally</em>, making it hit and miss when you may actually encounter these problems.</p>
<p>There are two approaches, depending on whether the external address through which you&#x27;re going to connect to the broker is also resolvable locally to all of the brokers on the network (e.g VPC).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-1---external-address-is-resolvable-locally">Option 1 - external address IS resolvable locally<a href="#option-1---external-address-is-resolvable-locally" class="hash-link" aria-label="Direct link to Option 1 - external address IS resolvable locally" title="Direct link to Option 1 - external address IS resolvable locally">​</a></h3>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Listeners-image2-09a813ff0eaa407bbc9a52bab2feb3a9.jpg" width="999" height="536" class="img_ev3q"></p>
<p>You can get by with one listener here. The existing listener, called PLAINTEXT, just needs overriding to set the advertised hostname (i.e. the one that is passed to inbound clients)</p>
<p><code>advertised.listeners=PLAINTEXT://ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092</code></p>
<p>Now connections both internally and externally will use ec2-54-191-84-122.us-west-2.compute.amazonaws.com for connecting. Because ec2-54-191-84-122.us-west-2.compute.amazonaws.com can be resolved both locally and externally, things work fine.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="option-2---external-address-is-not-resolvable-locally">Option 2 - external address is NOT resolvable locally<a href="#option-2---external-address-is-not-resolvable-locally" class="hash-link" aria-label="Direct link to Option 2 - external address is NOT resolvable locally" title="Direct link to Option 2 - external address is NOT resolvable locally">​</a></h3>
<p>You will need to configure two listeners for Kafka:</p>
<ol>
<li>Communication <em>within the AWS network (VPC)</em>. This could be inter-broker communication (i.e. between brokers), and between other components running in the VPC such as Kafka Connect, or third-party clients or producers.</li>
</ol>
<p>For these comms, we need to use <em>the internal IP of the EC2 machine</em> (or hostname, if DNS is configured).</p>
<ol start="2">
<li>External AWS traffic. This could be testing connectivity from a laptop, or simply from machines not hosted in Amazon. In both cases, the external IP of the instance needs to be used (or hostname, if DNS is configured).</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image" src="/assets/images/Technologies-Kafka-Kafka-Listeners-image3-72ddcec88af849a23399edff71eedca7.jpg" width="999" height="701" class="img_ev3q"></p>
<p>Here&#x27;s an example configuration:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">listeners=INTERNAL://0.0.0.0:19092,EXTERNAL://0.0.0.0:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">listener.security.protocol.map=INTERNAL:PLAINTEXT,EXTERNAL:PLAINTEXT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">advertised.listeners=INTERNAL://ip-172-31-18-160.us-west-2.compute.internal:19092,EXTERNAL://ec2-54-191-84-122.us-west-2.compute.amazonaws.com:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inter.broker.listener.name=INTERNAL</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="exploring-listeners-with-docker">Exploring listeners with Docker<a href="#exploring-listeners-with-docker" class="hash-link" aria-label="Direct link to Exploring listeners with Docker" title="Direct link to Exploring listeners with Docker">​</a></h2>
<p>Take a look at <a href="https://github.com/rmoff/kafka-listeners" target="_blank" rel="noopener noreferrer">https://github.com/rmoff/kafka-listeners</a>. This includes a docker-compose to bring up a Zookeeper instance along with Kafka broker configured with several listeners.</p>
<ul>
<li>Listener BOB (port 29092) for internal traffic on the Docker network</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -t --network kafka-listeners_default confluentinc/cp-kafkacat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafkacat -b kafka0:29092 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata for all topics (from broker 0: kafka0:29092/0):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker 0 at kafka0:29092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Listener FRED (port 9092) for traffic from the Docker-host machine (localhost)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -t --network kafka-listeners_default confluentinc/cp-kafkacat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafkacat -b kafka0:9092 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata for all topics (from broker -1: kafka0:9092/bootstrap):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker 0 at localhost:9092</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Listener ALICE (port 29094) for traffic from outside, reaching the Docker host on the DNS name never-gonna-give-you-up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ docker run -t --network kafka-listeners_default confluentinc/cp-kafkacat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kafkacat -b kafka0:29094 -L</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Metadata for all topics (from broker -1: kafka0:29094/bootstrap):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 brokers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">broker 0 at never-gonna-give-you-up:29094</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p><a href="https://rmoff.net/2018/08/02/kafka-listeners-explained" target="_blank" rel="noopener noreferrer">https://rmoff.net/2018/08/02/kafka-listeners-explained</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/technologies/kafka/kafka-listeners.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-02-05T13:57:42.000Z" itemprop="dateModified">Feb 5, 2025</time></b> by <b>Deepak</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/technologies/kafka/kafka-consumers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kafka Consumers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/technologies/kafka/kafka-producers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kafka Producers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#is-anyone-listening" class="table-of-contents__link toc-highlight">Is anyone listening?</a></li><li><a href="#why-can-i-connect-to-the-broker-but-the-client-still-fails" class="table-of-contents__link toc-highlight">Why can I connect to the broker, but the client still fails?</a></li><li><a href="#howto-connecting-to-kafka-on-docker" class="table-of-contents__link toc-highlight">HOWTO: Connecting to Kafka on Docker</a></li><li><a href="#howto-connecting-to-kafka-on-awsiaas" class="table-of-contents__link toc-highlight">HOWTO: Connecting to Kafka on AWS/IaaS</a><ul><li><a href="#option-1---external-address-is-resolvable-locally" class="table-of-contents__link toc-highlight">Option 1 - external address IS resolvable locally</a></li><li><a href="#option-2---external-address-is-not-resolvable-locally" class="table-of-contents__link toc-highlight">Option 2 - external address is NOT resolvable locally</a></li></ul></li><li><a href="#exploring-listeners-with-docker" class="table-of-contents__link toc-highlight">Exploring listeners with Docker</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Deep Notes, Built with ❤️</div></div></div></footer></div>
</body>
</html>