"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6682],{603905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(667294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),d=r,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||l;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},266966:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var a=n(487462),r=(n(667294),n(603905));const l={},i="System Design - TinyURL",o={unversionedId:"computer-science/interview-question/system-design-tinyurl",id:"computer-science/interview-question/system-design-tinyurl",title:"System Design - TinyURL",description:"System Design : Design a service like TinyUrl",source:"@site/docs/computer-science/interview-question/system-design-tinyurl.md",sourceDirName:"computer-science/interview-question",slug:"/computer-science/interview-question/system-design-tinyurl",permalink:"/computer-science/interview-question/system-design-tinyurl",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/computer-science/interview-question/system-design-tinyurl.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"System Design - Parking Lot",permalink:"/computer-science/interview-question/system-design-parking-lot"},next:{title:"System Design - Twitter",permalink:"/computer-science/interview-question/system-design-twitter"}},s={},u=[{value:"Problem Statement - Given a long url return a short url, and given a short url return the corresponding long url",id:"problem-statement---given-a-long-url-return-a-short-url-and-given-a-short-url-return-the-corresponding-long-url",level:2},{value:"API",id:"api",level:2},{value:"Application layer",id:"application-layer",level:2},{value:"Load Balancer",id:"load-balancer",level:2},{value:"Worker URL",id:"worker-url",level:2},{value:"Cache",id:"cache",level:2},{value:"How to generate a tinyURL",id:"how-to-generate-a-tinyurl",level:2},{value:"Database",id:"database",level:2},{value:"Non Functional",id:"non-functional",level:2},{value:"Functional",id:"functional",level:2},{value:"Capacity Estimation",id:"capacity-estimation",level:2},{value:"Cache",id:"cache-1",level:2}],p={toc:u},c="wrapper";function m(e){let{components:t,...l}=e;return(0,r.kt)(c,(0,a.Z)({},p,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"system-design---tinyurl"},"System Design - TinyURL"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=fMZMm_0ZhK4"},"System Design : Design a service like TinyUrl")),(0,r.kt)("h2",{id:"problem-statement---given-a-long-url-return-a-short-url-and-given-a-short-url-return-the-corresponding-long-url"},"Problem Statement - Given a long url return a short url, and given a short url return the corresponding long url"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"How to generate 7-8 Characters long and is unique"),(0,r.kt)("li",{parentName:"ul"},"How to design the persistance layer (where you would store the short url and long url)")),(0,r.kt)("h2",{id:"api"},"API"),(0,r.kt)("p",null,"createTiny(longUrl) -> tinyUrl"),(0,r.kt)("p",null,"getLong(tinyUrl) -> longUrl"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Add Expiration time")),(0,r.kt)("h2",{id:"application-layer"},"Application layer"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:n(359135).Z,width:"1101",height:"680"})),(0,r.kt)("h2",{id:"load-balancer"},"Load Balancer"),(0,r.kt)("p",null,"Delegate requests to one of the worker threads"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Software"),(0,r.kt)("li",{parentName:"ul"},"Software + Hardware")),(0,r.kt)("h2",{id:"worker-url"},"Worker URL"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Take longer url generate tiny url and store it in persistance layer and return tiny url")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Take shorter url fetch it's corresponding long url and return back long url."))),(0,r.kt)("h2",{id:"cache"},"Cache"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"memcached"),(0,r.kt)("li",{parentName:"ul"},"redis")),(0,r.kt)("h2",{id:"how-to-generate-a-tinyurl"},"How to generate a tinyURL"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Characters - a-zA-Z0-9 (Use a BASE 62 encoding since A-Za-z0-9 total are 62 characters.)"),(0,r.kt)("li",{parentName:"ul"},"Length of generated tinyURL - 7 characters long"),(0,r.kt)("li",{parentName:"ul"},"Total combinations - 62^7 - 3.5 trillion (million requests/second - 40 days, 1000 requests/second - 110 years exhaust)"),(0,r.kt)("li",{parentName:"ul"},"Any number from 0 to 3.5 trillion can be represented by 43 bits\n",(0,r.kt)("img",{alt:"image",src:n(784021).Z,width:"1100",height:"640"}))),(0,r.kt)("h2",{id:"database"},"Database"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Key as tiny url"),(0,r.kt)("li",{parentName:"ul"},"value as longer url")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Generate random tiny url & check db"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Technique 1")))),(0,r.kt)("p",null,"get a random tiny url and put tiny url with long url in database."),(0,r.kt)("p",null,"Problem - Other worker thread can do the same"),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Technique 2")),(0,r.kt)("p",null,"Put if absent"),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Technique 3")),(0,r.kt)("p",null,"put (tiny, long)"),(0,r.kt)("p",null,"get(tiny) - if both are same than service worker is done"),(0,r.kt)("p",null,"Otherwise again do put(tiny, long) and repeat"),(0,r.kt)("p",null,"Problem - For every put you have to do atleast one get.\n2. Pick first 43 bits of MD5"),(0,r.kt)("p",null,"We calculate the MD5 of longer url then take the first 43 bits of that md5 and use that to generate the tiny url"),(0,r.kt)("p",null,"MD5 is a hashing function that generate 128 bit long hash."),(0,r.kt)("p",null,"Probability of collision - smaller if more bits are taken, but than the length of tiny url gets longer.\nUse md5 to generate tinyurl and than check database for collision.\nAdvantage of random generation vs MD5"),(0,r.kt)("p",null,"Save some space in database"),(0,r.kt)("p",null,"If two users want to generate two tiny urls for same long string, so in 1st technique there will be two tiny urls with 2 records, but in 2nd technique both will have same MD5 with same first 43 bits so we can have some ",(0,r.kt)("strong",{parentName:"p"},"deduping (to remove duplicate entries from a list or database),")," so we have to store only one row instead of two row in the database.\nConvert 43 bits to 7 characters long url"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Convert 43 bits binray to decimal")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Convert decimal to base 62 (divide by 62 and mod by 62) - will get number from 0 to 61")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Map 0 - 61 to characters")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Counter"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Single Host"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"a single maintainer is responsible to maintain the counter"),(0,r.kt)("li",{parentName:"ul"},"Can be a database or a zookeeper instance"),(0,r.kt)("li",{parentName:"ul"},"Every worker thread requests a counter maintainer to give it a counter, and using that counter worker creates the tiny url"),(0,r.kt)("li",{parentName:"ul"},"Problem - Single point of contact, single point of failure, single point of bottleneck"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"All Host"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Every worker will be responsible to generate a unique number according to there worker id, timestamp and some uniqueness"),(0,r.kt)("li",{parentName:"ul"},"Problem - Can cause collision if requests increases"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Range Based"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"     - We divide the total 3.5 trillion combinations into ranges, every worker will be alloted each range. Ranges can be divided into billions which will also be divided into millions\n     - These all allotments of ranges is maintained by zookeeper\n     - It guarantees that there are no collisions.\n     - Also can add some random bits to increase security.\n")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("img",{alt:"image",src:n(302791).Z,width:"1098",height:"569"}),"\nGet requests can be cached using CDN\n",(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=josjRSBqEBI"},"Paste bin system design | Software architecture for paste bin")))))),(0,r.kt)("h2",{id:"non-functional"},"Non Functional"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Durability"),(0,r.kt)("li",{parentName:"ul"},"HA"),(0,r.kt)("li",{parentName:"ul"},"Low latency")),(0,r.kt)("h2",{id:"functional"},"Functional"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Paste + Size max 10 MB"),(0,r.kt)("li",{parentName:"ul"},"Custom URL Path"),(0,r.kt)("li",{parentName:"ul"},"Paste expiry"),(0,r.kt)("li",{parentName:"ul"},"User login / Anonymous")),(0,r.kt)("h2",{id:"capacity-estimation"},"Capacity Estimation"),(0,r.kt)("p",null,"Assumptions"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Pastes: 100K / day"),(0,r.kt)("li",{parentName:"ul"},"Reads: 10X per paste\nTraffic")),(0,r.kt)("p",null,"Hits: 100000/24 = 4166.6667 / hour"),(0,r.kt)("p",null,"100000/(24*3600) = 1.1574 / sec"),(0,r.kt)("p",null,"Read: 1000000/(24*3600) = 11.5741 / sec"),(0,r.kt)("p",null,"Buffer: 30% more = 20 rps\nData Storage"),(0,r.kt)("p",null,"10 MB * 100K = 1000 GB / day (worst)"),(0,r.kt)("p",null,"100 KB * 100K = 10 GB / day (avg)"),(0,r.kt)("p",null,"365 * 1000GB = 365 TB / year"),(0,r.kt)("h2",{id:"cache-1"},"Cache"),(0,r.kt)("p",null,"Save key, s3 location, along with some amount of data, that can quickly show some data to user while full data is fetched from s3\nPaste"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pasteid"),(0,r.kt)("li",{parentName:"ul"},"content"),(0,r.kt)("li",{parentName:"ul"},"s3_link"),(0,r.kt)("li",{parentName:"ul"},"created_at"),(0,r.kt)("li",{parentName:"ul"},"expire_at\nUser"),(0,r.kt)("li",{parentName:"ul"},"id"),(0,r.kt)("li",{parentName:"ul"},"name"),(0,r.kt)("li",{parentName:"ul"},"created"),(0,r.kt)("li",{parentName:"ul"},"metadata\n",(0,r.kt)("img",{alt:"image",src:n(908920).Z,width:"1162",height:"734"}),"\nDKGS - Distributed Key Generation Service")),(0,r.kt)("p",null,"8 byte/8char"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Millisec timestamp - 41 bits"),(0,r.kt)("li",{parentName:"ul"},"Node ID - 10 bits"),(0,r.kt)("li",{parentName:"ul"},"Local counter in each node - 12 bits"),(0,r.kt)("li",{parentName:"ul"},"= 64 bit random id for each key\nAsync cleanup service"),(0,r.kt)("li",{parentName:"ul"},"Every hour run through whole database to get expired keys and delete the same from s3/blob storage")))}m.isMDXComponent=!0},359135:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/System-Design-TinyURL-image1-1d2554745932d621b74052c632a713a6.jpg"},784021:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/System-Design-TinyURL-image2-0022a4984adeac5b85a725ef00b3ceda.jpg"},302791:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/System-Design-TinyURL-image3-286fcbb3a8130157466101dd02fbd8f0.jpg"},908920:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/System-Design-TinyURL-image4-0605f045bb1a4905cfa2d78b2909763d.jpg"}}]);