"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[37088],{603905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(667294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),m=o,f=d["".concat(s,".").concat(m)]||d[m]||u[m]||i;return n?r.createElement(f,a(a({ref:t},c),{},{components:n})):r.createElement(f,a({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:o,a[1]=l;for(var p=2;p<i;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},927751:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=n(487462),o=(n(667294),n(603905));const i={},a="Dockerfile example",l={unversionedId:"devops/docker/dockerfile-example",id:"devops/docker/dockerfile-example",title:"Dockerfile example",description:"GitHub - irbigdata/data-dockerfiles: a curated list of docker-compose files prepared for testing  data engineering tools, databases and open source libraries.",source:"@site/docs/devops/docker/dockerfile-example.md",sourceDirName:"devops/docker",slug:"/devops/docker/dockerfile-example",permalink:"/devops/docker/dockerfile-example",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/devops/docker/dockerfile-example.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"docker-compose",permalink:"/devops/docker/docker-compose"},next:{title:"Dockerfiles",permalink:"/devops/docker/dockerfiles"}},s={},p=[{value:"Example 1",id:"example-1",level:2},{value:"Example 2",id:"example-2",level:2},{value:"Python - Multistage builds",id:"python---multistage-builds",level:3},{value:"NODE JS Dockerfile",id:"node-js-dockerfile",level:3},{value:"ENV PYTHONUNBUFFERED 1",id:"env-pythonunbuffered-1",level:3},{value:"Go Dockerfile",id:"go-dockerfile",level:3},{value:"Flask Dockerfile",id:"flask-dockerfile",level:3}],c={toc:p},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"dockerfile-example"},"Dockerfile example"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/irbigdata/data-dockerfiles"},"GitHub - irbigdata/data-dockerfiles: a curated list of docker-compose files prepared for testing  data engineering tools, databases and open source libraries.")),(0,o.kt)("h2",{id:"example-1"},"Example 1"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# Use an official Python runtime as a parent image\n# https://pythonspeed.com/articles/base-image-python-docker-images/\nFROM python:3.7.6-slim\nFROM python:3.8-slim-buster\n\nENV DEBUG False\nENV TZ=Asia/Kolkata\nENV PYTHONUNBUFFERED 1\n\n# Only requirements.txt is copied so Docker build cache doesn't get invalidated\n# every time we change other files in the project\nCOPY requirements.txt /root/kafkaconsumer/requirements.txt\n\n# Set the working directory to /app\nWORKDIR /root/kafkaconsumer\n\n# Install any needed packages specified in requirements.txt\nRUN pip install --trusted-host pypi.python.org -r requirements.txt\n\n# Copy the current directory contents into the container at /app\nCOPY scripts /root/kafkaconsumer\n")),(0,o.kt)("h2",{id:"example-2"},"Example 2"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"FROM ubuntu:latest\n\nARG GIT_USERNAME\nARG GIT_PASSWORD\n\nENV DEBIAN_FRONTEND=noninteractive \\\n    TZ=Asia/Kolkata\nENV PYTHONUNBUFFERED 1\n\nRUN sed -i -e 's/http:\\/\\/archive/mirror:\\/\\/mirrors/' -e 's/http:\\/\\/security/mirror:\\/\\/mirrors/' -e 's/\\/ubuntu\\//\\/mirrors.txt/' /etc/apt/sources.list && \\\n    echo \"Acquire {http {Timeout \\\"60\\\";}; ftp {Timeout \\\"60\\\";};};\" > /etc/apt/apt.conf.d/custom-apt.conf && \\\n    apt-get update && apt-get dist-upgrade --yes && \\\n apt-get install -y libpng-dev libjpeg8-dev libfreetype6-dev python-dev python-pip libfreetype6-dev && \\\n apt-get install -y libpq-dev libssl-dev libcurl4-openssl-dev  libxft-dev libev-dev git curl vim p7zip-full && \\\n    apt-get install -y swig openssl libffi-dev libssl-dev check automake build-essential zlib1g zlib1g-dev autoconf libtool && \\\n    apt-get install -y libdb4.8 libdb++-dev libprotobuf-c1 libprotobuf-c-dev protobuf-c-compiler openvpn iputils-ping && \\\n    pip install --no-cache-dir --upgrade 'pip==10' && \\\n apt-get autoremove -y && apt-get clean -y && \\\n    rm -rf /var/lib/apt/lists/*\n\n#SMAP Section begin\nCOPY ./smap/ /root/smap/\nRUN pip install --no-cache-dir requests [security] 'Twisted [tls]==16.0.0' pyopenssl && \\\n    pip install --no-cache-dir -r /root/smap/python/requirements.txt && \\\n    cd /root/smap/python && python setup.py install\n#SMAP Section end\n\nCOPY requirements.txt /root/requirements.txt\nRUN pip install --no-cache-dir --trusted-host pypi.python.org -r /root/requirements.txt && \\\n    curl \"https://rclone.org/install.sh\" | bash\n\n#For airflow\nRUN pip install --no-cache-dir Flask==1.1.1\n\nCOPY ./Docker/analytics/jupyter_notebook_config.py /root/.jupyter/jupyter_notebook_config.py\n\nCOPY id_rsa id_rsa.pub /root/.ssh/\nRUN chmod 600 ~/.ssh/id_rsa*\n\nADD . /root/example/\n\nEXPOSE 5555 8070 8071 8080 8888 9104\n")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.docker.com/develop/develop-images/dockerfile_best-practices"},"https://docs.docker.com/develop/develop-images/dockerfile_best-practices")),(0,o.kt)("h3",{id:"python---multistage-builds"},"Python - Multistage builds"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://blog.realkinetic.com/building-minimal-docker-containers-for-python-applications-37d0272c52f3"},"https://blog.realkinetic.com/building-minimal-docker-containers-for-python-applications-37d0272c52f3")),(0,o.kt)("h3",{id:"node-js-dockerfile"},"NODE JS Dockerfile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"FROM node:14-alpine AS builder\nWORKDIR '/app'\nCOPY package.json .\nRUN npm install\nCOPY . .\nRUN npm run build\n\nFROM nginx\nEXPOSE 80\nCOPY --from=builder /app/build /usr/share/nginx/html\n")),(0,o.kt)("h3",{id:"env-pythonunbuffered-1"},"ENV PYTHONUNBUFFERED 1"),(0,o.kt)("p",null,'Setting PYTHONUNBUFFERED=TRUE or PYTHONUNBUFFERED=1 (they are equivalent) allows for log messages to be immediately dumped to the stream instead of being buffered. This is useful for receiving timely log messages and avoiding situations where the application crashes without emitting a relevant message due to the message being "stuck" in a buffer.'),(0,o.kt)("p",null,"As for performance, there can be some (minor) loss that comes with using unbuffered I/O. To mitigate this, I would recommend limiting the number of log messages. If it is a significant concern, one can always leave buffered I/O on and manually flush the buffer when necessary."),(0,o.kt)("h3",{id:"go-dockerfile"},"Go Dockerfile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'FROM golang:1.14-alpine as build\n\nRUN apk add --no-cache git\n\nWORKDIR /src\n\nRUN go get github.com/julienschmidt/httprouter\nRUN go get github.com/sirupsen/logrus\nRUN go get github.com/streadway/amqp\n\nCOPY publisher.go /src\n\nRUN go build publisher.go\n\nFROM alpine as runtime\n\nCOPY --from=build /src/publisher /app/publisher\n\nCMD [ "/app/publisher" ]\n')),(0,o.kt)("h3",{id:"flask-dockerfile"},"Flask Dockerfile"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"FROM python:3.8-slim-buster\nENV TZ=Asia/Kolkata\n\n# Set the working directory to /app\nWORKDIR /app\n\n# Only requirements.txt is copied so Docker build cache doesn't get invalidated\n# every time we change other files in the project\nCOPY requirements.txt /app/requirements.txt\n\n# Install any needed packages specified in requirements.txt\nRUN pip install --trusted-host pypi.python.org -r /app/requirements.txt\n\n# Copy the current directory contents into the container at /app\nCOPY src /app/src\n")))}u.isMDXComponent=!0}}]);