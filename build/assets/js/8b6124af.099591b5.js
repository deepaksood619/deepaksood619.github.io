"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[21787],{603905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var r=n(667294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),g=a,d=p["".concat(l,".").concat(g)]||p[g]||h[g]||o;return n?r.createElement(d,i(i({ref:t},u),{},{components:n})):r.createElement(d,i({ref:t},u))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:a,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},883642:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var r=n(487462),a=(n(667294),n(603905));const o={},i="Concepts",s={unversionedId:"languages/golang/concepts",id:"languages/golang/concepts",title:"Concepts",description:"Goroutines & Channels",source:"@site/docs/languages/golang/concepts.md",sourceDirName:"languages/golang",slug:"/languages/golang/concepts",permalink:"/languages/golang/concepts",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/languages/golang/concepts.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"golang",permalink:"/languages/golang/"},next:{title:"Data Types",permalink:"/languages/golang/data-types"}},l={},c=[{value:"Goroutines &amp; Channels",id:"goroutines--channels",level:2},{value:"Start from the bottom",id:"start-from-the-bottom",level:2},{value:"Blocking is fine",id:"blocking-is-fine",level:2},{value:"Don&#39;t interrupt",id:"dont-interrupt",level:2},{value:"Pointers in Go",id:"pointers-in-go",level:2}],u={toc:c},p="wrapper";function h(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"concepts"},"Concepts"),(0,a.kt)("h2",{id:"goroutines--channels"},"Goroutines & Channels"),(0,a.kt)("p",null,"The native support for concurrency and parallelism. This makes Go an ideal candidate for applications that require heavy concurrent and/or parallel processing, networking and so on. Goroutines makes it so easy to start lightweight threads and channels provide a way to communicate between these threads acting like a message bus."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Goroutines")," represent concurrent tasks"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Channels")," are used to communicate between tasks"),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Select")," enables task synchronization")),(0,a.kt)("p",null,"Goroutines exists only in the virtual space of go runtime and not in the OS."),(0,a.kt)("p",null,"Hence, a Go Runtime scheduler is needed which manages their lifecycle."),(0,a.kt)("p",null,"Go Runtime maintains three C structs for this purpose:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"The G Struct:")," This represents a single go routine with it's properties such as stack pointer, base of stack, it's ID, it's cache and it's status")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"The M Struct:")," This represents an OS thread. It also contains a pointer to the global queue of runnable goroutines, the current running goroutine and the reference to the scheduler")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"The Sched Struct:")," It is a global struct and contains the queues free and waiting goroutines as well as threads."))),(0,a.kt)("p",null,"So, on startup, go runtime starts a number of goroutines for GC, scheduler and user code. An OS Thread is created to handle these goroutines. These threads can be at most equal to GOMAXPROCS."),(0,a.kt)("h2",{id:"start-from-the-bottom"},"Start from the bottom"),(0,a.kt)("p",null,"A goroutine is created with initial only 2KB of stack size. Each function in go already has a check if more stack is needed or not and the stack can be copied to another region in memory with twice the original size. This makes goroutine very light on resources."),(0,a.kt)("h2",{id:"blocking-is-fine"},"Blocking is fine"),(0,a.kt)("p",null,"If a goroutine blocks on system call, it blocks it's running thread. But another thread is taken from the waiting queue of Scheduler (the Sched struct) and used for other runnable goroutines."),(0,a.kt)("p",null,"However, if you communicate using channels in go which exists only in virtual space, the OS doesn't block the thread.Such goroutines simply go in the waiting state and other runnable goroutine (from the M struct) is scheduled in it's place."),(0,a.kt)("h2",{id:"dont-interrupt"},"Don't interrupt"),(0,a.kt)("p",null,"The go runtime scheduler does cooperative scheduling, which means another goroutine will only be scheduled if the current one is blocking or done. Some of these cases are:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Channel send and receive operations, if those operations would block."),(0,a.kt)("li",{parentName:"ul"},"The Go statement, although there is no guarantee that new goroutine will be scheduled immediately."),(0,a.kt)("li",{parentName:"ul"},"Blocking syscalls like file and network operations."),(0,a.kt)("li",{parentName:"ul"},"After being stopped for a garbage collection cycle.")),(0,a.kt)("p",null,"This is better than pre-emptive scheduling which uses timely system interrupts (e.g. every 10 ms) to block and schedule a new thread which may lead a task to take longer than needed to finish when number of threads increases or when a higher priority tasks need to be scheduled while a lower priority task is running."),(0,a.kt)("p",null,"Another advantage is that, since it is invoked implicitly in the code e.g. during sleep or channel wait, the compile only needs to safe/restore the registers which are alive at these points. In Go, this meansonly 3 registers i.e. PC, SP and DX (Data Registers) being updated during context switchrather than all registers (e.g. AVX, Floating Point, MMX)."),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://codeburst.io/why-goroutines-are-not-lightweight-threads-7c460c1f155f"},"https://codeburst.io/why-goroutines-are-not-lightweight-threads-7c460c1f155f")),(0,a.kt)("h2",{id:"pointers-in-go"},"Pointers in Go"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/conceptual_articles/understanding-pointers-in-go"},"https://www.digitalocean.com/community/conceptual_articles/understanding-pointers-in-go")))}h.isMDXComponent=!0}}]);