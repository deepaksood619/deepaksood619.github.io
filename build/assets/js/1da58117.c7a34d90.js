"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[65580],{603905:(e,n,a)=>{a.d(n,{Zo:()=>m,kt:()=>f});var t=a(667294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function s(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?s(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},s=Object.keys(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)a=s[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=t.createContext({}),p=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},m=function(e){var n=p(e.components);return t.createElement(i.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,f=c["".concat(i,".").concat(d)]||c[d]||u[d]||s;return a?t.createElement(f,o(o({ref:n},m),{},{components:a})):t.createElement(f,o({ref:n},m))}));function f(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=a.length,o=new Array(s);o[0]=d;var l={};for(var i in n)hasOwnProperty.call(n,i)&&(l[i]=n[i]);l.originalType=e,l[c]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<s;p++)o[p]=a[p];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"},656987:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>p});var t=a(487462),r=(a(667294),a(603905));const s={},o="Kubernetes Manifests Examples",l={unversionedId:"devops/kubernetes/kubernetes-manifests-examples",id:"devops/kubernetes/kubernetes-manifests-examples",title:"Kubernetes Manifests Examples",description:"Resource Schema Components (Manifests)",source:"@site/docs/devops/kubernetes/kubernetes-manifests-examples.md",sourceDirName:"devops/kubernetes",slug:"/devops/kubernetes/kubernetes-manifests-examples",permalink:"/devops/kubernetes/kubernetes-manifests-examples",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/devops/kubernetes/kubernetes-manifests-examples.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"KubeEdge",permalink:"/devops/kubernetes/kubeedge"},next:{title:"Operators",permalink:"/devops/kubernetes/operators"}},i={},p=[{value:"Resource Schema Components (Manifests)",id:"resource-schema-components-manifests",level:2},{value:"Configmap",id:"configmap",level:3},{value:"Service",id:"service",level:3},{value:"Deployments",id:"deployments",level:3},{value:"statefulsets",id:"statefulsets",level:3},{value:"Shared Volume Data between two containers",id:"shared-volume-data-between-two-containers",level:3},{value:"PVC",id:"pvc",level:3},{value:"Cronjob",id:"cronjob",level:3},{value:"Job",id:"job",level:3},{value:"HPA",id:"hpa",level:3}],m={toc:p},c="wrapper";function u(e){let{components:n,...s}=e;return(0,r.kt)(c,(0,t.Z)({},m,s,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"kubernetes-manifests-examples"},"Kubernetes Manifests Examples"),(0,r.kt)("h2",{id:"resource-schema-components-manifests"},"Resource Schema Components (Manifests)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"GVK (Group Version Kind) aka TypeMeta - apiVersion & Kind"),(0,r.kt)("li",{parentName:"ul"},"Metadata aka ObjectMeta"),(0,r.kt)("li",{parentName:"ul"},"Spec"),(0,r.kt)("li",{parentName:"ul"},"Status (only controllers fills it out)")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(358560).Z,width:"1102",height:"730"})),(0,r.kt)("h3",{id:"configmap"},"Configmap"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-configmap\n  namespace: zenalytix\ndata:\n  nginx.conf: |\n    user root;\n    worker_processes auto;\n    pid /var/run/nginx.pid;\n    error_log /var/log/nginx/error.log warn;\n    events {\n            worker_connections 2048;\n            # multi_accept on;\n    }\n\n---\n\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: loanetl-configmap\n  namespace: apps\ndata:\n  DEBUG: "False"\n\n  AWS_ACCESS_KEY_ID: "xxx"\n  AWS_SECRET_ACCESS_KEY: "xxx"\n\n  # aws redshift credentials"\n  REDSHIFT_DB_HOST: "host"\n  REDSHIFT_DB_PORT: "5439"\n  REDSHIFT_DB_DBNAME: "dbname"\n  REDSHIFT_DB_USER: "user"\n  REDSHIFT_DB_PASSWORD: "pass"\n')),(0,r.kt)("h3",{id:"service"},"Service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Service\nmetadata:\n name: nginx\n namespace: nginx\n labels:\n  name: nginx\nspec:\n type: LoadBalancer / ClusterIP\n ports:\n  - port: 80\n  targetPort: 80\n  protocol: TCP\n  name: http\n selector:\n  name: nginx\n")),(0,r.kt)("h3",{id:"deployments"},"Deployments"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    name: flask-republisher\n  name: flask-republisher\n  namespace: consumers\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      name: flask-republisher\n  minReadySeconds: 10\n  strategy:\n type: RollingUpdate\n rollingUpdate:\n   maxSurge: 1\n   maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        name: flask-republisher\n    spec:\n      containers:\n        - name: flask-republisher\n          image: image\n          imagePullPolicy: IfNotPresent\n   ports:\n   - containerPort: 80\n          env:\n            - name: DEBUG\n              value: "True"\n          envFrom:\n            - configMapRef:\n                name: nginx-env-configmap\n   volumeMounts:\n            - mountPath: /root/zenalytix\n              name: zenalytix-data\n            - mountPath: /etc/nginx/nginx.conf\n              name: nginx-configmap\n              subPath: nginx.conf\n          command:\n            - /bin/bash\n            - -c\n            - |\n              python manage.py test\n   startupProbe:\n   httpGet:\n    path: /healthz\n    port: liveness-port\n   failureThreshold: 30\n   periodSeconds: 10\n   readinessProbe:\n   httpGet:\n    path: /\n    port: 5000\n   initialDelaySeconds: 5\n   periodSeconds: 5\n   timeoutSeconds: 5\n   successThreshold: 1\n   failureThreshold: 3\n          livenessProbe:\n            httpGet:\n              path: /healthz\n              port: 5000\n            initialDelaySeconds: 10\n            periodSeconds: 10\n   resources:\n   requests:\n    memory: 256Mi / 8Gi\n    cpu: 250m / 1000m\n   limits:\n    memory: 3Gi\n    cpu: 3000m\n      volumes:\n        - name: config-volume\n          - name: nginx-configmap\n       configMap:\n      name: nginx-configmap\n\n      restartPolicy: Always\n')),(0,r.kt)("h3",{id:"statefulsets"},"statefulsets"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n    name: jupyterlab\n    namespace: jlab\n    labels:\n    name: jupyterlab\nspec:\n    serviceName: jupyterlab\n")),(0,r.kt)("h3",{id:"shared-volume-data-between-two-containers"},"Shared Volume Data between two containers"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n    labels:\n    name: flask-republisher\n    name: flask-republisher\n    namespace: consumers\nspec:\n    replicas: 1\n    selector:\n    matchLabels:\n        name: flask-republisher\n    template:\n    metadata:\n        labels:\n        name: flask-republisher\n    spec:\n        containers:\n        - name: flask-republisher\n            image: gcr.io/zenatix-data-archiver/kafka_republisher:1.1.6\n            imagePullPolicy: IfNotPresent\n            ports:\n            - containerPort: 80\n            env:\n            - name: DEBUG\n                value: "False"\n            envFrom:\n            - configMapRef:\n                name: kafka-flask-config\n            command:\n            - /bin/bash\n            - -c\n            - |\n                gunicorn kafka_flask_republisher:app -b 0.0.0.0:5000 --workers 2 -k gevent --timeout 300 --worker-connections 1000 --max-requests 1000000 --limit-request-line 8190 --access-logfile /var/log/access.log\n            volumeMounts:\n            - name: shared-data\n                mountPath: /var/log/\n            livenessProbe:\n            httpGet:\n                path: /status\n                port: 5000\n            initialDelaySeconds: 10\n            periodSeconds: 10\n\n        - name: telegraf\n            image: telegraf:1.12.3-alpine\n            imagePullPolicy: IfNotPresent\n            volumeMounts:\n            - name: shared-data\n                mountPath: /var/log/\n            - mountPath: /etc/telegraf/telegraf.conf\n                name: kafka-flask-telegraf-config\n                subPath: telegraf.conf\n\n        - name: logrotate\n            image: blacklabelops/logrotate:1.3\n            imagePullPolicy: IfNotPresent\n            env:\n            - name: LOGROTATE_INTERVAL\n                value: "hourly"\n            - name: LOGROTATE_SIZE\n                value: "10M"\n            - name: LOG_FILE_ENDINGS\n                value: "log"\n            - name: LOGS_DIRECTORIES\n                value: "/var/log"\n            - name: LOGROTATE_COPIES\n                value: "25"\n            - name: TZ\n                value: "Asia/Kolkata"\n            volumeMounts:\n            - name: shared-data\n                mountPath: /var/log/\n        nodeSelector:\n        beta.kubernetes.io/os: linux\n        kubernetes.io/role: agent\n        type: virtual-kubelet\n        tolerations:\n        - key: virtual-kubelet.io/provider\n            operator: Equal\n            value: azure\n            effect: NoSchedule\n        volumes:\n        - name: kafka-flask-telegraf-config\n            configMap:\n            name: kafka-flask-telegraf-config\n        - name: shared-data\n            emptyDir: {}\n        restartPolicy: Always\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/"},"https://kubernetes.io/docs/tasks/access-application-cluster/communicate-containers-same-pod-shared-volume/")),(0,r.kt)("h3",{id:"pvc"},"PVC"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"kind:PersistentVolumeClaim\napiVersion:v1\nmetadata:\n name:alertdriver-pvc\n namespace:monitoring\nspec:\n #for attaching again to same pv\n volumeName:pvc-0ad81c1b-fef6-11e9-9e23-3e36fc17cb95\n storageClassName:managed-premium-retain\n accessModes:\n  - ReadWriteOnce\n resources:\n  requests:\n   storage:1Gi\n")),(0,r.kt)("h3",{id:"cronjob"},"Cronjob"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1beta1\nkind: CronJob\nmetadata:\n  name: livenotebook-commit\n  namespace: zenalytix\nspec:\n  # 12:15 AM\n  schedule: "15 20 * * *"\n  suspend: true #false\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n            - name: livenotebook-commit\n              image: gcr.io/zenatix-data-archiver/zenalytix:a7f14578479e\n              workingDir: /root/zenalytix/notebooks\n              command:\n                - /bin/bash\n                - -c\n                - |\n                  sh /root/zenalytix/k8s/scripts/livenotebook-backup.sh\n              volumeMounts:\n                - mountPath: /root/zenalytix\n                  name: zenalytix-data\n          restartPolicy: OnFailure\n          volumes:\n            - name: zenalytix-data\n              persistentVolumeClaim:\n                claimName: zenalytix-pvc\n')),(0,r.kt)("h3",{id:"job"},"Job"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: pi\nspec:\n  template:\n    spec:\n      containers:\n      - name: pi\n        image: perl:5.34.0\n        command: ["perl",  "-Mbignum=bpi", "-wle", "print bpi(2000)"]\n      restartPolicy: Never\n  backoffLimit: 4\n')),(0,r.kt)("h3",{id:"hpa"},"HPA"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: autoscaling/v2beta2\nkind: HorizontalPodAutoscaler\nmetadata:\n    name: api-v1-hpa\n    namespace: prod\nspec:\n    scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: api-v1\n    minReplicas: 3\n    maxReplicas: 8\n    metrics:\n    - type: Resource\n    resource:\n        name: cpu\n        target:\n        type: Utilization\n        averageUtilization: 90\n    - type: Resource\n    resource:\n        name: memory\n        target:\n        type: Utilization\n        averageUtilization: 80\n    behavior:\n    scaleDown:\n        stabilizationWindowSeconds: 300\n        policies:\n        - type: Percent\n        value: 50\n        periodSeconds: 60\n        - type: Pods\n        value: 2\n        periodSeconds: 60\n    scaleUp:\n        stabilizationWindowSeconds: 0\n        policies:\n        - type: Percent\n        value: 100\n        periodSeconds: 15\n        - type: Pods\n        value: 3\n        periodSeconds: 15\n        selectPolicy: Max\n")))}u.isMDXComponent=!0},358560:(e,n,a)=>{a.d(n,{Z:()=>t});const t=a.p+"assets/images/DevOps-Kubernetes-Kubernetes-Manifests-Examples-image1-4c6ae9a6705d3a50396346e7d52f7c0b.jpg"}}]);