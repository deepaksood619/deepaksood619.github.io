"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[57290],{603905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>h});var n=a(667294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,o=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(a),c=r,h=m["".concat(o,".").concat(c)]||m[c]||d[c]||l;return a?n.createElement(h,s(s({ref:t},u),{},{components:a})):n.createElement(h,s({ref:t},u))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,s=new Array(l);s[0]=c;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[m]="string"==typeof e?e:r,s[1]=i;for(var p=2;p<l;p++)s[p]=a[p];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},518456:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var n=a(487462),r=(a(667294),a(603905));const l={},s="DML - Data Manipulation Language",i={unversionedId:"languages/sql/dml-data-manipulation-language",id:"languages/sql/dml-data-manipulation-language",title:"DML - Data Manipulation Language",description:"DML (Data Manipulation Language) commands need to be commited/rolled back",source:"@site/docs/languages/sql/dml-data-manipulation-language.md",sourceDirName:"languages/sql",slug:"/languages/sql/dml-data-manipulation-language",permalink:"/languages/sql/dml-data-manipulation-language",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/languages/sql/dml-data-manipulation-language.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Create Table",permalink:"/languages/sql/ddl-data-definition-language/create-table"},next:{title:"DQL - Data Query Language",permalink:"/languages/sql/dql-data-query-language/"}},o={},p=[{value:"DML",id:"dml",level:2},{value:"DELETE",id:"delete",level:3},{value:"INSERT INTO",id:"insert-into",level:3},{value:"Bulk Insert / Extended Inserts",id:"bulk-insert--extended-inserts",level:3},{value:"Insert vs Insert Ignore",id:"insert-vs-insert-ignore",level:3},{value:"Load",id:"load",level:3},{value:"UPDATE",id:"update",level:3},{value:"UPSERT",id:"upsert",level:3},{value:"Explain",id:"explain",level:2},{value:"Output",id:"output",level:2},{value:"Lock Tables",id:"lock-tables",level:2}],u={toc:p},m="wrapper";function d(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"dml---data-manipulation-language"},"DML - Data Manipulation Language"),(0,r.kt)("p",null,"DML (Data Manipulation Language) commands ",(0,r.kt)("a",{parentName:"p",href:"http://www.dba-oracle.com/t_dml_statements.htm"},"need to be")," ",(0,r.kt)("strong",{parentName:"p"},"commited/rolled back")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"-- online query without locking the tables during update\nSET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n")),(0,r.kt)("h2",{id:"dml"},"DML"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Insert"),(0,r.kt)("li",{parentName:"ul"},"Update"),(0,r.kt)("li",{parentName:"ul"},"Delete"),(0,r.kt)("li",{parentName:"ul"},"Merge"),(0,r.kt)("li",{parentName:"ul"},"Call"),(0,r.kt)("li",{parentName:"ul"},"Explain Plain"),(0,r.kt)("li",{parentName:"ul"},"Lock Table")),(0,r.kt)("h3",{id:"delete"},"DELETE"),(0,r.kt)("p",null,"DELETE statements are used to remove rows from a table."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"DELETE FROM table_name WHERE some_column = some_value;\n")),(0,r.kt)("h3",{id:"insert-into"},"INSERT INTO"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO table_name\nVALUES (value1, value2, value3,....)\nor\nINSERT INTO table_name\n(column1, column2, column3,...)\nVALUES (value1, value2, value3,....)\n\nINSERT INTO table_name (column_1, column_2, column_3) VALUES (value_1, 'value_2', value_3);\nINSERT statements are used to add a new row to a table.\n\nINSERT INTO cron_migrate_data (`table_name`, `start_date`, `end_date`, `s3_file_path`) VALUES ('equifax_raw_response', '2019-10-01 00:00:00', '2019-10-31 23:59:59', 's3-ap-south-1://stashfin-migration-data/rds/');\n")),(0,r.kt)("h3",{id:"bulk-insert--extended-inserts"},"Bulk Insert / Extended Inserts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT IGNORE INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test4'), ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test5'), ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test7');\n")),(0,r.kt)("h3",{id:"insert-vs-insert-ignore"},"Insert vs Insert Ignore"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"# avg - 0.074 sec\n# gives error\nINSERT INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test');\n\n# avg - 0.400 sec\n# is 5.4 times slower\n# gives warning\nINSERT IGNORE INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test');\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Insert ingore consumes autoincrement id and can put holes in between rows"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://stackoverflow.com/questions/5655396/why-insert-ignore-increments-the-auto-increment-primary-key"},"https://stackoverflow.com/questions/5655396/why-insert-ignore-increments-the-auto-increment-primary-key")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.percona.com/blog/2011/11/29/avoiding-auto-increment-holes-on-innodb-with-insert-ignore/"},(0,r.kt)("strong",{parentName:"a"},"https://www.percona.com/blog/2011/11/29/avoiding-auto-increment-holes-on-innodb-with-insert-ignore/"))),(0,r.kt)("li",{parentName:"ul"},"innodb_autoinc_lock_mode = 0"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html"},"https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Alternatives"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nSELECT '2322675', 'test3', 'test2', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test3'\nFROM DUAL\nWHERE NOT EXISTS(\n    SELECT 1\n    FROM userDeviceApps\n    WHERE hash_key = '2322675,test3'\n)\nLIMIT 1;\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://ypereirareis.github.io/blog/2016/03/22/mysql-insert-ignore-alternatives"},"https://ypereirareis.github.io/blog/2016/03/22/mysql-insert-ignore-alternatives")),(0,r.kt)("h3",{id:"load"},"Load"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"LOAD DATA INFILE 'st_bank_model_features_dedupe.csv'\nINTO TABLE st_bank_model_features_dedupe\nFIELDS TERMINATED BY ','\nENCLOSED BY '\"'\nLINES TERMINATED BY '\\n'\nIGNORE 1 ROWS\nSET create_date = STR_TO_DATE(@create_date, '%d/%m/%Y %H:%i');\n")),(0,r.kt)("h3",{id:"update"},"UPDATE"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE table_name\nSET some_column = some_value\nWHERE some_column = some_value;\n-- UPDATE statments allow you to edit rows in a table.\n\nUPDATE`table_name`\n SET`field_name` =replace(same_field_name, 'unwanted_text', 'wanted_text')\n")),(0,r.kt)("h3",{id:"upsert"},"UPSERT"),(0,r.kt)("p",null,"An upsert is a smart operation which turns into INSERT or UPDATE whichever is applicable. Also, it is an atomic transaction, means complete in a single step. Let's understand -- If a record is new, then UPSERT triggers an INSERT. But, if it already exists, then UPSERT performs an UPDATE."),(0,r.kt)("p",null,"MySQL provides the ON DUPLICATE KEY UPDATE option to INSERT, which accomplishes this behavior. However, there are other statements like INSERT IGNORE or REPLACE, which can also fulfill this objective."),(0,r.kt)("p",null,"We can imitate MySQL UPSERT in one of these three ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-insert"},"UPSERT using INSERT IGNORE")),(0,r.kt)("p",{parentName:"li"},"When we use INSERT IGNORE for adding a record, it gets through even if there are errors in performing INSERT. So, if the target table already has a row with a matching UNIQUE or PRIMARY key, then INSERT REPLACE would suppress all possible errors."),(0,r.kt)("p",{parentName:"li"},"Moreover, it skips the INSERT operation altogether. Such kind of statement is useful when we need to add a large number of records in one go. And, the table may already have a part of that data inside.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-replace"},"UPSERT using REPLACE")),(0,r.kt)("p",{parentName:"li"},"There come situations when we have to replace some rows even if INSERT could fail due to duplicate values of the primary key field. Hence, we should use the REPLACE statement for such cases."),(0,r.kt)("p",{parentName:"li"},"However, if we opt to use REPLACE, then it could result in one of the following outcomes:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If we don't face any error, then REPLACE would behave as regular INSERT command."),(0,r.kt)("li",{parentName:"ul"},"If a duplicate record exists, then REPLACE would first delete it and perform the INSERT subsequently."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-update"},"UPSERT using INSERT with ON DUPLICATE KEY UPDATE")," (UPSERT)")),(0,r.kt)("p",{parentName:"li"},"It is non-destructive, means it doesn't have to drop the duplicate row. Instead, it issues an UPDATE whenever it finds a matching record having the same UNIQUE or PRIMARY KEY value."))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.techbeamers.com/mysql-upsert"},"https://www.techbeamers.com/mysql-upsert")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.javatpoint.com/mysql-upsert"},"https://www.javatpoint.com/mysql-upsert")),(0,r.kt)("h2",{id:"explain"},"Explain"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/explain.html"},"EXPLAIN")," works with ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/select.html"},"SELECT"),", ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/delete.html"},"DELETE"),", ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/insert.html"},"INSERT"),", ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/replace.html"},"REPLACE"),", and ",(0,r.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.7/en/update.html"},"UPDATE")," statements."),(0,r.kt)("p",null,"EXPLAIN EXTENDED"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The indexes it's considering using."),(0,r.kt)("li",{parentName:"ul"},"The order in which it plans to join tables."),(0,r.kt)("li",{parentName:"ul"},"The indexes it actually used."),(0,r.kt)("li",{parentName:"ul"},"How many rows will be accessed."),(0,r.kt)("li",{parentName:"ul"},"Whether it used a filesort.")),(0,r.kt)("h2",{id:"output"},"Output"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Possible keys:")," shows the keys that can be used by MySQL to find rows from the table, if this is NULL it indicates no useful indexes could be applied.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Key:")," indicates the actual index that MySQL used.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Rows:")," shows the number of records that were examined to produce the output. This is especially relevant during joins.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Key_len:")," longest length of the key that was used (aka which parts of the composite index are being used) use this to tell how many columns were used from it.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Ref:")," which columns, or constants are compared to the index in order to select rows.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Extra")),(0,r.kt)("p",{parentName:"li"},"What you would like to see in Extra:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Using index - MySQL was able to use a covering index"),(0,r.kt)("li",{parentName:"ul"},"Distinct - MySQL stops searching after it found the first matching row"),(0,r.kt)("li",{parentName:"ul"},"Using index condition")),(0,r.kt)("p",{parentName:"li"},"What you don't want to see in Extra:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Using file sort - as said extra sorting was required"),(0,r.kt)("li",{parentName:"ul"},"Using temporary - a temp table was needed"),(0,r.kt)("li",{parentName:"ul"},"Using join buffer - tables processed in large batches of rows, instead of index lookups"),(0,r.kt)("li",{parentName:"ul"},"Using where - after fetching rows from storage engine, extra filtering needs to happen for each row. However it's OK if a very small number of rows were returned.")),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://www.sitepoint.com/using-explain-to-write-better-mysql-queries"},"https://www.sitepoint.com/using-explain-to-write-better-mysql-queries")))),(0,r.kt)("h2",{id:"lock-tables"},"Lock Tables"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"START TRANSACTION;\nlock table bureau_account_list WRITE;\ndelete from bureau_account_list where id = 0;\nALTER TABLE bureau_account_list\nCHANGE COLUMN id id BIGINT(20) NOT NULL AUTO_INCREMENT ;\n\nALTER TABLE bureau_account_list AUTO_INCREMENT = 400000000;\n\nALTER TABLE sttash_website_LIVE.bureau_account_list\nCHANGE COLUMN create_date create_date DATETIME NULL DEFAULT CURRENT_TIMESTAMP ;\n\nUNLOCK TABLES;\n\nCOMMIT;\n")))}d.isMDXComponent=!0}}]);