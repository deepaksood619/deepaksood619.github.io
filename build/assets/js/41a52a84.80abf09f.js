"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[66645],{603905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>k});var n=a(667294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),p=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(o.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,k=c["".concat(o,".").concat(d)]||c[d]||m[d]||i;return a?n.createElement(k,l(l({ref:t},u),{},{components:a})):n.createElement(k,l({ref:t},u))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=d;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},156835:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(487462),r=(a(667294),a(603905));const i={},l="CAP Theorem",s={unversionedId:"computer-science/distributed-system/cap-theorem",id:"computer-science/distributed-system/cap-theorem",title:"CAP Theorem",description:"Proposed by Eric Brewer (Berkeley)",source:"@site/docs/computer-science/distributed-system/cap-theorem.md",sourceDirName:"computer-science/distributed-system",slug:"/computer-science/distributed-system/cap-theorem",permalink:"/computer-science/distributed-system/cap-theorem",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/computer-science/distributed-system/cap-theorem.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Distributed System",permalink:"/computer-science/distributed-system/"},next:{title:"Clocks",permalink:"/computer-science/distributed-system/clocks"}},o={},p=[{value:"Proposed by Eric Brewer (Berkeley)",id:"proposed-by-eric-brewer-berkeley",level:2},{value:"C - Consistency",id:"c---consistency",level:2},{value:"A - Availability",id:"a---availability",level:2},{value:"P - Partition Tolerence",id:"p---partition-tolerence",level:2},{value:"Why is Availability Important?",id:"why-is-availability-important",level:2},{value:"Why is Consistency Important?",id:"why-is-consistency-important",level:2},{value:"Why is Partition-Tolerance Important?",id:"why-is-partition-tolerance-important",level:2},{value:"CAP Theorem Fallout",id:"cap-theorem-fallout",level:2},{value:"Cassandra",id:"cassandra",level:2},{value:"Traditional RDMSs",id:"traditional-rdmss",level:2},{value:"CAP Tradeoff",id:"cap-tradeoff",level:2},{value:"Eventual Consistency",id:"eventual-consistency",level:2},{value:"RDBMS vs Key-value stores",id:"rdbms-vs-key-value-stores",level:2},{value:"PACELC (pass-elk) Theorem",id:"pacelc-pass-elk-theorem",level:2},{value:"Database PACELC ratings",id:"database-pacelc-ratings",level:2}],u={toc:p},c="wrapper";function m(e){let{components:t,...i}=e;return(0,r.kt)(c,(0,n.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"cap-theorem"},"CAP Theorem"),(0,r.kt)("h2",{id:"proposed-by-eric-brewer-berkeley"},"Proposed by Eric Brewer (Berkeley)"),(0,r.kt)("h2",{id:"c---consistency"},"C - Consistency"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Every read receives the most recent write or an error"),(0,r.kt)("li",{parentName:"ul"},"all nodes see same data at any time, or reads return latest written value by any client")),(0,r.kt)("h2",{id:"a---availability"},"A - Availability"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Every request receives a (non-error) response -- without guarantee that it contains the most recent write"),(0,r.kt)("li",{parentName:"ul"},"the system allows operations all the time, and operations return quickly")),(0,r.kt)("h2",{id:"p---partition-tolerence"},"P - Partition Tolerence"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes"),(0,r.kt)("li",{parentName:"ul"},"the system continues to work inspite of network partitions\nCan only achieve two of these.\nIn the presence of a network partition, you must choose betwen consistency and availability")),(0,r.kt)("h2",{id:"why-is-availability-important"},"Why is Availability Important?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Availability = Reads/writes complete reliable and quickly"),(0,r.kt)("li",{parentName:"ul"},"Measurements have shown that a 500 ms increase in latency for operations at Amazon.com or at Google.com can cause a 20% drop in revenue."),(0,r.kt)("li",{parentName:"ul"},"At Amazon, each added millisecond of latency implies a $6M yearly loss"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"User cognitive drift:")," If more than a second elapses between clicking and material appearing, the user's mind is already somewhere else"),(0,r.kt)("li",{parentName:"ul"},"SLAs (Service Level Agreements) written by providers predominantly deal with latencies faced by clients.")),(0,r.kt)("h2",{id:"why-is-consistency-important"},"Why is Consistency Important?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Consistency = all nodes see same data at any time, or reads return latest written value by any client."),(0,r.kt)("li",{parentName:"ul"},"When you access your bank or investment account via multiple clients, you want the updates done from one client to be visible to other clients."),(0,r.kt)("li",{parentName:"ul"},"When thousands of customers are looking to book a flight, all updates from any client (e.g., book a flight) should be accessible by other clients.")),(0,r.kt)("h2",{id:"why-is-partition-tolerance-important"},"Why is Partition-Tolerance Important?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Partitions happen. They happen for countless reasons. Switches fail, NICs fail, link layers fail, servers fail, processes fail. Partitions happen even when systemsdon'tfail due to GC pauses or prolonged I/O latency for example. Let's acceptthis as fact andmove on. What this means is that a \"CA\" system is CAonly until it's not. Once that partition happens, all your assumptions and all your guarantees hit the fan in spectacular fashion. Where does this leave us?"),(0,r.kt)("li",{parentName:"ul"},"Partitions can happen across datacenters when the internet gets disconnected",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Internet router outages"),(0,r.kt)("li",{parentName:"ul"},"Under-sea cables cut"),(0,r.kt)("li",{parentName:"ul"},"DNS not working"))),(0,r.kt)("li",{parentName:"ul"},"Partitions can also occur within a datacenter, e.g. a rack switch outage"),(0,r.kt)("li",{parentName:"ul"},"Still desire system to continue functioning normally under this scenario"),(0,r.kt)("li",{parentName:"ul"},"Partition tolerance ensures that system still functions in face of partition or network failure")),(0,r.kt)("h2",{id:"cap-theorem-fallout"},"CAP Theorem Fallout"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Since partition-tolerance is essential in today's cloud computing systems, CAP theorem implies that a system has to choose between consistency and availability")),(0,r.kt)("h2",{id:"cassandra"},"Cassandra"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Eventual (weak) consistency, Availability, Partition-tolerance")),(0,r.kt)("h2",{id:"traditional-rdmss"},"Traditional RDMSs"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Strong consistency over availability under a partition")),(0,r.kt)("h2",{id:"cap-tradeoff"},"CAP Tradeoff"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Starting point for NoSQL Revolution"),(0,r.kt)("li",{parentName:"ul"},"A distributed storage system can achieve at most two of C, A, and P."),(0,r.kt)("li",{parentName:"ul"},"When partition-tolerance is important, you have to choose between consistency and availability")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image",src:a(87058).Z,width:"762",height:"710"})),(0,r.kt)("h2",{id:"eventual-consistency"},"Eventual Consistency"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If all writes stop (to a key), then all its values (replicas) will converge eventually."),(0,r.kt)("li",{parentName:"ul"},"If writes continue, then system always tries to keep converging.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Moving wave of updated values lagging behind the latest values sent by clients, but always trying to catch up."))),(0,r.kt)("li",{parentName:"ul"},"May still return stale values to clients (e.g., if many back-to-back writes)."),(0,r.kt)("li",{parentName:"ul"},"But works well when there a few periods of low writes - system converges quickly")),(0,r.kt)("h2",{id:"rdbms-vs-key-value-stores"},"RDBMS vs Key-value stores"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"While RDBMS provide ACID",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Atomicity"),(0,r.kt)("li",{parentName:"ul"},"Consistency"),(0,r.kt)("li",{parentName:"ul"},"Isolation"),(0,r.kt)("li",{parentName:"ul"},"Durability"))),(0,r.kt)("li",{parentName:"ul"},"Key-value stores like Cassandra provide BASE",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Basically Available Soft-state Eventual Consistency"),(0,r.kt)("li",{parentName:"ul"},"Prefers Availability over Consistency\nDespite your best efforts, your system will experience enough faults that it will have to make a choice between reducing yield (i.e., stop answering requests) and reducing harvest (i.e., giving answers based on incomplete data). This decision should be based on business requirements.")))),(0,r.kt)("h2",{id:"pacelc-pass-elk-theorem"},"PACELC (pass-elk) Theorem"),(0,r.kt)("p",null,"In ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Theoretical_computer_science"},"theoretical computer science"),", thePACELC theoremis an extension to the ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/CAP_theorem"},"CAP theorem"),". It states that in case of network partitioning (P) in a ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Distributed_computing"},"distributed computer system"),", one has to choose between availability (A) and consistency (C) (as per the CAP theorem), but else (E), even when the system is running normally in the absence of partitions, one has to choose between latency (L) and consistency (C)."),(0,r.kt)("h2",{id:"database-pacelc-ratings"},"Database PACELC ratings"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The default versions of ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Amazon_DynamoDB"},"DynamoDB"),", ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Apache_Cassandra"},"Cassandra"),", ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Riak"},"Riak")," and ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cosmos_DB"},"Cosmos DB")," are ",(0,r.kt)("strong",{parentName:"li"},"PA/EL systems"),": if a partition occurs, they give up consistency for availability, and under normal operation they give up consistency for lower latency."),(0,r.kt)("li",{parentName:"ul"},"Fully ACID systems such as ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/VoltDB"},"VoltDB"),"/H-Store, Megastore and",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://en.wikipedia.org/wiki/MySQL_Cluster"},"MySQL Cluster")," are PC/EC"),": they refuse to give up consistency, and will pay the availability and latency costs to achieve it.",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Bigtable"},"BigTable")," and related systems such as ",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Apache_HBase"},"HBase")," are also PC/EC."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.couchbase.com/server/6.0/learn/clusters-and-availability/clusters-and-availability.html"},"Couchbase")," provides a range of consistency and availability options during a partition, and equally a range of latency and consistency options with no partition. Unlike most other databases, Couchbase doesn't have a single API set nor does it scale/replicate all data services homogeneously. For writes, Couchbase favors Consistency over Availability making it formally CP, but on read there is more user-controlled variability depending on index replication, desired consistency level and type of access (single document lookup vs range scan vs full-text search, etc). On top of that, there is then further variability depending on cross-datacenter-replication (XDCR) which takes multiple CP clusters and connects them with asynchronous replication and Couchbase Lite which is an embedded database and creates a fully multi-master (with revision tracking) distributed topology."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cosmos_DB"},"Cosmos DB")," supports five tunable consistency levels that allow for tradeoffs between C/A during P, and L/C during E.",(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Cosmos_DB"},"Cosmos DB")," never violates the specified consistency level, so it's formally CP."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/MongoDB"},"MongoDB")," can be classified as a PA/EC system. In the baseline case, the system guarantees reads and writes to be consistent."),(0,r.kt)("li",{parentName:"ul"},"PNUTS is a PC/EL system."),(0,r.kt)("li",{parentName:"ul"},"Hazelcast IMDG and indeed most in-memory data grids are an implementation of a PA/EC system; Hazelcast can be configured to be EL rather than EC.Concurrency primitives (Lock, AtomicReference, CountDownLatch, etc.) can be either PC/EC or PA/EC."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://news.ycombinator.com/item?id=18257128"},"FaunaDB")," implements ",(0,r.kt)("a",{parentName:"li",href:"http://cs.yale.edu/homes/thomson/publications/calvin-sigmod12.pdf"},"Calvin"),", a transaction protocol created by Dr. Daniel Abadi and author of PACELC theorem, and offers users adjustable controls for LC tradeoff. It is PC/EC for strictly serializable transactions, and EL for serializable reads.")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"DDBS")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"P+A")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"P+C")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"E+L")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"th"},"E+C")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"DynamoDB"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cassandra"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Cosmos DB"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Couchbase"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Riak"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"VoltDB/H-Store"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Megastore"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"BigTable/HBase"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MySQL Cluster"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MongoDB"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PNUTS"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null}),(0,r.kt)("td",{parentName:"tr",align:null})),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Hazelcast IMDG"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"FaunaDB"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null},"Yes"),(0,r.kt)("td",{parentName:"tr",align:null})))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/PACELC_theorem"},"PACELC theorem - Wikipedia"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed"},'CAP Twelve Years Later: How the "Rules" Have Changed')))}m.isMDXComponent=!0},87058:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/CAP-Theorem-image1-75e971969a84c4a44925dd1766b76c3e.jpg"}}]);