"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[65044],{603905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>d});var n=a(667294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=n.createContext({}),h=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},m=function(e){var t=h(e.components);return n.createElement(i.Provider,{value:t},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,i=e.parentName,m=s(e,["components","mdxType","originalType","parentName"]),p=h(a),u=o,d=p["".concat(i,".").concat(u)]||p[u]||c[u]||l;return a?n.createElement(d,r(r({ref:t},m),{},{components:a})):n.createElement(d,r({ref:t},m))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,r=new Array(l);r[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[p]="string"==typeof e?e:o,r[1]=s;for(var h=2;h<l;h++)r[h]=a[h];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},667347:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>c,frontMatter:()=>l,metadata:()=>s,toc:()=>h});var n=a(487462),o=(a(667294),a(603905));const l={},r="ORM",s={unversionedId:"python/others/sqlalchemy/orm",id:"python/others/sqlalchemy/orm",title:"ORM",description:"ORM (Object Relational Mapper)",source:"@site/docs/python/others/sqlalchemy/orm.md",sourceDirName:"python/others/sqlalchemy",slug:"/python/others/sqlalchemy/orm",permalink:"/python/others/sqlalchemy/orm",draft:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/main/docs/python/others/sqlalchemy/orm.md",tags:[],version:"current",lastUpdatedAt:1677955187,formattedLastUpdatedAt:"Mar 4, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Models",permalink:"/python/others/sqlalchemy/models"},next:{title:"Twisted",permalink:"/python/others/twisted"}},i={},h=[{value:"ORM (Object Relational Mapper)",id:"orm-object-relational-mapper",level:2},{value:"SQLAlchemy Engines",id:"sqlalchemy-engines",level:2},{value:"from sqlalchemy import create_engine",id:"from-sqlalchemy-import-create_engine",level:2},{value:"SQLAlchemy Connection Pools",id:"sqlalchemy-connection-pools",level:2},{value:"SQLAlchemy Dialects",id:"sqlalchemy-dialects",level:2},{value:"SQLAlchemy ORM",id:"sqlalchemy-orm",level:2}],m={toc:h},p="wrapper";function c(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"orm"},"ORM"),(0,o.kt)("h2",{id:"orm-object-relational-mapper"},"ORM (Object Relational Mapper)"),(0,o.kt)("p",null,"The SQLAlchemy Object Relational Mapper presents a method of associating user-defined Python classes with database tables, and instances of those classes (objects) with rows in their corresponding tables. It includes a system that transparently synchronizes all changes in state between objects and their related rows, called a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/13/glossary.html#term-unit-of-work"},"unit of work"),", as well as a system for expressing database queries in terms of the user defined classes and their defined relationships between each other."),(0,o.kt)("p",null,"The ORM is in contrast to the SQLAlchemy Expression Language, upon which the ORM is constructed. Whereas the SQL Expression Language, introduced in ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/13/core/tutorial.html"},"SQL Expression Language Tutorial"),", presents a system of representing the primitive constructs of the relational database directly without opinion, the ORM presents a high level and abstracted pattern of usage, which itself is an example of applied usage of the Expression Language."),(0,o.kt)("p",null,"While there is overlap among the usage patterns of the ORM and the Expression Language, the similarities are more superficial than they may at first appear. One approaches the structure and content of data from the perspective of a user-defined ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/13/glossary.html#term-domain-model"},"domain model")," which is transparently persisted and refreshed from its underlying storage model. The other approaches it from the perspective of literal schema and SQL expression representations which are explicitly composed into messages consumed individually by the database."),(0,o.kt)("p",null,"A successful application may be constructed using the Object Relational Mapper exclusively. In advanced situations, an application constructed with the ORM may make occasional usage of the Expression Language directly in certain areas where specific database interactions are required."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#version-check"},"Version Check")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#connecting"},"Connecting")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#declare-a-mapping"},"Declare a Mapping")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#create-a-schema"},"Create a Schema")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#create-an-instance-of-the-mapped-class"},"Create an Instance of the Mapped Class")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#creating-a-session"},"Creating a Session"))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/14/orm/session_basics.html"},"https://docs.sqlalchemy.org/en/14/orm/session_basics.html")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#adding-and-updating-objects"},"Adding and Updating Objects")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#rolling-back"},"Rolling Back")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#querying"},"Querying")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#common-filter-operators"},"Common Filter Operators")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#returning-lists-and-scalars"},"Returning Lists and Scalars")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#using-textual-sql"},"Using Textual SQL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#counting"},"Counting")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#building-a-relationship"},"Building a Relationship")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#working-with-related-objects"},"Working with Related Objects")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#querying-with-joins"},"Querying with Joins")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#using-aliases"},"Using Aliases")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#using-subqueries"},"Using Subqueries")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#selecting-entities-from-subqueries"},"Selecting Entities from Subqueries")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#using-exists"},"Using EXISTS")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#common-relationship-operators"},"Common Relationship Operators")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#eager-loading"},"Eager Loading")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#selectin-load"},"Selectin Load")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#joined-load"},"Joined Load")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#explicit-join-eagerload"},"Explicit Join + Eagerload")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#deleting"},"Deleting")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#configuring-delete-delete-orphan-cascade"},"Configuring delete/delete-orphan Cascade")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#building-a-many-to-many-relationship"},"Building a Many To Many Relationship")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/tutorial.html#further-reference"},"Further Reference")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/mapper_config.html"},"Mapper Configuration")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/relationships.html"},"Relationship Configuration")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/loading_objects.html"},"Loading Objects")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/session.html"},"Using the Session")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/extending.html"},"Events and Internals")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/extensions/index.html"},"ORM Extensions")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sqlalchemy.org/en/13/orm/examples.html"},"ORM Examples"))),(0,o.kt)("h2",{id:"sqlalchemy-engines"},"SQLAlchemy Engines"),(0,o.kt)("p",null,"Whenever we want to use SQLAlchemy to interact with a database, we need to create anEngine. Engines, on SQLAlchemy, are used to manage two crucial factors:PoolsandDialects."),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Engine"},"Engine")," is afactorythat can create new database connections for us, which also holds onto connections inside of a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/14/core/pooling.html"},"Connection Pool")," for fast reuse."),(0,o.kt)("h2",{id:"from-sqlalchemy-import-create_engine"},"from sqlalchemy import create_engine"),(0,o.kt)("p",null,'engine=create_engine("sqlite://",echo=',(0,o.kt)("strong",{parentName:"p"},"True"),",future=",(0,o.kt)("strong",{parentName:"p"},"True"),")"),(0,o.kt)("p",null,"Theecho=Trueparameter indicates that SQL emitted by connections will be logged to standard out.future=Trueis to ensure we are using the latest SQLAlchemy ",(0,o.kt)("a",{parentName:"p",href:"https://docs.sqlalchemy.org/en/14/glossary.html#term-1"},"2.0-style")," APIs."),(0,o.kt)("h2",{id:"sqlalchemy-connection-pools"},"SQLAlchemy Connection Pools"),(0,o.kt)("p",null,"A pool of already established TCP connections to the databases should be available to avoid cold start problem."),(0,o.kt)("p",null,"Connection pooling is one of the most traditional implementations of the ",(0,o.kt)("a",{parentName:"p",href:"https://sourcemaking.com/design_patterns/object_pool"},"object pool pattern"),". Object pools are used as caches of pre-initialized objects ready to use. That is, instead of spending time to create objects that are frequently needed (like connections to databases) the program fetches an existing object from the pool, uses it as desired, and puts back when done."),(0,o.kt)("p",null,"The main reason why programs take advantage of this design pattern is to improve performance. In the case of database connections, opening and maintaining new ones is expensive, time-consuming, and wastes resources. Besides that, this pattern allows easier management of the number of connections that an application might use simultaneously."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"http://docs.sqlalchemy.org/en/rel_1_1/core/pooling.html#api-documentation-available-pool-implementations"},"There are various implementations of the connection pool pattern available on SQLAlchemy"),". For example, creating anEnginethrough thecreate_engine() function usually generates a ",(0,o.kt)("a",{parentName:"p",href:"http://docs.sqlalchemy.org/en/rel_1_1/core/pooling.html#sqlalchemy.pool.QueuePool"},"QueuePool"),". This kind of pool comes configured with some reasonable defaults, like a maximum pool size of 5 connections."),(0,o.kt)("p",null,"As usual production-ready programs need to override these defaults (to fine-tune pools to their needs), most of the different implementations of connection pools provide a similar set of configuration options. The following list shows the most common options with their descriptions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"pool_size:")," Sets the number of connections that the pool will handle."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"max_overflow:")," Specifies how many exceeding connections (relative topool_size) the pool supports."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"pool_recycle:")," Configures the maximum age (in seconds) of connections in the pool."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"pool_timeout:")," Identifies how many seconds the program will wait before giving up on getting a connection from the pool.")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://wiki.postgresql.org/wiki/Replication,_Clustering,_and_Connection_Pooling"},"https://wiki.postgresql.org/wiki/Replication,_Clustering,_and_Connection_Pooling")),(0,o.kt)("h2",{id:"sqlalchemy-dialects"},"SQLAlchemy Dialects"),(0,o.kt)("p",null,"As SQLAlchemy is a facade that enables Python developers to create applications that communicate to different database engines through the same API, we need to make use ofDialects. Most of the popular relational databases available out there adhere to the SQL (Structured Query Language) standard, but they also introduce proprietary variations. These variations are the solely responsible for the existence of dialects."),(0,o.kt)("p",null,"For example, let's say that we want to fetch the first ten rows of a table calledpeople. If our data was being held by a Microsoft SQL Server database engine, SQLAlchemy would need to issue the following query:"),(0,o.kt)("p",null,"SELECT TOP 10 * FROM people;"),(0,o.kt)("p",null,"But, if our data was persisted on MySQL instance, then SQLAlchemy would need to issue:"),(0,o.kt)("p",null,"SELECT * FROM people LIMIT 10;"),(0,o.kt)("p",null,"Therefore, to know precisely what query to issue, SQLAlchemy needs to be aware of the type of the database that it is dealing with. This is exactly whatDialectsdo. They make SQLAlchemy aware of the dialect it needs to talk."),(0,o.kt)("p",null,"On its core, SQLAlchemy includes the following list of dialects:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/firebird.html"},"Firebird")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/mssql.html"},"Microsoft SQL Server")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/mysql.html"},"MySQL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/oracle.html"},"Oracle")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/postgresql.html"},"PostgreSQL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/sqlite.html"},"SQLite")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://docs.sqlalchemy.org/en/latest/dialects/sybase.html"},"Sybase"))),(0,o.kt)("h2",{id:"sqlalchemy-orm"},"SQLAlchemy ORM"),(0,o.kt)("p",null,"ORM, which stands forObject Relational Mapper, is the specialization of the ",(0,o.kt)("a",{parentName:"p",href:"https://martinfowler.com/eaaCatalog/dataMapper.html"},"Data Mapperdesign pattern")," that addresses relational databases like MySQL, Oracle, and PostgreSQL. As explained by Martin Fowler in the article,Mappersare responsible for moving data between objects and a database while keeping them independent of each other. As object-oriented programming languages and relational databases structure data on different ways, we need specific code to translate from one schema to the other."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://auth0.com/blog/sqlalchemy-orm-tutorial-for-python-developers"},"https://auth0.com/blog/sqlalchemy-orm-tutorial-for-python-developers")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.infoq.com/articles/optimizing-orm-performance"},"https://www.infoq.com/articles/optimizing-orm-performance")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://stackoverflow.com/questions/451845/orm-performance-cost"},"https://stackoverflow.com/questions/451845/orm-performance-cost")))}c.isMDXComponent=!0}}]);