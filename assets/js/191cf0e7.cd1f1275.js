"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[6906],{846192:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var n=i(785893),r=i(511151);const t={},o="ClickHouse",a={id:"databases/nosql-databases/clickhouse",title:"ClickHouse",description:"ClickHouse is an open source column-oriented database management system capable of realtime generation of analytical data reports using SQL queries.",source:"@site/docs/databases/nosql-databases/clickhouse.md",sourceDirName:"databases/nosql-databases",slug:"/databases/nosql-databases/clickhouse",permalink:"/databases/nosql-databases/clickhouse",draft:!1,unlisted:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/databases/nosql-databases/clickhouse.md",tags:[],version:"current",lastUpdatedAt:1726859634,formattedLastUpdatedAt:"Sep 20, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Working",permalink:"/databases/nosql-databases/cassandra/working"},next:{title:"Column family",permalink:"/databases/nosql-databases/column-family"}},l={},c=[{value:"Key Features",id:"key-features",level:3},{value:"History",id:"history",level:4},{value:"Compression",id:"compression",level:4},{value:"Concurrency Control",id:"concurrency-control",level:4},{value:"Data Model",id:"data-model",level:4},{value:"Foreign Keys",id:"foreign-keys",level:4},{value:"Indexes",id:"indexes",level:4},{value:"Joins",id:"joins",level:4},{value:"Logging",id:"logging",level:4},{value:"Parallel Execution",id:"parallel-execution",level:4},{value:"Query Compilation",id:"query-compilation",level:4},{value:"Query Execution",id:"query-execution",level:4},{value:"Query Interface",id:"query-interface",level:4},{value:"Storage Architecture",id:"storage-architecture",level:4},{value:"Storage Model",id:"storage-model",level:4},{value:"Storage Organization",id:"storage-organization",level:4},{value:"Stored Procedures",id:"stored-procedures",level:4},{value:"System Architecture",id:"system-architecture",level:4},{value:"Views",id:"views",level:4},{value:"Internals",id:"internals",level:2},{value:"Commands",id:"commands",level:2},{value:"Links",id:"links",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.h1,{id:"clickhouse",children:"ClickHouse"}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse is an open source column-oriented database management system capable of realtime generation of analytical data reports using SQL queries."}),"\n",(0,n.jsx)(s.h3,{id:"key-features",children:"Key Features"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:"True column-oriented storage"}),"\n",(0,n.jsx)(s.li,{children:"Vectorized query execution"}),"\n",(0,n.jsx)(s.li,{children:"Data compression"}),"\n",(0,n.jsx)(s.li,{children:"Parallel and distributed query execution"}),"\n",(0,n.jsx)(s.li,{children:"Real time query processing"}),"\n",(0,n.jsx)(s.li,{children:"Real time data ingestion"}),"\n",(0,n.jsx)(s.li,{children:"On-disk locality of reference"}),"\n",(0,n.jsx)(s.li,{children:"Cross-datacenter replication"}),"\n",(0,n.jsx)(s.li,{children:"High availability"}),"\n",(0,n.jsx)(s.li,{children:"SQL support"}),"\n",(0,n.jsx)(s.li,{children:"Local and distributed joins"}),"\n",(0,n.jsx)(s.li,{children:"Pluggable external dimension tables"}),"\n",(0,n.jsx)(s.li,{children:"Arrays and nested data types"}),"\n",(0,n.jsx)(s.li,{children:"Approximate query processing"}),"\n",(0,n.jsx)(s.li,{children:"Probabilistic data structures"}),"\n",(0,n.jsx)(s.li,{children:"Full support of IPv6"}),"\n",(0,n.jsx)(s.li,{children:"Features for web analytics"}),"\n",(0,n.jsx)(s.li,{children:"State-of-the-art algorithms"}),"\n",(0,n.jsx)(s.li,{children:"Detailed documentation - Clean documented code"}),"\n"]}),"\n",(0,n.jsx)(s.h4,{id:"history",children:"History"}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse is developed by a Russian company called Yandex. It is designed for multiple projects within Yandex. Yandex needed a DBMS to analyze large amounts of data, thus they began to develop their own column-oriented DBMS. The prototype of ClickHouse appeared in 2009 and it was released to open-source in 2016."}),"\n",(0,n.jsx)(s.h4,{id:"compression",children:"Compression"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?compression=dictionary-encoding",children:"Dictionary Encoding"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?compression=delta-encoding",children:"Delta Encoding"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?compression=naive-page-level",children:"Na\xefve (Page-Level)"})]}),"\n",(0,n.jsx)(s.p,{children:"In addition to general-purpose encoding with LZ4 (default) or Zstd, ClickHouse supports dictionary encoding via LowCardinality data type, as well as delta, double-delta and Gorilla encodings via column codecs."}),"\n",(0,n.jsx)(s.h4,{id:"concurrency-control",children:"Concurrency Control"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?concurrency-control=not-supported",children:"Not Supported"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse does not support multi-statement transactions."}),"\n",(0,n.jsx)(s.h4,{id:"data-model",children:"Data Model"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?data-model=relational",children:"Relational"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse uses the relational database model."}),"\n",(0,n.jsx)(s.h4,{id:"foreign-keys",children:"Foreign Keys"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?foreign-keys=not-supported",children:"Not Supported"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse does not support foreign keys."}),"\n",(0,n.jsx)(s.h4,{id:"indexes",children:"Indexes"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?indexes=log-structured-merge-tree",children:"Log-Structured Merge Tree"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse supports primary key indexes. The indexing mechanism is called a sparse index. In the MergeTree, data are sorted by primary key lexicographically in each part. Then ClickHouse selects some marks for every Nth row, where N is chosen adaptively by default. Together these marks serve as a sparse index, which allows efficient range queries."}),"\n",(0,n.jsx)(s.h4,{id:"joins",children:"Joins"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?joins=hash-join",children:"Hash Join"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse uses hash join by default, which is done by placing the right part of data in a hash table in memory. If there's not enough memory for hash join it falls back to merge join."}),"\n",(0,n.jsx)(s.h4,{id:"logging",children:"Logging"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?logging=physical-logging",children:"Physical Logging"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse replicates its data on multiple nodes and monitors data synchronicity on replicas. It recovers after failures by syncing data from other replica nodes."}),"\n",(0,n.jsx)(s.h4,{id:"parallel-execution",children:"Parallel Execution"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?parallel-execution=intra-operator",children:"Intra-Operator (Horizontal)"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?parallel-execution=inter-operator",children:"Inter-Operator (Vertical)"})]}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse utilizes half cores for single-node queries and one replica of each shard for distributed queries by default. It could be tuned to utilize only one core, all cores of the whole cluster or anything in between."}),"\n",(0,n.jsx)(s.h4,{id:"query-compilation",children:"Query Compilation"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-compilation=code-generation",children:"Code Generation"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse supports runtime code generation. The code is generated for every kind of query on the fly, removing all indirection and dynamic dispatch. Runtime code generation can be better when it fuses many operations together and fully utilizes CPU execution units."}),"\n",(0,n.jsx)(s.h4,{id:"query-execution",children:"Query Execution"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-execution=vectorized-model",children:"Vectorized Model"})}),"\n",(0,n.jsx)(s.h4,{id:"query-interface",children:"Query Interface"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-interface=custom-api",children:"Custom API"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-interface=sql",children:"SQL"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-interface=http-rest",children:"HTTP / REST"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?query-interface=command-line-shell",children:"Command-line / Shell"})]}),"\n",(0,n.jsx)(s.p,{children:"ClickHouses provides two types of parsers: a full SQL parser and a data format parser. It uses SQL parser for all types of queries and the data format parser only for INSERT queries. Beyond the query language, it provides multiple user interfaces, including HTTP interface, JDBC driver, TCP interface, command-line client, etc."}),"\n",(0,n.jsx)(s.h4,{id:"storage-architecture",children:"Storage Architecture"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-architecture=disk-oriented",children:"Disk-oriented"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-architecture=in-memory",children:"In-Memory"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-architecture=hybrid",children:"Hybrid"})]}),"\n",(0,n.jsxs)(s.p,{children:["ClickHouse has multiple types of table engines. The type of the table engine determines where the data is stored, concurrent level, whether indexes are supported and some other properties. Key table engine family for production use is a\xa0",(0,n.jsx)(s.a,{href:"https://clickhouse.tech/docs/en/engines/table_engines/mergetree_family/mergetree/",children:"MergeTree"}),"\xa0that allows for resilient storage of large volumes of data and supports replication. There's also a\xa0",(0,n.jsx)(s.a,{href:"https://clickhouse.tech/docs/en/engines/table_engines/log_family/log_family/",children:"Log family"}),"\xa0for lightweight storage of temporary data and\xa0",(0,n.jsx)(s.a,{href:"https://clickhouse.tech/docs/en/engines/table_engines/special/distributed/",children:"Distributed engine"}),"\xa0for querying a cluster."]}),"\n",(0,n.jsx)(s.h4,{id:"storage-model",children:"Storage Model"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-model=decomposition-storage-model-columnar",children:"Decomposition Storage Model (Columnar)"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse is a column-oriented DBMS and it stores data by columns."}),"\n",(0,n.jsx)(s.h4,{id:"storage-organization",children:"Storage Organization"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-organization=indexed-sequential-access-method-isam",children:"Indexed Sequential Access Method (ISAM)"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?storage-organization=sorted-files",children:"Sorted Files"})]}),"\n",(0,n.jsx)(s.h4,{id:"stored-procedures",children:"Stored Procedures"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?stored-procedures=not-supported",children:"Not Supported"})}),"\n",(0,n.jsx)(s.p,{children:"Currently, stored procedures and UDF are listed as open issues in ClickHouse."}),"\n",(0,n.jsx)(s.h4,{id:"system-architecture",children:"System Architecture"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?system-architecture=shared-nothing",children:"Shared-Nothing"})}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse system in a distributed setup is a cluster of shards. It uses asynchronous multimaster replication and there is no single point of contention across the system."}),"\n",(0,n.jsx)(s.h4,{id:"views",children:"Views"}),"\n",(0,n.jsxs)(s.p,{children:[(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?views=virtual-views",children:"Virtual Views"}),"\xa0",(0,n.jsx)(s.a,{href:"https://dbdb.io/browse?views=materialized-views",children:"Materialized Views"})]}),"\n",(0,n.jsx)(s.p,{children:"ClickHouse supports both virtual views and materialized views. The materialized views store data transformed by corresponding SELECT query. The SELECT query can contain DISTINCT, GROUP BY, ORDER BY, LIMIT, etc."}),"\n",(0,n.jsx)(s.h2,{id:"internals",children:"Internals"}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/watch?v=zhrOYQpgvkk",children:"Modern SQL in 2023 - ClickHouse - YouTube"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/watch?v=CAS2otEoerM&ab_channel=ClickHouse",children:'"Building for Fast" by Alexey Milovidov, Amsterdam, June 2022 - YouTube'})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/docs/en/concepts/why-clickhouse-is-so-fast",children:"Why is ClickHouse so fast? | ClickHouse Docs"})}),"\n",(0,n.jsx)(s.h2,{id:"commands",children:"Commands"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"docker pull clickhouse/clickhouse-server\n\ndocker run -d -p 8123:8123 -p 9000:9000 --network=test-net --name some-clickhouse-server --ulimit nofile=262144:262144 clickhouse/clickhouse-server\n\ndocker run -d --name some-clickhouse-server -p 8123:8123 -p 9000:9000 --network=test-net -e CLICKHOUSE_DB=my_database -e CLICKHOUSE_USER=username -e CLICKHOUSE_DEFAULT_ACCESS_MANAGEMENT=1 -e CLICKHOUSE_PASSWORD=password --ulimit nofile=262144:262144 clickhouse/clickhouse-server\n\n# https://hub.docker.com/r/clickhouse/clickhouse-server/\n\necho 'SELECT version()' | curl 'http://localhost:8123/' --data-binary @-\n"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/docs/en/interfaces/third-party/gui",children:"Visual Interfaces from Third-party Developers | ClickHouse Docs"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://github.com/ClickHouse/metabase-clickhouse-driver",children:"GitHub - ClickHouse/metabase-clickhouse-driver: ClickHouse database driver for the Metabase business intelligence front-end"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-sql",children:"-- https://clickhouse.com/docs/en/getting-started/quick-start\n\nclickhouse client\n\nCREATE TABLE my_first_table\n(\n    user_id UInt32,\n    message String,\n    timestamp DateTime,\n    metric Float32\n)\nENGINE = MergeTree\nPRIMARY KEY (user_id, timestamp)\n\nINSERT INTO my_first_table (user_id, message, timestamp, metric) VALUES\n    (101, 'Hello, ClickHouse!',                                 now(),       -1.0    ),\n    (102, 'Insert a lot of rows per batch',                     yesterday(), 1.41421 ),\n    (102, 'Sort your data based on your commonly-used queries', today(),     2.718   ),\n    (101, 'Granules are the smallest chunks of data read',      now() + 5,   3.14159 )\n\n SELECT *\n FROM my_first_table\n ORDER BY timestamp\n\nSELECT\n   passenger_count,\n   avg(toFloat32(total_amount))\nFROM s3(\n    'https://datasets-documentation.s3.eu-west-3.amazonaws.com/nyc-taxi/trips_0.gz',\n    'TabSeparatedWithNames'\n)\nGROUP BY passenger_count\nORDER BY passenger_count;\n"})}),"\n",(0,n.jsx)(s.p,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/docs/en/getting-started/example-datasets/nyc-taxi",children:"New York Taxi Data | ClickHouse Docs"})}),"\n",(0,n.jsx)(s.h2,{id:"links",children:"Links"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/",children:"Fast Open-Source OLAP DBMS - ClickHouse"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://github.com/ClickHouse/ClickHouse",children:"GitHub - ClickHouse/ClickHouse: ClickHouse is a free analytics DBMS for big data"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/c/ClickHouseDB",children:"ClickHouse - YouTube"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/docs/en/intro",children:"What Is ClickHouse? | ClickHouse Docs"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/company/events/getting-started-with-clickhouse?loc=getting-started",children:"Getting Started with ClickHouse"})}),"\n",(0,n.jsx)(s.li,{children:"Used by - Zerodha, Cloudflare, Uber, Ebay (moved from postgres, elk, druid to clickhouse)"}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/playlist?list=PL0Z2YDlm0b3gcY5R_MUo4fT5bPqUQ66ep",children:"Learn ClickHouse with Mark - YouTube"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/playlist?list=PL0Z2YDlm0b3gtIdcZI3B_8bMJclDOvY8s",children:'ClickHouse Academy - "How to" Sessions - YouTube'})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/blog/clickhouse-1-trillion-row-challenge",children:"ClickHouse and The One Trillion Row Challenge"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/watch?v=P7O6HRbFkL8&ab_channel=binlogic",children:"DataOps Barcelona 2018 - Clickhouse Use Cases - YouTube"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/watch?v=fGG9dApIhDU&ab_channel=CMUDatabaseGroup",children:"YouTube"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://www.youtube.com/watch?v=ZOZQCQEtrz8&ab_channel=ClickHouse",children:"The Secrets of ClickHouse Performance Optimizations at BDTC 2019 - YouTube"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/blog/didi-migrates-from-elasticsearch-to-clickHouse-for-a-new-generation-log-storage-system",children:"Didi Migrates from Elasticsearch to ClickHouse for a new Generation Log Storage System"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://platformatory.io/blog/Building-a-Robust-Data-Pipeline-with-Kafka-and-ClickHouse/",children:"Building a Robust Data Pipeline with Kafka and ClickHouse | The Write Ahead Log"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"https://clickhouse.com/blog/first-clickhouse-research-paper-vldb-lightning-fast-analytics-for-everyone",children:"First ClickHouse research paper: How do you make a modern data analytics database lightning-fast?"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},511151:(e,s,i)=>{i.d(s,{Z:()=>a,a:()=>o});var n=i(667294);const r={},t=n.createContext(r);function o(e){const s=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(t.Provider,{value:s},e.children)}}}]);