"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[34470],{303443:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var n=s(785893),a=s(511151);const i={},o="Last Will and Testament",l={id:"networking/mqtt/last-will-and-testament",title:"Last Will and Testament",description:"Because MQTT is often used in scenarios that include unreliable networks, it's reasonable to assume that some of the MQTT clients in these scenarios will occasionally disconnect ungracefully. An ungraceful disconnect can occur due to loss of connection, empty batteries, or many other reasons. Knowing whether a client disconnected gracefully (with an MQTTDISCONNECT message) or ungracefully (without a disconnect message), helps you respond correctly. The Last Will and Testament feature provides a way for clients to respond to ungraceful disconnects in an appropriate way.",source:"@site/docs/networking/mqtt/last-will-and-testament.md",sourceDirName:"networking/mqtt",slug:"/networking/mqtt/last-will-and-testament",permalink:"/networking/mqtt/last-will-and-testament",draft:!1,unlisted:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/networking/mqtt/last-will-and-testament.md",tags:[],version:"current",lastUpdatedAt:1701793554,formattedLastUpdatedAt:"Dec 5, 2023",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Keep Alive & Client Take-Over",permalink:"/networking/mqtt/keep-alive-and-client-take-over"},next:{title:"Libraries",permalink:"/networking/mqtt/libraries"}},r={},c=[{value:"How do you specify a LWT message for a client?",id:"how-do-you-specify-a-lwt-message-for-a-client",level:2},{value:"When does a broker send the LWT message?",id:"when-does-a-broker-send-the-lwt-message",level:2},{value:"Best Practices - When should you use LWT?",id:"best-practices---when-should-you-use-lwt",level:2},{value:"References",id:"references",level:2}];function d(e){const t={a:"a",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,a.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"last-will-and-testament",children:"Last Will and Testament"}),"\n",(0,n.jsx)(t.p,{children:"Because MQTT is often used in scenarios that include unreliable networks, it's reasonable to assume that some of the MQTT clients in these scenarios will occasionally disconnect ungracefully. An ungraceful disconnect can occur due to loss of connection, empty batteries, or many other reasons. Knowing whether a client disconnected gracefully (with an MQTTDISCONNECT message) or ungracefully (without a disconnect message), helps you respond correctly. The Last Will and Testament feature provides a way for clients to respond to ungraceful disconnects in an appropriate way."}),"\n",(0,n.jsx)(t.p,{children:"In MQTT, you use the Last Will and Testament (LWT) feature to notify other clients about an ungracefully disconnected client. Each client can specify its last will message when it connects to a broker. The last will message is a normal MQTT message with a topic, retained message flag, QoS, and payload. The broker stores the message until it detects that the client has disconnected ungracefully. In response to the ungraceful disconnect, the broker sends the last-will message to all subscribed clients of the last-will message topic. If the client disconnects gracefully with a correct DISCONNECT message, the broker discards the stored LWT message."}),"\n",(0,n.jsx)(t.p,{children:"LWT helps you implement various strategies when the connection of a client drops (or at least inform other clients about the offline status)."}),"\n",(0,n.jsx)(t.h2,{id:"how-do-you-specify-a-lwt-message-for-a-client",children:"How do you specify a LWT message for a client?"}),"\n",(0,n.jsx)(t.p,{children:"Clients can specify an LWT message in the CONNECT message that initiates the connection between the client and the broker."}),"\n",(0,n.jsx)(t.h2,{id:"when-does-a-broker-send-the-lwt-message",children:"When does a broker send the LWT message?"}),"\n",(0,n.jsxs)(t.p,{children:["According to the ",(0,n.jsx)(t.a,{href:"http://docs.oasis-open.org/mqtt/mqtt/v3.1.1/mqtt-v3.1.1.html",children:"MQTT 3.1.1 specification"}),", the broker must distribute the LWT of a client in the following situations:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"The broker detects an I/O error or network failure."}),"\n",(0,n.jsx)(t.li,{children:"The client fails to communicate within the defined Keep Alive period."}),"\n",(0,n.jsx)(t.li,{children:"The client does not send a DISCONNECT packet before it closes the network connection."}),"\n",(0,n.jsx)(t.li,{children:"The broker closes the network connection because of a protocol error."}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"best-practices---when-should-you-use-lwt",children:"Best Practices - When should you use LWT?"}),"\n",(0,n.jsxs)(t.p,{children:["LWT is a great way to notify other subscribed clients about the unexpected loss of connection of another client. In real-world scenarios, LWT is often combined with ",(0,n.jsx)(t.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-8-retained-messages/",children:"retained messages"}),' to store the state of a client on a specific topic. For example, client1 first sends a CONNECT message to the broker with a lastWillMessage that has "Offline" as the payload, the lastWillRetain flag set to true, and the lastWillTopic set to client1/status. Next, the client sends a PUBLISH message with the payload "Online" and the retained flag set to true to the same topic (client1/status). As long as client1 stays connected, newly-subscribed clients to the client1/status topic receive the "Online" retained message. If client1 disconnects unexpectedly, the broker publishes the LWT message with the payload "Offline" as the new retained message. Clients that subscribe to the topic while client1 is offline, receive the LWT retained message ("Offline") from the broker. This pattern of retained messages keeps other clients up to date on the current status of client1 on a specific topic.']}),"\n",(0,n.jsx)(t.h2,{id:"references",children:"References"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament",children:"https://www.hivemq.com/blog/mqtt-essentials-part-9-last-will-and-testament"})})]})}function h(e={}){const{wrapper:t}={...(0,a.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},511151:(e,t,s)=>{s.d(t,{Z:()=>l,a:()=>o});var n=s(667294);const a={},i=n.createContext(a);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);