"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[1164],{966085:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"databases-nosql/redis/redis-py","title":"redis-py","description":"check pending list in redis","source":"@site/docs/databases-nosql/redis/redis-py.md","sourceDirName":"databases-nosql/redis","slug":"/databases-nosql/redis/redis-py","permalink":"/databases-nosql/redis/redis-py","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/databases-nosql/redis/redis-py.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1749575438000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Redis Eviction Policies","permalink":"/databases-nosql/redis/redis-eviction-policies"},"next":{"title":"Redis Queues","permalink":"/databases-nosql/redis/redis-queues"}}');var t=s(474848),r=s(28453);const d={},o="redis-py",l={},a=[{value:"check pending list in redis",id:"check-pending-list-in-redis",level:3},{value:"Sentinel",id:"sentinel",level:2},{value:"purge queue",id:"purge-queue",level:3},{value:"Redis-OM",id:"redis-om",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"redis-py",children:"redis-py"})}),"\n",(0,t.jsx)(n.h3,{id:"check-pending-list-in-redis",children:"check pending list in redis"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'pip install ipython\nipython\n\nfrom config.redis_setup import redis_client\n\ndef get_pending(queue):\n last_id = redis_client.xinfo_groups(queue)[0]["last-delivered-id"]\n return len(redis_client.xread({queue: last_id})[0][1])\n\nget_pending("send:pinpoint_sms")\nget_pending("send:offer_email")\nget_pending("send:sms")\nget_pending("send:offer_sms")\nget_pending("send:push_notification")\nget_pending("send:offer_push_notification")\nget_pending("send:whatsapp_sms")\nget_pending("send:whatsapp_offer_sms")\n\npip install redis==3.4.1\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import redis\n\nr = redis.Redis(host='redis', port=6379, db=0, password='password')\n\nr.set('foo', 'bar')\n\nr.get('foo')\nfor key, value in enumerate(r.keys('test:*')):\n\nredis_key = value.decode(\"utf-8\")\n\nsize = r.debug_object(redis_key)\n\nprint(f'{key},{redis_key},{r.ttl(redis_key)},{r.llen(redis_key)},{size [\"serializedlength\"]},{size [\"ql_uncompressed_size\"]}')\n\nfor key, value in enumerate(r.keys('test:*')):\n    print(key, value)\n\nclass redis.Redis(host=u'localhost',port=6379,db=0, password=None, socket_timeout=None, socket_connect_timeout=None, socket_keepalive=None, socket_keepalive_options=None, connection_pool=None, unix_socket_path=None, encoding=u'utf-8', encoding_errors=u'strict', charset=None, errors=None, decode_responses=False, retry_on_timeout=False, ssl=False, ssl_keyfile=None, ssl_certfile=None, ssl_cert_reqs=u'required', ssl_ca_certs=None, max_connections=None, single_connection_client=False, health_check_interval=0)\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"get(name)"})," - Return the value at key name, or None if the key doesn't exist"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getset(name,value)"})," - Sets the value at key name to value and returns the old value at key name atomically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"exists(*names)"})," Returns the number of names that exist"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"keys(pattern=u'*')"})," - Returns a list of keys matching pattern"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"append(key,value)"})," - Appends the string value to the value at key. If key doesn't already exist, create it with a value of value. Returns the new length of the value at key."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rpush(name,*values)"})," - Push values onto the tail of the list name"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"rpushx(name,value)"})," - Push value onto the tail of the list name if name exists"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"lrange(name,start,end)"})," - Return a slice of the list name between position start and end. start and end can be negative numbers just like Python slicing notation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ttl(name)"})," - Returns the number of seconds until the key name will expire"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"type(name)"})," - Returns the type of key name"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"set(name,value,ex=None,px=None,nx=False,xx=False, keepttl=False)"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Set the value at key name to value"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"ex"})," sets an expire flag on key name for ex seconds."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"px"})," sets an expire flag on keynameforpxmilliseconds."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nx"})," if set to True, set the value at key name to value only if it does not exist."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"xx"})," if set to True, set the value at key name to value only if it already exists."]}),"\n",(0,t.jsx)(n.li,{children:"keepttl if True, retain the time to live associated with the key. (Available since Redis 6.0)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"sentinel",children:"Sentinel"}),"\n",(0,t.jsxs)(n.p,{children:["redis-py can be used together with ",(0,t.jsx)(n.a,{href:"https://redis.io/topics/sentinel",children:"Redis Sentinel"})," to discover Redis nodes. You need to have at least one Sentinel daemon running in order to use redis-py's Sentinel support."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://redis-py.readthedocs.io/en/latest",children:"https://redis-py.readthedocs.io/en/latest"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://realpython.com/python-redis",children:"https://realpython.com/python-redis"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://pypi.org/project/redis",children:"https://pypi.org/project/redis"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/andymccurdy/redis-py",children:"https://github.com/andymccurdy/redis-py"})}),"\n",(0,t.jsx)(n.h3,{id:"purge-queue",children:"purge queue"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"\nz = redis_client.xpending_range('send:offer_push_notification', 'offer_push_notification_consumer', \"-\", \"+\", 10000000)\n\nfor i in z:\n   redis_client.xack('send:offer_push_notification', 'offer_push_notification_consumer', i['message_id'])\n\nz = redis_client.xpending_range('send:whatsapp_offer_sms', 'offer_whatsapp_consumer', \"-\", \"+\", 100000)\n\nfor i in z:\n   redis_client.xack('send:whatsapp_offer_sms', 'offer_whatsapp_consumer', i['message_id'])\n"})}),"\n",(0,t.jsx)(n.h3,{id:"redis-om",children:"Redis-OM"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/redis/redis-om-python",children:"https://github.com/redis/redis-om-python"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://redis.com/blog/introducing-redis-om-client-libraries",children:"https://redis.com/blog/introducing-redis-om-client-libraries"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>o});var i=s(296540);const t={},r=i.createContext(t);function d(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);