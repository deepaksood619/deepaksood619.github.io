"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[85346],{946245:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"languages/sql/dml-data-manipulation-language","title":"DML - Data Manipulation Language","description":"DML (Data Manipulation Language) commands need to be commited/rolled back","source":"@site/docs/languages/sql/dml-data-manipulation-language.md","sourceDirName":"languages/sql","slug":"/languages/sql/dml-data-manipulation-language","permalink":"/languages/sql/dml-data-manipulation-language","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/languages/sql/dml-data-manipulation-language.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1739572825000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Truncate vs Delete","permalink":"/languages/sql/ddl-data-definition-language/truncate-delete"},"next":{"title":"DQL - Data Query Language","permalink":"/languages/sql/dql-data-query-language/"}}');var a=s(474848),i=s(28453);const l={},r="DML - Data Manipulation Language",d={},o=[{value:"DML",id:"dml",level:2},{value:"DELETE",id:"delete",level:3},{value:"INSERT INTO",id:"insert-into",level:3},{value:"Bulk Insert / Extended Inserts",id:"bulk-insert--extended-inserts",level:3},{value:"Insert vs Insert Ignore",id:"insert-vs-insert-ignore",level:3},{value:"Load",id:"load",level:3},{value:"UPDATE",id:"update",level:3},{value:"UPSERT",id:"upsert",level:3},{value:"Explain",id:"explain",level:2},{value:"Output",id:"output",level:3},{value:"Extra",id:"extra",level:4},{value:"Explain Analyze",id:"explain-analyze",level:3},{value:"Lock Tables",id:"lock-tables",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"dml---data-manipulation-language",children:"DML - Data Manipulation Language"})}),"\n",(0,a.jsxs)(n.p,{children:["DML (Data Manipulation Language) commands ",(0,a.jsx)(n.a,{href:"http://www.dba-oracle.com/t_dml_statements.htm",children:"need to be"})," ",(0,a.jsx)(n.strong,{children:"commited/rolled back"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- online query without locking the tables during update\nSET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;\n"})}),"\n",(0,a.jsx)(n.h2,{id:"dml",children:"DML"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Insert"}),"\n",(0,a.jsx)(n.li,{children:"Update"}),"\n",(0,a.jsx)(n.li,{children:"Delete"}),"\n",(0,a.jsx)(n.li,{children:"Merge"}),"\n",(0,a.jsx)(n.li,{children:"Call"}),"\n",(0,a.jsx)(n.li,{children:"Explain Plain"}),"\n",(0,a.jsx)(n.li,{children:"Lock Table"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"delete",children:"DELETE"}),"\n",(0,a.jsx)(n.p,{children:"DELETE statements are used to remove rows from a table."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"DELETE FROM table_name WHERE some_column = some_value;\n"})}),"\n",(0,a.jsx)(n.p,{children:"Always better to use between than comparison operator, so that lock is not taken on whole table, but only range locks are taken."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"-- good\nDELETE FROM orders WHERE order_id betwen 0 and 100;\n\n-- bad\nDELETE FROM orders WHERE order_id < 100;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"insert-into",children:"INSERT INTO"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO table_name\nVALUES (value1, value2, value3,....)\nor\nINSERT INTO table_name\n(column1, column2, column3,...)\nVALUES (value1, value2, value3,....)\n\nINSERT INTO table_name (column_1, column_2, column_3) VALUES (value_1, 'value_2', value_3);\nINSERT statements are used to add a new row to a table.\n\nINSERT INTO cron_migrate_data (`table_name`, `start_date`, `end_date`, `s3_file_path`) VALUES ('equifax_raw_response', '2019-10-01 00:00:00', '2019-10-31 23:59:59', 's3-ap-south-1://stashfin-migration-data/rds/');\n\n-- copy whole table to new table\nINSERT INTO table_name_backup SELECT * FROM table_name;\n"})}),"\n",(0,a.jsx)(n.h3,{id:"bulk-insert--extended-inserts",children:"Bulk Insert / Extended Inserts"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT IGNORE INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test4'), ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test5'), ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test7');\n"})}),"\n",(0,a.jsx)(n.h3,{id:"insert-vs-insert-ignore",children:"Insert vs Insert Ignore"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"# avg - 0.074 sec\n# gives error\nINSERT INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test');\n\n# avg - 0.400 sec\n# is 5.4 times slower\n# gives warning\nINSERT IGNORE INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nVALUES ('2322675', 'test', 'test', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test');\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Insert ingore consumes autoincrement id and can put holes in between rows"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://stackoverflow.com/questions/5655396/why-insert-ignore-increments-the-auto-increment-primary-key",children:"https://stackoverflow.com/questions/5655396/why-insert-ignore-increments-the-auto-increment-primary-key"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://www.percona.com/blog/2011/11/29/avoiding-auto-increment-holes-on-innodb-with-insert-ignore/",children:(0,a.jsx)(n.strong,{children:"https://www.percona.com/blog/2011/11/29/avoiding-auto-increment-holes-on-innodb-with-insert-ignore/"})})}),"\n",(0,a.jsx)(n.li,{children:"innodb_autoinc_lock_mode = 0"}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html",children:"https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Alternatives"}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"INSERT INTO userDeviceApps (`customer_id`, `app_name`, `package_name`, `version_name`, `version_code`,\n`installation_date`, `last_used_date`, `create_date`, `device_id`, `hash_key`)\nSELECT '2322675', 'test3', 'test2', '0.0.0', '0',\n'0000-00-00 00:00:00', '0000-00-00 00:00:00', '2021-01-06 18:13:15', 'xxx', '2322675,test3'\nFROM DUAL\nWHERE NOT EXISTS(\n    SELECT 1\n    FROM userDeviceApps\n    WHERE hash_key = '2322675,test3'\n)\nLIMIT 1;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://ypereirareis.github.io/blog/2016/03/22/mysql-insert-ignore-alternatives",children:"https://ypereirareis.github.io/blog/2016/03/22/mysql-insert-ignore-alternatives"})}),"\n",(0,a.jsx)(n.h3,{id:"load",children:"Load"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"LOAD DATA INFILE 'st_bank_model_features_dedupe.csv'\nINTO TABLE st_bank_model_features_dedupe\nFIELDS TERMINATED BY ','\nENCLOSED BY '\"'\nLINES TERMINATED BY '\\n'\nIGNORE 1 ROWS\nSET create_date = STR_TO_DATE(@create_date, '%d/%m/%Y %H:%i');\n"})}),"\n",(0,a.jsx)(n.h3,{id:"update",children:"UPDATE"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"UPDATE table_name\nSET some_column = some_value\nWHERE some_column = some_value;\n-- UPDATE statments allow you to edit rows in a table.\n\nUPDATE`table_name`\n SET`field_name` =replace(same_field_name, 'unwanted_text', 'wanted_text')\n"})}),"\n",(0,a.jsx)(n.h3,{id:"upsert",children:"UPSERT"}),"\n",(0,a.jsx)(n.p,{children:"An upsert is a smart operation which turns into INSERT or UPDATE whichever is applicable. Also, it is an atomic transaction, means complete in a single step. Let's understand -- If a record is new, then UPSERT triggers an INSERT. But, if it already exists, then UPSERT performs an UPDATE."}),"\n",(0,a.jsx)(n.p,{children:"MySQL provides the ON DUPLICATE KEY UPDATE option to INSERT, which accomplishes this behavior. However, there are other statements like INSERT IGNORE or REPLACE, which can also fulfill this objective."}),"\n",(0,a.jsx)(n.p,{children:"We can imitate MySQL UPSERT in one of these three ways:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-insert",children:"UPSERT using INSERT IGNORE"})}),"\n",(0,a.jsx)(n.p,{children:"When we use INSERT IGNORE for adding a record, it gets through even if there are errors in performing INSERT. So, if the target table already has a row with a matching UNIQUE or PRIMARY key, then INSERT REPLACE would suppress all possible errors."}),"\n",(0,a.jsx)(n.p,{children:"Moreover, it skips the INSERT operation altogether. Such kind of statement is useful when we need to add a large number of records in one go. And, the table may already have a part of that data inside."}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-replace",children:"UPSERT using REPLACE"})}),"\n",(0,a.jsx)(n.p,{children:"There come situations when we have to replace some rows even if INSERT could fail due to duplicate values of the primary key field. Hence, we should use the REPLACE statement for such cases."}),"\n",(0,a.jsx)(n.p,{children:"However, if we opt to use REPLACE, then it could result in one of the following outcomes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If we don't face any error, then REPLACE would behave as regular INSERT command."}),"\n",(0,a.jsx)(n.li,{children:"If a duplicate record exists, then REPLACE would first delete it and perform the INSERT subsequently."}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:[(0,a.jsx)(n.a,{href:"https://www.techbeamers.com/mysql-upsert/#upsert-using-update",children:"UPSERT using INSERT with ON DUPLICATE KEY UPDATE"})," (UPSERT)"]})}),"\n",(0,a.jsx)(n.p,{children:"It is non-destructive, means it doesn't have to drop the duplicate row. Instead, it issues an UPDATE whenever it finds a matching record having the same UNIQUE or PRIMARY KEY value."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.techbeamers.com/mysql-upsert",children:"https://www.techbeamers.com/mysql-upsert"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.javatpoint.com/mysql-upsert",children:"https://www.javatpoint.com/mysql-upsert"})}),"\n",(0,a.jsx)(n.h2,{id:"explain",children:"Explain"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/explain.html",children:"EXPLAIN"})," works with ",(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/select.html",children:"SELECT"}),", ",(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/delete.html",children:"DELETE"}),", ",(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/insert.html",children:"INSERT"}),", ",(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/replace.html",children:"REPLACE"}),", and ",(0,a.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/update.html",children:"UPDATE"})," statements."]}),"\n",(0,a.jsx)(n.p,{children:"EXPLAIN EXTENDED"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"The indexes it's considering using."}),"\n",(0,a.jsx)(n.li,{children:"The order in which it plans to join tables."}),"\n",(0,a.jsx)(n.li,{children:"The indexes it actually used."}),"\n",(0,a.jsx)(n.li,{children:"How many rows will be accessed."}),"\n",(0,a.jsx)(n.li,{children:"Whether it used a filesort."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"output",children:"Output"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Possible keys:"})," shows the keys that can be used by MySQL to find rows from the table, if this is NULL it indicates no useful indexes could be applied."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Key:"})," indicates the actual index that MySQL used."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Rows:"})," shows the number of records that were examined to produce the output. This is especially relevant during joins."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Key_len:"})," longest length of the key that was used (aka which parts of the composite index are being used) use this to tell how many columns were used from it."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Ref:"})," which columns, or constants are compared to the index in order to select rows."]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"extra",children:"Extra"}),"\n",(0,a.jsx)(n.p,{children:"What you would like to see in Extra:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Using index - MySQL was able to use a covering index"}),"\n",(0,a.jsx)(n.li,{children:"Distinct - MySQL stops searching after it found the first matching row"}),"\n",(0,a.jsx)(n.li,{children:"Using index condition"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"What you don't want to see in Extra:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Using file sort - as said extra sorting was required"}),"\n",(0,a.jsx)(n.li,{children:"Using temporary - a temp table was needed"}),"\n",(0,a.jsx)(n.li,{children:"Using join buffer - tables processed in large batches of rows, instead of index lookups"}),"\n",(0,a.jsx)(n.li,{children:"Using where - after fetching rows from storage engine, extra filtering needs to happen for each row. However it's OK if a very small number of rows were returned."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.sitepoint.com/using-explain-to-write-better-mysql-queries",children:"https://www.sitepoint.com/using-explain-to-write-better-mysql-queries"})}),"\n",(0,a.jsx)(n.h3,{id:"explain-analyze",children:"Explain Analyze"}),"\n",(0,a.jsxs)(n.p,{children:["In MySQL 8.0.18, ",(0,a.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," was introduced, a new concept built on top of the regular ",(0,a.jsx)(n.code,{children:"EXPLAIN"})," query plan inspection tool. In addition to the query plan and estimated costs, which a normal ",(0,a.jsx)(n.code,{children:"EXPLAIN"})," will print, ",(0,a.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," also prints the ",(0,a.jsx)(n.em,{children:"actual"})," costs of individual iterators in the execution plan."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Warning"})," - ",(0,a.jsx)(n.code,{children:"EXPLAIN ANALYZE"})," actually runs the query, so if you don\u2019t want to run the query against your live database, do not use ",(0,a.jsx)(n.code,{children:"EXPLAIN ANALYZE"}),"."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://planetscale.com/blog/how-read-mysql-explains",children:"How to read MySQL EXPLAINs"})}),"\n",(0,a.jsx)(n.h2,{id:"lock-tables",children:"Lock Tables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"START TRANSACTION;\nlock table bureau_account_list WRITE;\ndelete from bureau_account_list where id = 0;\nALTER TABLE bureau_account_list\nCHANGE COLUMN id id BIGINT(20) NOT NULL AUTO_INCREMENT ;\n\nALTER TABLE bureau_account_list AUTO_INCREMENT = 400000000;\n\nALTER TABLE sttash_website_LIVE.bureau_account_list\nCHANGE COLUMN create_date create_date DATETIME NULL DEFAULT CURRENT_TIMESTAMP ;\n\nUNLOCK TABLES;\n\nCOMMIT;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var t=s(296540);const a={},i=t.createContext(a);function l(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);