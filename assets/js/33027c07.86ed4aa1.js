"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[31438],{832807:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"computer-science/system-design/case-study/02-architectural-design","title":"Architectural Design","description":"Architectural Design","source":"@site/docs/computer-science/system-design/case-study/02-architectural-design.md","sourceDirName":"computer-science/system-design/case-study","slug":"/computer-science/system-design/case-study/02-architectural-design","permalink":"/computer-science/system-design/case-study/02-architectural-design","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/computer-science/system-design/case-study/02-architectural-design.md","tags":[],"version":"current","lastUpdatedBy":"Deepak Sood","lastUpdatedAt":1769708615000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Solution","permalink":"/computer-science/system-design/case-study/01-solution"},"next":{"title":"Security and DR","permalink":"/computer-science/system-design/case-study/03-security-and-dr"}}');var t=s(474848),r=s(28453);const c={},a="Architectural Design",o={},l=[{value:"High-Level Architecture Diagram Description",id:"high-level-architecture-diagram-description",level:2},{value:"Detailed Data Flow and Schema Design",id:"detailed-data-flow-and-schema-design",level:2},{value:"Handling The Known Customer: The Temporal Join Pattern",id:"handling-the-known-customer-the-temporal-join-pattern",level:2},{value:"Handling The Unknown Applicant: The Async I/O Pattern",id:"handling-the-unknown-applicant-the-async-io-pattern",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"architectural-design",children:"Architectural Design"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Architectural Design",src:s(68947).A+"",width:"964",height:"716"})}),"\n",(0,t.jsx)(n.h2,{id:"high-level-architecture-diagram-description",children:"High-Level Architecture Diagram Description"}),"\n",(0,t.jsx)(n.p,{children:'The architecture follows a "Split-Enrich-Merge" pattern, designed to isolate the high-latency external dependencies from the low-latency internal logic.'}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Ingestion Layer:"})," POS terminals send Loan Application events to the ",(0,t.jsx)(n.code,{children:"loan_applications"})," topic in Confluent Cloud via a secure API Gateway (using Confluent REST Proxy or native Producer clients)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Routing Layer (Flink):"})," A Flink job consumes the ",(0,t.jsx)(n.code,{children:"loan_applications"})," topic. It inspects the payload to determine if the applicant is ",(0,t.jsx)(n.code,{children:"KNOWN"})," or ",(0,t.jsx)(n.code,{children:"UNKNOWN"}),". It splits the stream into two distinct logical paths: ",(0,t.jsx)(n.code,{children:"internal_processing_stream"})," and ",(0,t.jsx)(n.code,{children:"external_processing_stream"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Internal Enrichment Layer (The Fast Lane):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"internal_processing_stream"})," is joined with the ",(0,t.jsx)(n.code,{children:"customer_360"})," topic."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"customer_360"})," topic is populated by the Oracle CDC connector, containing real-time snapshots of existing customers."]}),"\n",(0,t.jsxs)(n.li,{children:["The join is a ",(0,t.jsx)(n.strong,{children:"Temporal Join"}),", ensuring the application is evaluated against the customer's status ",(0,t.jsx)(n.em,{children:"at the exact time of application"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"External Enrichment Layer (The Async Lane):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"external_processing_stream"})," is processed by a Flink job utilizing ",(0,t.jsx)(n.strong,{children:"Async I/O"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"This job makes a non-blocking HTTP request to the Credit Bureau API."}),"\n",(0,t.jsx)(n.li,{children:"While waiting for the bureau to respond (e.g., 500ms), Flink continues to process other records."}),"\n",(0,t.jsx)(n.li,{children:"Once the response arrives, the event is enriched with the credit score."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Decisioning & Egress:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Both streams merge into a final Scoring Operator (Flink SQL ",(0,t.jsx)(n.code,{children:"CASE"})," logic)."]}),"\n",(0,t.jsxs)(n.li,{children:["The result (",(0,t.jsx)(n.code,{children:"APPROVED"})," / ",(0,t.jsx)(n.code,{children:"DECLINED"}),") is written to the ",(0,t.jsx)(n.code,{children:"loan_decisions"})," topic."]}),"\n",(0,t.jsx)(n.li,{children:"The POS system (listening via WebSocket or long-polling) receives the decision."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"detailed-data-flow-and-schema-design",children:"Detailed Data Flow and Schema Design"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Data Contract: The Loan Application Event"})}),"\n",(0,t.jsx)(n.p,{children:"Defining the schema is the first step in ensuring system stability. We utilize Avro for its compact binary format and schema evolution capabilities."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "namespace": "com.bfb.pos",\n  "name": "LoanApplication",\n  "type": "record",\n  "fields":}},\n    {"name": "applicant_details", "type": "com.bfb.PII.Applicant"}\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.em,{children:["Note the ",(0,t.jsx)(n.code,{children:"applicant_details"})," field. This contains sensitive PII (SSN, Name, Address) and must be encrypted."]})}),"\n",(0,t.jsx)(n.h2,{id:"handling-the-known-customer-the-temporal-join-pattern",children:"Handling The Known Customer: The Temporal Join Pattern"}),"\n",(0,t.jsx)(n.p,{children:"For known customers, BFB requires sub-millisecond decisioning. Querying the Oracle database directly for every POS transaction is an anti-pattern; it introduces latency and creates a dependency that can crash the core banking system under load."}),"\n",(0,t.jsxs)(n.p,{children:["Instead, we use the ",(0,t.jsx)(n.strong,{children:"Side-Car Database Pattern"})," implemented via Kafka."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"CDC Ingestion:"})," The Oracle CDC Source Connector monitors the Redo Logs of the core banking system. Any change to a customer's balance or risk tier is immediately captured and written to the ",(0,t.jsx)(n.code,{children:"customer_360"})," Kafka topic."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compacted Topic:"})," This topic is configured with ",(0,t.jsx)(n.code,{children:"cleanup.policy=compact"}),". This ensures that we always retain the ",(0,t.jsx)(n.em,{children:"latest"})," state for every ",(0,t.jsx)(n.code,{children:"customer_id"}),", effectively turning the Kafka topic into a high-performance, streaming database table."]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Flink Temporal Join:"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["In Flink SQL, we model this topic as a versioned table. When a loan application arrives at ",(0,t.jsx)(n.code,{children:"T1"}),", Flink joins it with the state of the customer record as it existed at ",(0,t.jsx)(n.code,{children:"T1"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\n  L.application_id,\n  C.credit_limit - C.current_balance AS available_credit\nFROM loan_applications AS L\nJOIN customer_360 FOR SYSTEM_TIME AS OF L.timestamp AS C\nON L.customer_id = C.customer_id;\n"})}),"\n",(0,t.jsx)(n.p,{children:"This operation happens entirely within Flink's managed state, requiring no external network calls, ensuring maximum speed."}),"\n",(0,t.jsx)(n.h2,{id:"handling-the-unknown-applicant-the-async-io-pattern",children:"Handling The Unknown Applicant: The Async I/O Pattern"}),"\n",(0,t.jsx)(n.p,{children:"This workflow represents the highest technical risk due to the reliance on external Credit Bureau APIs. These APIs are slow (200ms - 2s) and unreliable."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"The Naive Approach (And Why It Fails):"})," A standard implementation might use a synchronous function: ",(0,t.jsx)(n.code,{children:"get_credit_score(ssn)"}),". If the API takes 500ms, the processing thread blocks for 500ms. If the system has 10 processing threads, the maximum throughput is limited to 20 events per second (10 threads / 0.5s). To handle holiday traffic of 10,000 events/second, BFB would need to provision 5,000 threads, which is prohibitively expensive and resource-intensive."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"The Flink Async Solution:"})}),"\n",(0,t.jsx)(n.p,{children:"Flink\u2019s Async I/O operator decouples the request from the response."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Request:"})," Flink sends the HTTP request to the Credit Bureau."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Suspend:"})," The operator suspends the processing of that specific event ",(0,t.jsx)(n.em,{children:"without blocking the thread"}),". The thread immediately moves on to process the next event."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Buffer:"}),' Flink maintains a buffer of "in-flight" requests.']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Callback:"})," When the Credit Bureau API responds (e.g., 500ms later), the callback is triggered, the result is matched to the original event, and processing resumes."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"By using this pattern, a single Flink task can manage thousands of concurrent API calls, maintaining high throughput even when the external API is slow."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Implementation with Flink SQL:"})}),"\n",(0,t.jsxs)(n.p,{children:["Confluent Cloud Flink supports this via the ",(0,t.jsx)(n.code,{children:"KEY_SEARCH_AGG"})," function or specialized REST lookup connectors that support the ",(0,t.jsx)(n.code,{children:"lookup.async"})," hint."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"SELECT\n  L.application_id,\n  Bureau.fico_score\nFROM loan_applications AS L\nJOIN LATERAL TABLE (\n  KEY_SEARCH_AGG(\n    'CreditBureauRestService',\n    DESCRIPTOR(ssn),\n    L.applicant_ssn,\n    MAP['async_enabled', 'true', 'capacity', '100']\n  )\n) AS Bureau ON TRUE;\n"})}),"\n",(0,t.jsx)(n.p,{children:"This declarative SQL approach abstracts the complexity of threading and callbacks, allowing BFB\u2019s developers to focus on business logic rather than concurrency programming."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},68947:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/Screenshot 2026-01-29 at 11.06.59 PM-9642d94b3c32f28934f784b859f94515.png"},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>a});var i=s(296540);const t={},r=i.createContext(t);function c(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);