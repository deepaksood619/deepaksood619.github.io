"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[72564],{136781:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"technologies/kafka/security/10-audit-logs","title":"Audit Logs","description":"Up until now, we have dealt with protecting your data, your system, and its resources with respect to specific events: the login process as well as access to resources after a successful login.","source":"@site/docs/technologies/kafka/security/10-audit-logs.md","sourceDirName":"technologies/kafka/security","slug":"/technologies/kafka/security/10-audit-logs","permalink":"/technologies/kafka/security/10-audit-logs","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/technologies/kafka/security/10-audit-logs.md","tags":[],"version":"current","lastUpdatedBy":"Deepak Sood","lastUpdatedAt":1769339984000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Securing ZooKeeper","permalink":"/technologies/kafka/security/09-securing-zookeeper"},"next":{"title":"Security Recommendations","permalink":"/technologies/kafka/security/11-security-recommendations"}}');var s=t(474848),n=t(28453);const i={},a="Audit Logs",c={},l=[{value:"Kafka Authorizer Logger",id:"kafka-authorizer-logger",level:2},{value:"Kafka Request Logger",id:"kafka-request-logger",level:2},{value:"Considerations",id:"considerations",level:2}];function d(e){const o={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.header,{children:(0,s.jsx)(o.h1,{id:"audit-logs",children:"Audit Logs"})}),"\n",(0,s.jsx)(o.p,{children:"Up until now, we have dealt with protecting your data, your system, and its resources with respect to specific events: the login process as well as access to resources after a successful login."}),"\n",(0,s.jsx)(o.p,{children:"However, your system may be targeted in some manner outside of these more orderly sequences. For example, a rogue client may spawn fake messages or you may experience a DDoS-style attack on broker resources. If one of these happened, how would you know you had been targeted, and how could you identify the perpetrators as well as the sequence of events? Furthermore, is there a way that you can prevent future attacks?"}),"\n",(0,s.jsx)(o.p,{children:"Audit logs can help because they provide records of everything that has happened on a system. Specifically, they provide:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"Insight"}),"\xa0\u2013 They provide insight into situations such as trying to determine if a particular group of users was successful in authenticating and getting access to the correct broker resources after a new ACL was added"]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"Security"}),"\xa0\u2013 They enhance security by letting you identify anomalies and unauthorized operations in the historical record so that you can take action as quickly as possible"]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"Impact"}),"\xa0\u2013 They let you see who, as well as which services, have been impacted by unusual activities, so that you can communicate with stakeholders as the situation progresses"]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"Compliance"}),"\xa0\u2013 They enable you to generate audit reports according to internal policies and external regulations, and also provide an official record in the event of a security breach"]}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["Apache Kafka doesn't provide audit logging out of the box. It does, however, support comprehensive audit logging with Log4j, which can be configured to deliver events from separate logger instances to separate destinations (typically files). By configuring separate appenders for the\xa0",(0,s.jsx)(o.code,{children:"log4j.properties"}),"\xa0file on each broker, you can capture detailed information for auditing, monitoring, and debugging purposes."]}),"\n",(0,s.jsx)(o.h2,{id:"kafka-authorizer-logger",children:"Kafka Authorizer Logger"}),"\n",(0,s.jsxs)(o.p,{children:[(0,s.jsx)(o.strong,{children:(0,s.jsx)(o.code,{children:"kafka.authorizer.logger"})}),"\xa0is used for authorization logging and generates INFO entries for events where access was denied and DEBUG entries for those where access was allowed. Each entry includes the principal, client host, the attempted operation, and the accessed resource (e.g., a topic):"]}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.strong,{children:"log4j.properties"})}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.code,{children:"log4j.logger.kafka.authorizer.logger=DEBUG"})}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.strong,{children:"output"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-ini",children:"DEBUG Principal = User:Alice is Allowed Operation = Write from host = 127.0.0.1 on resource = Topic:LITERAL:customerOrders for request = Produce with resourceRefCount = 1 (kafka.authorizer.logger)\n\nINFO Principal = User:Mallory is Denied Operation = Describe from host = 10.0.0.13 on resource = Topic:LITERAL:customerOrders for request = Metadata with resourceRefCount = 1 (kafka.authorizer.logger)\n"})}),"\n",(0,s.jsx)(o.h2,{id:"kafka-request-logger",children:"Kafka Request Logger"}),"\n",(0,s.jsxs)(o.p,{children:["The\xa0",(0,s.jsx)(o.strong,{children:(0,s.jsx)(o.code,{children:"kafka.request.logger"})}),"\xa0logs the principal and client host at the DEBUG level as well as full details of the request when logging at the TRACE level:"]}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.strong,{children:"log4j.properties"})}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.code,{children:"log4j.logger.kafka.request.logger=DEBUG"})}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.strong,{children:"output"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-ini",children:"DEBUG Completed request:RequestHeader(apiKey=PRODUCE, apiVersion=8, clientId=producer-1, correlationId=6) -- {acks=-1,timeout=30000,partitionSizes=[customerOrders-0=15514]},response: {responses=[{topic=customerOrders,partition_responses=[{partition=0,error_code=0 ,base_offset=13,log_append_time=-1,log_start_offset=0,record_errors=[],error_mes sage=null}]}],throttle_time_ms=0} from connection 127.0.0.1:9094-127.0.0.1:61040-0;totalTime:2.42,requestQueueTime:0.112,local-Time:2.15,remoteTime:0.0,throttleTime:0,responseQueueTime:0.04,sendTime: 0.118,securityProtocol:SASL_SSL,principal:User:Alice,listener:SASL_SSL,clientInf ormation:ClientInformation(softwareName=apache-kafka-java, softwareVersion=2.7.0-SNAPSHOT) (kafka.request.logger)\n"})}),"\n",(0,s.jsx)(o.h2,{id:"considerations",children:"Considerations"}),"\n",(0,s.jsx)(o.p,{children:"Kafka's logs are bound to be useful to you, whether you use them for compliance, debugging, or anomaly detection. However, there are a few things to keep in mind:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Make sure there is enough disk space if you are capturing logs for each broker and set an appropriate Log4j retention policy so as not to fill the disks. The request logger is particularly voluminous so you may only want to use it for debugging or within small retention windows."}),"\n",(0,s.jsx)(o.li,{children:"Since logs are per broker, you will need to consolidate all of the broker logs from the cluster to get a complete picture of your system."}),"\n",(0,s.jsx)(o.li,{children:'Kafka doesn\'t provide log analysis or visualization so we recommend that you use something like the "ELK" stack (Elasticsearch, Logstash, and Kibana) for these purposes. You might also direct your log output to a Kafka topic on another cluster and then perform a streaming analysis of your audit events!'}),"\n"]})]})}function u(e={}){const{wrapper:o}={...(0,n.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,o,t)=>{t.d(o,{R:()=>i,x:()=>a});var r=t(296540);const s={},n=r.createContext(s);function i(e){const o=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(n.Provider,{value:o},e.children)}}}]);