"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[33323],{133094:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"cloud/aws/compute/aws-lambda","title":"AWS Lambda","description":"https://docs.aws.amazon.com/lambda/latest/dg/lambda-edge.html","source":"@site/docs/cloud/aws/compute/aws-lambda.md","sourceDirName":"cloud/aws/compute","slug":"/cloud/aws/compute/aws-lambda","permalink":"/cloud/aws/compute/aws-lambda","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/cloud/aws/compute/aws-lambda.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1746279616000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Amazon EKS","permalink":"/cloud/aws/compute/amazon-eks"},"next":{"title":"Burstable Instances","permalink":"/cloud/aws/compute/burstable-instances"}}');var s=t(474848),o=t(28453);const i={},r="AWS Lambda",c={},d=[{value:"Slack notifications",id:"slack-notifications",level:2},{value:"Features",id:"features",level:2},{value:"Cost",id:"cost",level:2},{value:"Working",id:"working",level:2},{value:"What makes AWS Lambda so fast?",id:"what-makes-aws-lambda-so-fast",level:3},{value:"1 -  Function Invocation",id:"1----function-invocation",level:3},{value:"2 - Assignment Service",id:"2---assignment-service",level:3},{value:"3 - Firecracker MicroVM",id:"3---firecracker-microvm",level:3},{value:"4 - Component Storage",id:"4---component-storage",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"aws-lambda",children:"AWS Lambda"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/lambda-edge.html",children:"https://docs.aws.amazon.com/lambda/latest/dg/lambda-edge.html"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://aws.amazon.com/blogs/aws/introducing-cloudfront-functions-run-your-code-at-the-edge-with-low-latency-at-any-scale",children:"https://aws.amazon.com/blogs/aws/introducing-cloudfront-functions-run-your-code-at-the-edge-with-low-latency-at-any-scale"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.toptal.com/aws/service-oriented-architecture-aws-lambda",children:"https://www.toptal.com/aws/service-oriented-architecture-aws-lambda"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/applications-console.html",children:"Managing applications in the AWS Lambda console - AWS Lambda"})}),"\n",(0,s.jsx)(n.p,{children:"Run Your Code in Response to Events"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Stock Check Lambda function\n\n# This function is triggered when values are inserted into the Inventory DynamoDB table.\n# Inventory counts are checked, and if an item is out of stock, a notification is sent to an SNS topic.\n\n# This handler is executed every time the Lambda function is triggered\ndef lambda_handler(event, context):\n\n    # Show the incoming event in the debug log\n    print(\"Event received by Lambda function: \" + json.dumps(event, indent=2))\n\n    # For each inventory item added, check if the count is zero\n    for record in event['Records']:\n    newImage = record['dynamodb'].get('NewImage', None)\n    if newImage:\n\n        count = int(record['dynamodb']['NewImage']['Count']['N'])\n\n        if count == 0:\n        store = record['dynamodb']['NewImage']['Store']['S']\n        item  = record['dynamodb']['NewImage']['Item']['S']\n\n        # Construct message to be sent\n        message = store + ' is out of stock of ' + item\n        print(message)\n\n        # Connect to SNS\n        sns = boto3.client('sns')\n        alertTopic = 'NoStock'\n        snsTopicArn = [t['TopicArn'] for t in sns.list_topics()['Topics']\n                        if t['TopicArn'].lower().endswith(':' + alertTopic.lower())][0]\n\n        # Send message to SNS\n        sns.publish(\n            TopicArn=snsTopicArn,\n            Message=message,\n            Subject='Inventory Alert!',\n            MessageStructure='raw'\n        )\n\n    # Finished!\n    return 'Successfully processed {} records.'.format(len(event['Records']))\n"})}),"\n",(0,s.jsx)(n.h2,{id:"slack-notifications",children:"Slack notifications"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import logging\nimport json\nfrom urllib.parse import urlencode\nfrom urllib.request import Request, urlopen\n\ndef lambda_handler(event, context):\n    webhook_url = "https://hooks.slack.com/services/xxx/org_id/api_key"\n    print(event)\n    message = json.loads(event["Records"][0]["Sns"]["Message"])\n    name = message["AlarmName"]\n    reason = message["NewStateReason"]\n    state = message["NewStateValue"]\n    if state == "ALARM":\n        color = "danger"\n    else:\n        color = "good"\n    slack_data = {\n        "channel": "monitoring",\n        "color": color,\n        "fields": [\n            {\n            "title": "Alarm: %s"  % (name),\n            "value": "%s \\n https://ap-south-1.console.aws.amazon.com/cloudwatch/home?region=ap-south-1#alarmsV2:alarm/%s?" % (reason, name),\n            }\n        ]\n    }\n    request = Request(\n        webhook_url,\n        data=json.dumps(slack_data).encode(),\n        headers={"Content-Type": "application/json"},\n    )\n    response = urlopen(request)\n    return {"statusCode": response.getcode(), "body": response.read().decode()}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=iwX9dYrcL1k&ab_channel=HusseinNasser",children:"AWS Serverless Lambda Supports Response Streaming - YouTube"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=Mbt78pAfuOs&ab_channel=GOTOConferences",children:"Unlocking Faster & Efficient Data Processing w/ Serverless \u2022 Uma Ramadoss & Adam Wagner \u2022 GOTO 2023 - YouTube"})}),"\n",(0,s.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The maximum timeout for an AWS Lambda function is\xa0900 seconds (15 minutes).\xa0You can configure this value in increments of 1 second, with a default of 3 seconds.\xa0This is a hard limit set by AWS and cannot be exceeded"}),"\n",(0,s.jsxs)(n.li,{children:["AWS Lambda functions can be configured with memory ranging from 128 MB to 10,240 MB (10 GB). The default memory setting is 128 MB, but you can increase it in 1-MB increments up to the maximum. Lambda allocates CPU power proportionally to the amount of memory configured, so a 256 MB function will have twice the processing power of a 128 MB function.","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsxs)(n.a,{href:"https://repost.aws/questions/QUvGzdNjQZQ9S3YDwvWVWpFw/lambda-function-memory-increase",children:["Lambda function memory increase. | AWS re",":Post"]})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/configuration-memory.html",children:"Configure Lambda function memory - AWS Lambda"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html",children:"Lambda quotas - AWS Lambda"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"cost",children:"Cost"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metric"}),(0,s.jsx)(n.th,{children:"EC2 Spot Instance (including EBS)"}),(0,s.jsx)(n.th,{children:"Lambda (7 requests/hr)"}),(0,s.jsx)(n.th,{children:"Lambda (8 requests/hr)"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Monthly Cost (USD)"}),(0,s.jsx)(n.td,{children:"$41.50892"}),(0,s.jsx)(n.td,{children:"$38.33"}),(0,s.jsx)(n.td,{children:"$43.80"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cost Breakdown"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"EC2 Spot Instance"}),(0,s.jsx)(n.td,{children:"$0.87892"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"EBS Storage"}),(0,s.jsx)(n.td,{children:"$40.63"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Lambda Compute"}),(0,s.jsx)(n.td,{}),(0,s.jsx)(n.td,{children:"$38.33"}),(0,s.jsx)(n.td,{children:"$38.33"})]})]})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Lambda can be cheaper than EC2 Spot Instance (including EBS) when the Lambda workload is lower (7 requests per hour)."}),"\n",(0,s.jsx)(n.li,{children:"Lambda becomes more expensive than EC2 Spot Instance (including EBS) when the Lambda workload increases (8 requests per hour)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://calculator.aws/#/estimate?id=aaae8951c6dbd405046d9682f381355fe1d1fe10",children:"Lambda vs EC2 cost - AWS Pricing Calculator"})}),"\n",(0,s.jsx)(n.h2,{id:"working",children:"Working"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"What makes aws lambda fast",src:t(385412).A+"",width:"999",height:"1267"})}),"\n",(0,s.jsx)(n.h3,{id:"what-makes-aws-lambda-so-fast",children:"What makes AWS Lambda so fast?"}),"\n",(0,s.jsx)(n.p,{children:"There are 4 main pillars:"}),"\n",(0,s.jsx)(n.h3,{id:"1----function-invocation",children:"1 -  Function Invocation"}),"\n",(0,s.jsx)(n.p,{children:"AWS Lambda supports synchronous and asynchronous invocation."}),"\n",(0,s.jsx)(n.p,{children:"In synchronous invocation, the caller directly calls the Lambda function using AWS CLI, SDK, or other services."}),"\n",(0,s.jsx)(n.p,{children:"In asynchronous invocation, the caller doesn\u2019t wait for the function\u2019s response. The request is authorized and an event is placed in an internal SQS queue. Pollers read messages from the queue and send them for processing."}),"\n",(0,s.jsx)(n.h3,{id:"2---assignment-service",children:"2 - Assignment Service"}),"\n",(0,s.jsx)(n.p,{children:"The Assignment Service manages the execution environments."}),"\n",(0,s.jsx)(n.p,{children:"The service is written in Rust for high performance and is divided into multiple partitions with a leader-follower approach for high availability."}),"\n",(0,s.jsx)(n.p,{children:"The state of execution environments is written to an external journal log."}),"\n",(0,s.jsx)(n.h3,{id:"3---firecracker-microvm",children:"3 - Firecracker MicroVM"}),"\n",(0,s.jsx)(n.p,{children:"Firecracker is a lightweight virtual machine manager designed for running serverless workloads such as AWS Lambda and AWS Fargate."}),"\n",(0,s.jsx)(n.p,{children:"It uses Linux\u2019s Kernel-based virtual machine to create and manage secure, fast-booting microVMs."}),"\n",(0,s.jsx)(n.h3,{id:"4---component-storage",children:"4 - Component Storage"}),"\n",(0,s.jsx)(n.p,{children:"AWS Lambda also has to manage the state consisting of input data and function code."}),"\n",(0,s.jsx)(n.p,{children:"To make it efficient, it uses multiple techniques:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Chunking to store the container images more efficiently."}),"\n",(0,s.jsx)(n.li,{children:"Using convergent encryption to secure the shared data. This involves appending additional data to the chunk to compute a more robust hash."}),"\n",(0,s.jsx)(n.li,{children:"SnapStart feature to reduce cold start latency by pre-initializing the execution environment"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},385412:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/Pasted image 20240924013035-aabf7f87364ea4a3847ae9136d7aecdf.jpg"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var a=t(296540);const s={},o=a.createContext(s);function i(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);