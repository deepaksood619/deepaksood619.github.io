"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[83119],{920169:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>a,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var r=t(785893),n=t(511151);const s={},i="Protocol Buffers Protobuf",l={id:"networking/others/protocol-buffers-protobuf",title:"Protocol Buffers Protobuf",description:"Protocol Buffers are a way of encoding structured data in an efficient yet extensible format. Google uses Protocol Buffers for almost all of its internal RPC protocols and file formats.",source:"@site/docs/networking/others/protocol-buffers-protobuf.md",sourceDirName:"networking/others",slug:"/networking/others/protocol-buffers-protobuf",permalink:"/networking/others/protocol-buffers-protobuf",draft:!1,unlisted:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/networking/others/protocol-buffers-protobuf.md",tags:[],version:"current",lastUpdatedAt:1707138374,formattedLastUpdatedAt:"Feb 5, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Others",permalink:"/networking/others/other"},next:{title:"RPC",permalink:"/networking/others/rpc"}},a={},c=[{value:"Advantages over XML",id:"advantages-over-xml",level:2},{value:"protoc (protobuf compiler)",id:"protoc-protobuf-compiler",level:2},{value:"generate pb files from proto files",id:"generate-pb-files-from-proto-files",level:2},{value:"Plugins for protoc",id:"plugins-for-protoc",level:2},{value:"How to define a protocol message",id:"how-to-define-a-protocol-message",level:2},{value:"Others",id:"others",level:2},{value:"Python apis",id:"python-apis",level:2},{value:"Specification",id:"specification",level:2},{value:"Links",id:"links",level:2}];function d(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.h1,{id:"protocol-buffers-protobuf",children:"Protocol Buffers Protobuf"}),"\n",(0,r.jsx)(o.p,{children:"Protocol Buffers are a way of encoding structured data in an efficient yet extensible format. Google uses Protocol Buffers for almost all of its internal RPC protocols and file formats."}),"\n",(0,r.jsxs)(o.p,{children:["Protocol Buffers (a.k.a., protobuf) are Google's language-neutral, platform-neutral, extensible mechanism for ",(0,r.jsx)(o.strong,{children:"serializing structured data."})]}),"\n",(0,r.jsxs)(o.p,{children:["Protocol Buffers is a method of ",(0,r.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Serialization",children:"serializing"})," structured data. It is useful in developing programs to communicate with each other over a wire or for storing data. The method involves an ",(0,r.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Interface_description_language",children:"interface description language"})," that describes the structure of some data and a program that generates source code from that description for generating or parsing a stream of bytes that represents the structured data"]}),"\n",(0,r.jsx)(o.p,{children:"Though the primary purpose of Protocol Buffers is to facilitate network communication, its simplicity and speed make Protocol Buffers an alternative to data-centric C++ classes and structs, especially where interoperability with other languages or systems might be needed in the future.- IDL (Interface Definition Language)"}),"\n",(0,r.jsx)(o.p,{children:"Describe only and generate interfaces for any language"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Data Model - Structure of the request and response"}),"\n",(0,r.jsx)(o.li,{children:"Wire Format - Binary format for network transmission"}),"\n"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-go",children:"message HelloRequest {\n string greeting = 1;\n}\n\nmessage HelloResponse {\n string reply = 1;\n}\n\nservice HelloService {\n rpc SayHello(HelloRequest) returns (HelloResponse);\n}\n"})}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://github.com/google/protobuf",children:"https://github.com/google/protobuf"})}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://developers.google.com/protocol-buffers",children:"https://developers.google.com/protocol-buffers"})}),"\n",(0,r.jsx)(o.h2,{id:"advantages-over-xml",children:"Advantages over XML"}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsx)(o.li,{children:"are simpler"}),"\n",(0,r.jsx)(o.li,{children:"are 3 to 10 times smaller"}),"\n",(0,r.jsx)(o.li,{children:"are 20 to 100 times faster"}),"\n",(0,r.jsx)(o.li,{children:"are less ambiguous"}),"\n",(0,r.jsx)(o.li,{children:"generate data access classes that are easier to use programmatically"}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"protoc-protobuf-compiler",children:"protoc (protobuf compiler)"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Generates data structure that correspond to IDL data model"}),"\n",(0,r.jsx)(o.li,{children:"Request and response types"}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.code,{children:"docker run --rm -v $(pwd):$(pwd) -w $(pwd) znly/protoc --plugin=protoc-gen-grpc=/usr/bin/grpc_python_plugin --python_out=./messages/ --grpc_out=./messages/ --proto_path=./protobuf ./protobuf/*.proto"})}),"\n",(0,r.jsx)(o.h2,{id:"generate-pb-files-from-proto-files",children:"generate pb files from proto files"}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.code,{children:"python -m grpc_tools.protoc -I=pcbook/proto --python_out=pcbook/pb --grpc_python_out=pcbook/pb pcbook/proto/*.proto protoc --proto_path=.*.proto --python_out=."})}),"\n",(0,r.jsx)(o.h2,{id:"plugins-for-protoc",children:"Plugins for protoc"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Generate interfaces and client stubs"}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"how-to-define-a-protocol-message",children:"How to define a protocol message"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Name of the message: UpperCamelCase"}),"\n",(0,r.jsx)(o.li,{children:"Name of the field: lower_snake_case"}),"\n",(0,r.jsxs)(o.li,{children:["Some scalar-value data types:","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"string, bool, bytes"}),"\n",(0,r.jsx)(o.li,{children:"float, double"}),"\n",(0,r.jsx)(o.li,{children:"int32, int64, uint32, uint64, sint32, sint64, etc."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.li,{children:"Data types can be user-defined enums or other messages"}),"\n",(0,r.jsxs)(o.li,{children:["Tags are more important than field names","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:["Is an arbitrary integer","\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"From 1 to 536,870,911 (or 2^29-1)"}),"\n",(0,r.jsx)(o.li,{children:"Except from 19000 to 19999 (reserved)"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.li,{children:"From 1 to 15 take 1 byte"}),"\n",(0,r.jsx)(o.li,{children:"From 16 to 2047 take 2 bytes"}),"\n",(0,r.jsx)(o.li,{children:"Don't need to be in-order or sequential"}),"\n",(0,r.jsx)(o.li,{children:"Must be unique for same-level fields"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"others",children:"Others"}),"\n",(0,r.jsx)(o.p,{children:"A Protobuf message definition consists of fields defined by a name, a type, and an integer field number. The field number in particular is sacred, as this is what is actually transmitted in a serialised message (as opposed to the field name). All producers and consumers rely on this integer having a consistent meaning, and altering it can cause havoc if a consumer processes old data with a new understanding of what data belongs to a field number."}),"\n",(0,r.jsx)(o.p,{children:"The tests we've implemented cover the following aspects:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Field numbers must not be amended."}),"\n",(0,r.jsx)(o.li,{children:"Fields must not have their type amended."}),"\n",(0,r.jsx)(o.li,{children:"Fields that have been removed from a message must have an entry added to a reserved statement within the message, both for the deleted field and the deleted field number. This ensures that the protoc compiler will complain if someone attempts to add either of these back in to a subsequent version."}),"\n",(0,r.jsx)(o.li,{children:"Fields must not have their name amended (this would not break Protobuf compatibility, but we have the test in place to help maintain the evolvable schemas for JSON derived from Protobuf models)."}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"python-apis",children:"Python apis"}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://developers.google.com/protocol-buffers/docs/reference/python-generated",children:"https://developers.google.com/protocol-buffers/docs/reference/python-generated"})}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://developers.google.com/protocol-buffers/docs/pythontutorial",children:"https://developers.google.com/protocol-buffers/docs/pythontutorial"})}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://developers.google.com/protocol-buffers/docs/proto3",children:"https://developers.google.com/protocol-buffers/docs/proto3"})}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.strong,{children:"SerializeToString():"})," serializes the message and returns it as a string. Note that the bytes are binary, not text; we only use the str type as a convenient container"]}),"\n",(0,r.jsxs)(o.li,{children:[(0,r.jsx)(o.strong,{children:"ParseFromString(data):"})," parses a message from the given string"]}),"\n"]}),"\n",(0,r.jsx)(o.h2,{id:"specification",children:"Specification"}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.code,{children:"protobuf.common.messageData"})}),"\n",(0,r.jsx)(o.h2,{id:"links",children:"Links"}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.a,{href:"https://newsletter.devmoh.co/p/protobufs-explained-and-why-google",children:"Protobufs Explained, and why Google, Apple, and LinkedIn use it over JSON"})})]})}function p(e={}){const{wrapper:o}={...(0,n.a)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},511151:(e,o,t)=>{t.d(o,{Z:()=>l,a:()=>i});var r=t(667294);const n={},s=r.createContext(n);function i(e){const o=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:i(e.components),r.createElement(s.Provider,{value:o},e.children)}}}]);