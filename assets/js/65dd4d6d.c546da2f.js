"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[81186],{991783:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>t,default:()=>c,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"devops/ansible/commands","title":"Commands","description":"Final Commands","source":"@site/docs/devops/ansible/commands.md","sourceDirName":"devops/ansible","slug":"/devops/ansible/commands","permalink":"/devops/ansible/commands","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/devops/ansible/commands.md","tags":[],"version":"current","lastUpdatedBy":"Deepak Sood","lastUpdatedAt":1728328563000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Ansible","permalink":"/devops/ansible/"},"next":{"title":"DevOps","permalink":"/devops/devops-intro/"}}');var l=s(474848),i=s(28453);const a={},t="Commands",r={},d=[{value:"Final Commands",id:"final-commands",level:2},{value:"Add hosts to files",id:"add-hosts-to-files",level:3},{value:"Create a playbook (yml file)",id:"create-a-playbook-yml-file",level:3},{value:"Create Inventory File",id:"create-inventory-file",level:2},{value:"Commands",id:"commands-1",level:2},{value:"run commands directly",id:"run-commands-directly",level:3},{value:"run ansible playbooks",id:"run-ansible-playbooks",level:3},{value:"retry offline devices",id:"retry-offline-devices",level:3},{value:"Major Commands",id:"major-commands",level:3},{value:"Command",id:"command",level:2},{value:"Example yml files",id:"example-yml-files",level:2}];function m(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"commands",children:"Commands"})}),"\n",(0,l.jsx)(n.h2,{id:"final-commands",children:"Final Commands"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Change value of reporting location"}),"\n",(0,l.jsx)(n.li,{children:"Create inventory file"}),"\n",(0,l.jsx)(n.li,{children:'ansible-playbook pull_add_restart.yml -i inventory/iiitd -e "host=IIITD" --check'}),"\n",(0,l.jsx)(n.li,{children:'ansible-playbook pull_add_restart.yml -i inventory/iiitd -e "host=IIITD" --limit @pull_add_restart.retry'}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"add-hosts-to-files",children:"Add hosts to files"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"- sudo cat /etc/openvpn/openvpn-status.log| grep IIITD\n- sudo vim /etc/ansible/hosts\n- IIITD-01 controller=IIITD-01 ansible_host=10.8.42.156 ansible_port=1234 ansible_ssh_pass='xitanez123!@#' ansible_ssh_user=pi\n- '{0} controller={0} ansible_host={1} ansible_port=1234 ansible_ssh_pass='password' ansible_ssh_user=pi'.format(client.name, client.address)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"create-a-playbook-yml-file",children:"Create a playbook (yml file)"}),"\n",(0,l.jsx)(n.h2,{id:"create-inventory-file",children:"Create Inventory File"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Location - /home/ubuntu/ansible_playbooks/find_client_ips"}),"\n",(0,l.jsx)(n.li,{children:"Command - python find_vpn_static_ip.py -c IIITD"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"commands-1",children:"Commands"}),"\n",(0,l.jsx)(n.h3,{id:"run-commands-directly",children:"run commands directly"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'#run any command and get results to multiple controllers, deploy to all controllers inside the IIITD group\nansible iiitd -m shell -a "pip freeze | grep kafka"\n\n#restart command to only IIITD-06\nansible IIITD-06 -m shell -a "sudo /home/pi/log_files/twistd_reset.sh -r"\n\nansible iiitd -m shell -a "uname -a"\nansible kafka -m shell -a "uname -a"\n\n#exclude a host from ansible play\nansible kafka --limit \'all:!IIITD-01\' -m shell -a "uname -a"\n\nansible Trent -i inventory/Trent -m shell -a "sudo cat /home/pi/conf/electric_meter.conf | grep ReportDeliveryLocation"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"run-ansible-playbooks",children:"run ansible playbooks"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ansible-playbook add_ini.yml\n\nansible-playbook install.yml\n\nansible-playbook add_ini.yml --check #run playbook in dry-run mode. See what Ansible might do, but without actually changing anything\n\nansible-playbook add_and_restart.yml --check --limit "Dominos-11,Dominos-12,Dominos-13,Dominos-14,Dominos-15,Dominos-16,Dominos-17,Dominos-18,Dominos-19,Dominos-20" #limit the number of hosts to run on in a group of hosts\n\nansible-playbook add_and_restart.yml --check -e "host=dominos" --limit "Dominos-01,Dominos-02,Dominos-03,Dominos-04,Dominos-05,Dominos-06,Dominos-07,Dominos-08,Dominos-09,Dominos-10" #limit the number of hosts to run on in a group of hosts\n\n# using envionment variable\n\nansible-playbook pull.yml --check -e "host=iiitd"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"retry-offline-devices",children:"retry offline devices"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ansible-playbook <ansible_playbook>.yml --limit @<ansible_playbook>.retry\n"})}),"\n",(0,l.jsx)(n.h3,{id:"major-commands",children:"Major Commands"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ansible-playbook timesync_dns.yml -i inventory/motherdairy --extra-vars "variable_host=MotherDairy_2" >> logs/motherdairy_timesync_dns.log &\n\nansible-playbook timesync_dns.yml -i inventory/dominos --extra-vars "variable_host=Dominos" --limit @timesync_dns.retry >> logs/dominos_timesync_dns.retry.log &\n'})}),"\n",(0,l.jsx)(n.h2,{id:"command",children:"Command"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"/home/ubuntu/ssh - all clients to ssh\n\n/home/ubuntu/ansible_playbooks - all the playbooks for ansible\n\n/etc/ansible/hosts - stores all hosts for ansible\n\n./home/ubuntu/ssh/example-01 - ssh to example-01\n"})}),"\n",(0,l.jsx)(n.h2,{id:"example-yml-files",children:"Example yml files"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yml",children:"install.yml\n    -\n        hosts: {{ host }}\n        gather_facts: no\n        vars:\n            ansible_ssh_user: pi\n            ansible_port: 1234\n            ansible_ssh_pass: 'xitanez123!@#'\n        tasks:\n            -\n                name: 'install kafka-python'\n                become: yes\n                pip: {name: kafka-python}\n\nadd_ini.yml\n    -\n        hosts: iiitd\n        tasks:\n            -\n                name: 'install reporting location'\n                become: yes\n                ini_file:\n                    path: /home/pi/conf/electric_meter.conf\n                    section: report 1\n                    option: ReportDeliveryLocation\n                    value: kafka://kafka.abc.com:9092/iot_data\n                    backup: yes\n\niiitd_pull_playbook.yml\n    -\n        hosts: iiitd\n        tasks:\n            -\n            name: 'pull'\n"})})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(m,{...e})}):m(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var o=s(296540);const l={},i=o.createContext(l);function a(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);