"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[50219],{772637:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"technologies/kafka/security/05-authorization","title":"Authorization","description":"Authorization determines what an entity can do on a system once it has been authenticated. Consider an ATM, once you successfully authenticate with your card and PIN, you are able to access your accounts only, not all of the accounts on the machine.","source":"@site/docs/technologies/kafka/security/05-authorization.md","sourceDirName":"technologies/kafka/security","slug":"/technologies/kafka/security/05-authorization","permalink":"/technologies/kafka/security/05-authorization","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/technologies/kafka/security/05-authorization.md","tags":[],"version":"current","lastUpdatedBy":"Deepak Sood","lastUpdatedAt":1769433622000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Kafka Authentication with SSL and SASL_SSL","permalink":"/technologies/kafka/security/04-kafka-authentication-with-ssl-and-sasl_ssl"},"next":{"title":"Encryption","permalink":"/technologies/kafka/security/06-encryption"}}');var a=s(474848),n=s(28453);const i={},r="Authorization",c={},l=[{value:"ACLs",id:"acls",level:2},{value:"Creating ACLs",id:"creating-acls",level:2},{value:"How Kafka Applies ACLs",id:"how-kafka-applies-acls",level:2},{value:"Customizing Access Control",id:"customizing-access-control",level:2},{value:"Considerations",id:"considerations",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,n.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"authorization",children:"Authorization"})}),"\n",(0,a.jsx)(t.p,{children:"Authorization determines what an entity can do on a system once it has been authenticated. Consider an ATM, once you successfully authenticate with your card and PIN, you are able to access your accounts only, not all of the accounts on the machine."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://images.ctfassets.net/gt6dp23g0g38/1g7emdqxI6hMKDJLqbo5F6/780a85af5989e6276be4f2b837e7370e/authentication.jpg",alt:"authentication"})}),"\n",(0,a.jsx)(t.p,{children:"Kafka is similar: once a broker has authenticated a client's identity, it determines the actions that the client is able to execute\u2014whether creating a topic or producing or consuming a message."}),"\n",(0,a.jsx)(t.h2,{id:"acls",children:"ACLs"}),"\n",(0,a.jsx)(t.p,{children:"Kafka uses access control lists (ACLs) to specify which users are allowed to perform which operations on specific resources or groups of resources. Recall that each connection is assigned a principal when it is first opened, this is what gets assigned the identity."}),"\n",(0,a.jsx)(t.p,{children:"Each ACL contains a principal, a permission type, an operation, a resource type (e.g., cluster, topic, or group), and name:"}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://images.ctfassets.net/gt6dp23g0g38/1cEAGCmeJbmasUjhfmIX6S/8738b56b89bdaf97ccbe5b0fbc95c9e1/acl.jpg",alt:"acl"})}),"\n",(0,a.jsxs)(t.p,{children:["By default, resource names are treated as literals but you can also specify that they are treated as prefixes (to specify a subset of resources), or you can use a wildcard character ",(0,a.jsx)(t.code,{children:"(*)"})," to match all resources of a specific type (which works for principals too). Finally, you can specify a host value to limit permissions to a specific IP address."]}),"\n",(0,a.jsx)(t.h2,{id:"creating-acls",children:"Creating ACLs"}),"\n",(0,a.jsxs)(t.p,{children:["Use the\xa0",(0,a.jsx)(t.code,{children:"kafka-acls"}),"\xa0command-line tool to create ACLs. For example, perhaps you'd like to allow users named Alice and Fred to read and write from the\xa0",(0,a.jsx)(t.code,{children:"finance"}),"\xa0topic:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-bash",children:"kafka-acls --bootstrap-server localhost:9092 \\\n  --command-config adminclient-configs.conf  \\\n  --add \\\n  --allow-principal User:alice \\\n  --allow-principal User:fred \\\n  --operation read\n  --operation write \\\n  --topic finance\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In a real use case, however, your principal names here are likely to be more complex. If you use SSL authentication for clients, for example, the principal name will use the SSL certificate's subject name. If you use SASL_SSL with Kerberos, the Kerberos principal format will be adopted. You can also configure the way that the principal is derived from the identity by configuring\xa0",(0,a.jsx)(t.code,{children:"ssl.principal.mapping.rules"}),"\xa0for SSL and\xa0",(0,a.jsx)(t.code,{children:"sasl.kerberos.principal.to.local.rules"})," for Kerberos. Refer to\xa0",(0,a.jsx)(t.a,{href:"https://kafka.apache.org/documentation/#security_authz_ssl",children:"the documentation"}),"\xa0for more details."]}),"\n",(0,a.jsx)(t.h2,{id:"how-kafka-applies-acls",children:"How Kafka Applies ACLs"}),"\n",(0,a.jsxs)(t.p,{children:["ACLs created with\xa0",(0,a.jsx)(t.code,{children:"kafka-acls"}),"\xa0are stored in ZooKeeper, then cached in memory by every broker to enable fast lookups when authorizing requests."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://images.ctfassets.net/gt6dp23g0g38/53VCjkEhkBwlVll6eQ6rBA/05e9121fe67f4b75d34762914a889efb/kafka-applies-acls.jpg",alt:"kafka-applies-acls"})}),"\n",(0,a.jsxs)(t.p,{children:["Kafka uses a server plugin known as an\xa0",(0,a.jsx)(t.em,{children:"authorizer"}),"\xa0to apply ACLs to requests, and this can take multiple forms, even custom ones. An authorizer allows a requested action if there is at least one \u201cAllow ACL\u201d that matches the action, as long as there are no \u201cDeny ACL\u201d forbidding it (\u201cDeny\u201d always trumps \u201cAllow\u201d)."]}),"\n",(0,a.jsxs)(t.p,{children:["The default authorizer (for ZooKeeper Kafka) is\xa0",(0,a.jsx)(t.em,{children:"AclAuthorizer"}),", which you specify in each broker's configuration: ",(0,a.jsx)(t.code,{children:"authorizer.class.name=kafka.security.authorizer.AclAuthorizer"}),". However, if you are using Kafka's native consensus implementation based on KRaft then you'll use a new built-in\xa0",(0,a.jsx)(t.code,{children:"StandardAuthorizer"}),"\xa0that doesn't depend on ZooKeeper.\xa0",(0,a.jsx)(t.code,{children:"StandardAuthorizer"}),"\xa0accomplishes all of the same things that\xa0",(0,a.jsx)(t.code,{children:"AclAuthorizer"}),"\xa0does for ZooKeeper-dependent clusters, and it stores its ACLs in the\xa0",(0,a.jsx)(t.code,{children:"__cluster_metadata"}),"\xa0metadata topic."]}),"\n",(0,a.jsx)(t.h2,{id:"customizing-access-control",children:"Customizing Access Control"}),"\n",(0,a.jsx)(t.p,{children:"If you work in a large organization or have a large cluster topology, you might find it inefficient to specify ACLs for each individual user principal. Instead, you might wish to assign users to groups or differentiate them based on roles. You can accomplish this with Kafka, but you will need to do several things: you'll need an external system that allows you to associate individuals with roles and/or groups, something like an LDAP store; you'll need to apply ACLs to resources based not only on users but also on roles and groups; finally, you'll need to implement a custom authorizer that can call your external system to find the roles and groups for a given principal."}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.img,{src:"https://images.ctfassets.net/gt6dp23g0g38/70cSGdbqVm3uZATKbJnlVj/d7c3ccd557b97253ecc0e38a911de268/ldap-server.jpg",alt:"ldap-server"})}),"\n",(0,a.jsx)(t.h2,{id:"considerations",children:"Considerations"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsx)(t.p,{children:"No matter which type of authorizer you use, whether default or custom, you should clearly distinguish between user and service accounts. You might be inclined to reuse a person\u2019s user details to authenticate a service or application to Kafka but you shouldn't do this as people often change teams or roles (or even leave companies altogether)."}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["Keep in mind that ACLs require careful management. If you are working in a development or test environment, it may be tempting to use anonymous principles, or Kafka's notion of the superuser, or its\xa0",(0,a.jsx)(t.code,{children:"allow.everyone.if.no.acl.found"}),"\xa0setting. But it\u2019s easy to accidentally promote these settings to a production environment so it\u2019s far better to develop good habits; from the outset, you should automatically assign proper credentials and set ACLs strictly according to need."]}),"\n"]}),"\n",(0,a.jsxs)(t.li,{children:["\n",(0,a.jsxs)(t.p,{children:["If a user is compromised, you will need to remove that user from the system as soon as possible, but you will also need to check for any existing connections associated with that user since a principal is assigned to a resource upon connection. (You can set how often users need to reconnect with\xa0",(0,a.jsx)(t.code,{children:"connections.max.reauth.ms"}),"\xa0but you should be careful not to frustrate your users with too frequent reconnections.) Note that if a connection persists for a long time, removing a user will only take effect when the connection is closed and reconnection is attempted. Thus the best solution for blocking access to a compromised user is to implement a \u201cDeny ACL\u201d to prevent actions on any existing connections since ACLs get propagated quickly and are checked with every request."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>r});var o=s(296540);const a={},n=o.createContext(a);function i(e){const t=o.useContext(n);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(n.Provider,{value:t},e.children)}}}]);