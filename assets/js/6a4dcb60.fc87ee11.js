"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[50941],{192146:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"computer-science/system-design/case-study/04-demo","title":"Demo","description":"Component 1: Traffic Generator (POS Simulator)","source":"@site/docs/computer-science/system-design/case-study/04-demo.md","sourceDirName":"computer-science/system-design/case-study","slug":"/computer-science/system-design/case-study/04-demo","permalink":"/computer-science/system-design/case-study/04-demo","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/computer-science/system-design/case-study/04-demo.md","tags":[],"version":"current","lastUpdatedBy":"Deepak Sood","lastUpdatedAt":1769708615000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Security and DR","permalink":"/computer-science/system-design/case-study/03-security-and-dr"},"next":{"title":"Conclusion","permalink":"/computer-science/system-design/case-study/05-conclusion"}}');var o=t(474848),i=t(28453);const r={},c="Demo",l={},a=[{value:"Component 1: Traffic Generator (POS Simulator)",id:"component-1-traffic-generator-pos-simulator",level:2},{value:"Component 2: Mock Credit Bureau (The External API)",id:"component-2-mock-credit-bureau-the-external-api",level:2},{value:"Component 3: The Flink Logic (SQL)",id:"component-3-the-flink-logic-sql",level:2},{value:"Demo Walkthrough Script",id:"demo-walkthrough-script",level:2}];function d(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"demo",children:"Demo"})}),"\n",(0,o.jsx)(n.h2,{id:"component-1-traffic-generator-pos-simulator",children:"Component 1: Traffic Generator (POS Simulator)"}),"\n",(0,o.jsxs)(n.p,{children:["We will use the ",(0,o.jsx)(n.strong,{children:"Datagen Source Connector"})," available in Confluent Cloud."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Purpose:"})," Simulate a stream of loan applications."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Configuration:"})," We define a custom Avro schema for the ",(0,o.jsx)(n.code,{children:"loan_applications"})," topic.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"applicant_type"}),": Randomly distributed between ",(0,o.jsx)(n.code,{children:"KNOWN"})," and ",(0,o.jsx)(n.code,{children:"UNKNOWN"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"amount"}),": Random values between $100 and $5000."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"ssn"}),": Random strings (mocking PII)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Scale:"})," We will configure Datagen to produce 10 events/second to demonstrate the system handling a continuous stream."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"component-2-mock-credit-bureau-the-external-api",children:"Component 2: Mock Credit Bureau (The External API)"}),"\n",(0,o.jsx)(n.p,{children:"We need a REST endpoint that Flink can call."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Tool:"})," A simple Python (FastAPI) or Node.js container running on a cloud function or local tunnel (e.g., ngrok)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Behavior:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Endpoint: ",(0,o.jsx)(n.code,{children:"POST /v1/score"})]}),"\n",(0,o.jsxs)(n.li,{children:["Input: ",(0,o.jsx)(n.code,{children:'{"ssn": "..."}'})]}),"\n",(0,o.jsxs)(n.li,{children:["Logic: Sleep for ",(0,o.jsx)(n.code,{children:"random(200, 1000)"})," milliseconds. This artificially introduces latency to prove the Async I/O capability."]}),"\n",(0,o.jsxs)(n.li,{children:["Output: ",(0,o.jsx)(n.code,{children:'{"score": random(300, 850)}'})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Why this matters:"})," This mock allows us to visually demonstrate that Flink is processing multiple records in parallel despite the 1-second delay per request."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"component-3-the-flink-logic-sql",children:"Component 3: The Flink Logic (SQL)"}),"\n",(0,o.jsx)(n.p,{children:"We will execute the following Flink SQL statements in the Confluent Cloud Workspace during the demo."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Step A: Define the Tables"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"-- The Input Stream (From Datagen)\nCREATE TABLE LoanApps (\n  request_id STRING,\n  applicant_type STRING,\n  amount DOUBLE,\n  ssn STRING,\n  ts TIMESTAMP(3),\n  WATERMARK FOR ts AS ts - INTERVAL '5' SECOND\n) WITH (\n  'kafka.topic' = 'loan_applications',\n  'value.format' = 'avro',\n  'scan.startup.mode' = 'latest-offset'\n);\n\n-- The Output Stream\nCREATE TABLE LoanDecisions (\n  request_id STRING,\n  status STRING,\n  reason STRING\n) WITH (\n  'kafka.topic' = 'loan_decisions',\n  'value.format' = 'json'\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Step B: The Decision Logic (Hybrid Join)"})}),"\n",(0,o.jsx)(n.p,{children:"This query demonstrates the conditional logic and the external lookup."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sql",children:"INSERT INTO LoanDecisions\nSELECT\n  L.request_id,\n  CASE\n    -- Logic for Known Customers (Simplified for Demo)\n    WHEN L.applicant_type = 'KNOWN' THEN 'APPROVED'\n    -- Logic for Unknown: Check Credit Score from External API\n    WHEN L.applicant_type = 'UNKNOWN' AND Bureau.score > 700 THEN 'APPROVED'\n    ELSE 'DENIED'\n  END AS status,\n  CASE\n    WHEN L.applicant_type = 'UNKNOWN' THEN 'Based on External Bureau Score: ' |\n\n| CAST(Bureau.score AS STRING)\n    ELSE 'Internal Customer Check'\n  END AS reason\nFROM LoanApps L\n-- The Async Lookup Join\nLEFT JOIN LATERAL TABLE(\n  KEY_SEARCH_AGG(\n    'MockBureauConnection',  -- Defined Connection to our Mock API\n    DESCRIPTOR(ssn),         -- The Key to lookup\n    L.ssn,                   -- The input field\n    MAP['async_enabled', 'true', 'client_timeout', '2000'] -- Async Config\n  )\n) AS Bureau ON L.applicant_type = 'UNKNOWN'; -- Only call for Unknowns\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.em,{children:["Note: The ",(0,o.jsx)(n.code,{children:"ON L.applicant_type = 'UNKNOWN'"})," clause is an optimization to prevent calling the API for known customers."]})}),"\n",(0,o.jsx)(n.h2,{id:"demo-walkthrough-script",children:"Demo Walkthrough Script"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Show the Latency:"})," Open the logs of the Mock Credit Bureau. Show requests taking ~500ms."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Show the Stream:"})," Open Confluent Cloud Console. Show Datagen producing events."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Run the Query:"})," Submit the Flink SQL job."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Prove Performance:"})," Switch to the ",(0,o.jsx)(n.code,{children:"loan_decisions"})," topic view. Show that decisions are arriving rapidly (high throughput) despite the individual latency of the API calls shown in step 1. This definitively proves the Async I/O architecture works."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>c});var s=t(296540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);