"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[5025],{136812:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"databases/sql-databases/postgres/table-partitioning","title":"Table Partitioning","description":"PostgreSQL 15: 5.11. Table Partitioning","source":"@site/docs/databases/sql-databases/postgres/table-partitioning.md","sourceDirName":"databases/sql-databases/postgres","slug":"/databases/sql-databases/postgres/table-partitioning","permalink":"/databases/sql-databases/postgres/table-partitioning","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/databases/sql-databases/postgres/table-partitioning.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1734554726000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Replication","permalink":"/databases/sql-databases/postgres/replication"},"next":{"title":"RDBMS","permalink":"/databases/sql-databases/rdbms"}}');var n=i(474848),s=i(28453);const r={},o="Table Partitioning",l={},d=[{value:"Declarative Partitioning",id:"declarative-partitioning",level:2},{value:"Partition Maintenance",id:"partition-maintenance",level:2},{value:"Partition Pruning",id:"partition-pruning",level:2},{value:"Others",id:"others",level:2},{value:"Links",id:"links",level:2}];function h(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"table-partitioning",children:"Table Partitioning"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/ddl-partitioning.html",children:"PostgreSQL: Documentation: 15: 5.11. Table Partitioning"})}),"\n",(0,n.jsx)(t.h2,{id:"declarative-partitioning",children:"Declarative Partitioning"}),"\n",(0,n.jsxs)(t.p,{children:["PostgreSQL allows you to declare that a table is divided into partitions. The table that is divided is referred to as a ",(0,n.jsx)(t.em,{children:"partitioned table"}),". The declaration includes the ",(0,n.jsx)(t.em,{children:"partitioning method"})," as described above, plus a list of columns or expressions to be used as the ",(0,n.jsx)(t.em,{children:"partition key"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:['The partitioned table itself is a "virtual" table having no storage of its own. Instead, the storage belongs to ',(0,n.jsx)(t.em,{children:"partitions"}),", which are otherwise-ordinary tables associated with the partitioned table. Each partition stores a subset of the data as defined by its ",(0,n.jsx)(t.em,{children:"partition bounds"}),". All rows inserted into a partitioned table will be routed to the appropriate one of the partitions based on the values of the partition key column(s). Updating the partition key of a row will cause it to be moved into a different partition if it no longer satisfies the partition bounds of its original partition."]}),"\n",(0,n.jsxs)(t.p,{children:["Partitions may themselves be defined as partitioned tables, resulting in ",(0,n.jsx)(t.em,{children:"sub-partitioning"}),". Although all partitions must have the same columns as their partitioned parent, partitions may have their own indexes, constraints and default values, distinct from those of other partitions. See ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/sql-createtable.html",title:"CREATE TABLE",children:"CREATE TABLE"})," for more details on creating partitioned tables and partitions."]}),"\n",(0,n.jsxs)(t.p,{children:["It is not possible to turn a regular table into a partitioned table or vice versa. However, it is possible to add an existing regular or partitioned table as a partition of a partitioned table, or remove a partition from a partitioned table turning it into a standalone table; this can simplify and speed up many maintenance processes. See ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/sql-altertable.html",title:"ALTER TABLE",children:"ALTER TABLE"})," to learn more about the ",(0,n.jsx)(t.code,{children:"ATTACH PARTITION"})," and ",(0,n.jsx)(t.code,{children:"DETACH PARTITION"})," sub-commands."]}),"\n",(0,n.jsxs)(t.p,{children:["Partitions can also be ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/ddl-foreign-data.html",title:"5.12. Foreign Data",children:"foreign tables"}),", although considerable care is needed because it is then the user's responsibility that the contents of the foreign table satisfy the partitioning rule. There are some other restrictions as well. See ",(0,n.jsx)(t.a,{href:"https://www.postgresql.org/docs/current/sql-createforeigntable.html",title:"CREATE FOREIGN TABLE",children:"CREATE FOREIGN TABLE"})," for more information."]}),"\n",(0,n.jsx)(t.h2,{id:"partition-maintenance",children:"Partition Maintenance"}),"\n",(0,n.jsx)(t.p,{children:"Normally the set of partitions established when initially defining the table is not intended to remain static. It is common to want to remove partitions holding old data and periodically add new partitions for new data. One of the most important advantages of partitioning is precisely that it allows this otherwise painful task to be executed nearly instantaneously by manipulating the partition structure, rather than physically moving large amounts of data around."}),"\n",(0,n.jsx)(t.p,{children:"The simplest option for removing old data is to drop the partition that is no longer necessary:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.code,{children:"DROP TABLE measurement_y2006m02;"})}),"\n",(0,n.jsxs)(t.p,{children:["This can very quickly delete millions of records because it doesn't have to individually delete every record. Note however that the above command requires taking an ",(0,n.jsx)(t.code,{children:"ACCESS EXCLUSIVE"})," lock on the parent table."]}),"\n",(0,n.jsx)(t.p,{children:"Another option that is often preferable is to remove the partition from the partitioned table but retain access to it as a table in its own right. This has two forms:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE measurement DETACH PARTITION measurement_y2006m02;\nALTER TABLE measurement DETACH PARTITION measurement_y2006m02 CONCURRENTLY;\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.code,{children:"ATTACH PARTITION"})," command requires taking a ",(0,n.jsx)(t.code,{children:"SHARE UPDATE EXCLUSIVE"})," lock on the partitioned table."]}),"\n",(0,n.jsx)(t.h2,{id:"partition-pruning",children:"Partition Pruning"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.em,{children:"Partition pruning"})," is a query optimization technique that improves performance for declaratively partitioned tables"]}),"\n",(0,n.jsx)(t.h2,{id:"others",children:"Others"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"table-partitioning-postgres",src:i(840266).A+"",width:"999",height:"570"})}),"\n",(0,n.jsx)(t.h2,{id:"links",children:"Links"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"/databases/sql-databases/partitioning-sharding",children:"Partitioning Sharding"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://www.highgo.ca/2020/08/08/partitioning-improvements-in-postgresql-13/",children:"Partitioning Improvements in PostgreSQL 13 - Highgo Software Inc."})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://www.youtube.com/watch?v=YPorP8BsF_c",children:"They Enabled Postgres Partitioning and their Backend fell apart - YouTube"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://fragland.dev/a-guide-to-table-partitioning-with-postgresql-12",children:"Mastering PostgreSQL Table Partitioning"})}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsxs)(t.a,{href:"https://www.youtube.com/watch?v=AfQJgoyv9Fc",children:[(0,n.jsx)(t.strong,{children:"Automatically managing partitioned data on Amazon RDS for PostgreSQL"}),"- AWS Online Tech Talks - YouTube"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"pg_partman"}),"\n",(0,n.jsx)(t.li,{children:"pg_cron"}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://pages.awscloud.com/rs/112-TZM-766/images/2022_1006-DAT_Slide-Deck.pdf",children:"pages.awscloud.com/rs/112-TZM-766/images/2022_1006-DAT_Slide-Deck.pdf"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/PostgreSQL_Partitions.html",children:"Managing PostgreSQL partitions with the pg_partman extension - Amazon Relational Database Service"})}),"\n"]}),"\n"]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},840266:(e,t,i)=>{i.d(t,{A:()=>a});const a=i.p+"assets/images/Pasted image 20230326214011-55f5c5ebd882bb2e6558aca8086fd96d.jpg"},28453:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>o});var a=i(296540);const n={},s=a.createContext(n);function r(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);