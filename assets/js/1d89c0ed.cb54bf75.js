"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[47502],{747443:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var s=t(785893),n=t(511151);const a={},o="Stored Procedure",i={id:"languages/sql/stored-procedure",title:"Stored Procedure",description:"A stored procedure (also termed proc, storp, sproc, StoPro, StoredProc, StoreProc, sp, or SP) is a subroutine available to applications that access a relational database management system(RDBMS). Such procedures are stored in the database data dictionary.",source:"@site/docs/languages/sql/stored-procedure.md",sourceDirName:"languages/sql",slug:"/languages/sql/stored-procedure",permalink:"/languages/sql/stored-procedure",draft:!1,unlisted:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/languages/sql/stored-procedure.md",tags:[],version:"current",lastUpdatedAt:1732812944,formattedLastUpdatedAt:"Nov 28, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"SQL Views",permalink:"/languages/sql/sql-views"},next:{title:"Types",permalink:"/languages/sql/types"}},d={},c=[{value:"Advantages of using stored procedures",id:"advantages-of-using-stored-procedures",level:2},{value:"Types of stored procedures",id:"types-of-stored-procedures",level:2},{value:"Differences",id:"differences",level:2},{value:"Stored Procedures",id:"stored-procedures",level:3},{value:"Functions",id:"functions",level:3},{value:"Access",id:"access",level:2},{value:"Queries",id:"queries",level:2},{value:"Creating a Stored Procedure",id:"creating-a-stored-procedure",level:3},{value:"Calling a Stored Procedure",id:"calling-a-stored-procedure",level:3}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"stored-procedure",children:"Stored Procedure"}),"\n",(0,s.jsxs)(r.p,{children:["A ",(0,s.jsx)(r.strong,{children:"stored procedure"})," (also termed ",(0,s.jsx)(r.strong,{children:"proc, storp, sproc, StoPro, StoredProc, StoreProc, sp, or SP"}),") is a ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Subroutine",children:"subroutine"})," available to applications that access a ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Relational_database_management_system",children:"relational database management system"}),"(RDBMS). Such procedures are stored in the database ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Data_dictionary",children:"data dictionary"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Uses for stored procedures include ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Data_validation",children:"data-validation"}),"(integrated into the database) or ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Access_control",children:"access-control"})," mechanisms. Furthermore, stored procedures can consolidate and centralize logic that was originally implemented in applications. To save time and memory, extensive or complex processing that requires execution of several ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/SQL",children:"SQL"})," statements can be saved into stored procedures, and all applications call the procedures. One can use nested stored procedures by executing one stored procedure from within another."]}),"\n",(0,s.jsxs)(r.p,{children:["Stored procedures may return ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Result_set",children:"result sets"}),", i.e., the results of aSELECTstatement. Such result sets can be processed using ",(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Cursor_(databases)",children:"cursors"}),", by other stored procedures, by associating a result-set locator, or by applications. Stored procedures may also contain declared variables for processing data and cursors that allow it to loop through multiple rows in a table. Stored-procedure flow-control statements typically includeIF,WHILE,LOOP,REPEAT, andCASEstatements, and more. Stored procedures can receive variables, return results or modify variables and return them, depending on how and where the variable is declared."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sql",children:"CREATE PROCEDURE procedure_name\nAS\nsql_statement\nGO;\n\nEXEC procedure_name;\n"})}),"\n",(0,s.jsx)(r.h2,{id:"advantages-of-using-stored-procedures",children:"Advantages of using stored procedures"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"A stored procedure allows modular programming -"})," You can create the procedure once, store it in the database, and call it any number of times in your program."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"A stored procedure allows faster execution -"})," If the operation requires a large amount of SQL code that is performed repetitively, stored procedures can be faster. They are parsed and optimized when they are first executed, and a compiled version of the stored procedure remains in a memory cache for later use. This means the stored procedure does not need to be reparsed and reoptimized with each use, resulting in much faster execution times."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"A stored procedure can reduce network traffic -"})," An operation requiring hundreds of lines of Transact-SQL code can be performed through a single statement that executes the code in a procedure, rather than by sending hundreds of lines of code over the network."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Stored procedures provide better security to your data -"})," Users can be granted permission to execute a stored procedure even if they do not have permission to execute the procedure's statements directly."]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"types-of-stored-procedures",children:"Types of stored procedures"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"System-stored procedures"})," are stored in the master database and these start with asp_prefix. These procedures can be used to perform a variety of tasks to support SQL Server functions for external application calls in the system tables","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Example: sp_helptext [StoredProcedure_Name]"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"User-defined stored procedures"})," are usually stored in a user database and are typically designed to complete the tasks in the user database. While coding these procedures don't use the ",(0,s.jsx)(r.code,{children:"sp_prefix"})," because if we use the ",(0,s.jsx)(r.code,{children:"sp_prefix"})," first, it will check the master database, and then it comes to user defined database."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Extended stored procedures"})," are the procedures that call functions from DLL files. Nowadays, extended stored procedures are deprecated for the reason it would be better to avoid using extended stored procedures."]}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://en.wikipedia.org/wiki/Stored_procedure",children:"https://en.wikipedia.org/wiki/Stored_procedure"})}),"\n",(0,s.jsx)(r.h2,{id:"differences",children:"Differences"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["A ",(0,s.jsx)(r.strong,{children:"stored routine"})," is either a procedure or a function."]}),"\n",(0,s.jsxs)(r.li,{children:["A ",(0,s.jsx)(r.strong,{children:"procedure"})," is invoked using a CALL statement and can only pass back values using output variables."]}),"\n",(0,s.jsxs)(r.li,{children:["A ",(0,s.jsx)(r.strong,{children:"function"})," can be called from inside a statement just like any other function and can return a scalar value."]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"stored-procedures",children:"Stored Procedures"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Procedure can return zero or n values"}),"\n",(0,s.jsx)(r.li,{children:"Procedures can have input/output parameters for it"}),"\n",(0,s.jsx)(r.li,{children:"Procedure allows select as well as DML statement in it"}),"\n",(0,s.jsx)(r.li,{children:"A stored procedure may have arguments that areIN,OUT, orINOUT."}),"\n",(0,s.jsx)(r.li,{children:"A procedure can't be called from DML statements."}),"\n",(0,s.jsx)(r.li,{children:"Procedures are parsed and compiled."}),"\n",(0,s.jsx)(r.li,{children:"Procedures are mainly used to process the tasks."}),"\n",(0,s.jsx)(r.li,{children:"Procedure doesn't return value.procedure can return more than one values using OUT parameter"}),"\n",(0,s.jsx)(r.li,{children:"They are stored in compiled format in the database where as Functions are compiled and executed run time."}),"\n",(0,s.jsx)(r.li,{children:"A procedure is used to execute business logic."}),"\n",(0,s.jsx)(r.li,{children:"Stored procedure returns always integer value by default zero."}),"\n",(0,s.jsx)(r.li,{children:"Stored procedure has the security and reduces the network traffic."}),"\n",(0,s.jsx)(r.li,{children:"It create variable table and but can't return variable table."}),"\n",(0,s.jsx)(r.li,{children:"Print command used."}),"\n",(0,s.jsx)(r.li,{children:"It execute Dynamic SQL."}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"functions",children:"Functions"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"function can return one value which is mandatory"}),"\n",(0,s.jsx)(r.li,{children:"functions can have only input parameters"}),"\n",(0,s.jsx)(r.li,{children:"function allows only select statement in it"}),"\n",(0,s.jsx)(r.li,{children:"Functions may only haveINarguments."}),"\n",(0,s.jsx)(r.li,{children:"DML operations performs in functions."}),"\n",(0,s.jsx)(r.li,{children:"functions always return a single value to the caller."}),"\n",(0,s.jsx)(r.li,{children:"Functions are mainly used to compute values."}),"\n",(0,s.jsx)(r.li,{children:"A function is used to compute a value."}),"\n",(0,s.jsx)(r.li,{children:"It returns type could be scalar or table or table values."}),"\n",(0,s.jsx)(r.li,{children:"It create variable table and can return variable table."}),"\n",(0,s.jsx)(r.li,{children:"Print command cant't use."}),"\n",(0,s.jsx)(r.li,{children:"It can't execute dynamic sql."}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://www.mysqltutorial.org/mysql-error-handling-in-stored-procedures",children:"https://www.mysqltutorial.org/mysql-error-handling-in-stored-procedures"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.a,{href:"https://stackoverflow.com/questions/2680745/whats-the-differences-between-stored-procedures-functions-and-routines",children:"mysql - What's the differences between stored procedures, functions and routines? - Stack Overflow"})}),"\n",(0,s.jsx)(r.h2,{id:"access",children:"Access"}),"\n",(0,s.jsx)(r.p,{children:'ForMySQL 8, connect your database viaWorkbench, go toAdministration -> User and Privileges, and select the user account you want to modify, then switch to "Administrative Roles", tick "SELECT" on right panel (Global Privileges), Click \'Apply\' and done.'}),"\n",(0,s.jsx)(r.h2,{id:"queries",children:"Queries"}),"\n",(0,s.jsx)(r.h3,{id:"creating-a-stored-procedure",children:"Creating a Stored Procedure"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sql",children:"DELIMITER $$\n\nCREATE PROCEDURE DeleteUsersLogInBatches()\nBEGIN\n    DECLARE batch_size INT DEFAULT 100000; -- Number of rows to delete in each batch\n    DECLARE start_id INT DEFAULT 0; -- Starting ID for the first batch\n    DECLARE end_id INT DEFAULT 14900000; -- Target maximum ID for deletion\n\n    -- Loop to delete data in batches\n    WHILE start_id < end_id DO\n        -- Delete rows in the current batch\n        DELETE FROM users_log\n        WHERE id BETWEEN start_id AND start_id + batch_size - 1;\n\n        -- Update the start_id for the next batch\n        SET start_id = start_id + batch_size;\n    END WHILE;\nEND$$\n\nDELIMITER ;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"calling-a-stored-procedure",children:"Calling a Stored Procedure"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-sql",children:"call DeleteUsersLogInBatches();\n\n-- drop stored procedure\ndrop procedure DeleteUsersLogInBatches;\n"})})]})}function u(e={}){const{wrapper:r}={...(0,n.a)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},511151:(e,r,t)=>{t.d(r,{Z:()=>i,a:()=>o});var s=t(667294);const n={},a=s.createContext(n);function o(e){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);