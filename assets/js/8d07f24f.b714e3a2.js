"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[31150],{816938:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"devops/monitoring/prometheus/prometheus-architecture","title":"Prometheus Architecture","description":"Components","source":"@site/docs/devops/monitoring/prometheus/prometheus-architecture.md","sourceDirName":"devops/monitoring/prometheus","slug":"/devops/monitoring/prometheus/prometheus-architecture","permalink":"/devops/monitoring/prometheus/prometheus-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/devops/monitoring/prometheus/prometheus-architecture.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1718831232000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Prometheus","permalink":"/devops/monitoring/prometheus/intro"},"next":{"title":"Querying","permalink":"/devops/monitoring/prometheus/querying"}}');var s=r(474848),i=r(28453);const o={},a="Prometheus Architecture",l={},c=[{value:"Components",id:"components",level:2},{value:"Scaling and Augmenting Prometheus",id:"scaling-and-augmenting-prometheus",level:2},{value:"Metrics Collection Questions",id:"metrics-collection-questions",level:2},{value:"Vertical Sharing and Federation",id:"vertical-sharing-and-federation",level:2},{value:"Vertical Sharing",id:"vertical-sharing",level:3},{value:"Federation",id:"federation",level:3},{value:"CORTEX, THANOS, AND M3",id:"cortex-thanos-and-m3",level:2},{value:"Cortex",id:"cortex",level:3},{value:"Architecture",id:"architecture",level:4},{value:"Thanos",id:"thanos",level:3},{value:"M3",id:"m3",level:3},{value:"Links",id:"links",level:2}];function h(e){const t={a:"a",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"prometheus-architecture",children:"Prometheus Architecture"})}),"\n",(0,s.jsx)(t.h2,{id:"components",children:"Components"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Exporters:"})," Sidecar containers that collect and expose container and service metrics"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Prometheus server"}),": Walks through all the exporters' and other metrics' endpoints collecting (pulling) the data"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"AlertManager"}),": Provides alerting capabilities on top of the metrics server"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Grafana"}),": Dashboarding interface for querying and displaying metrics"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Prometheus metrics"}),": Metric format for Prometheus"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"scaling-and-augmenting-prometheus",children:"Scaling and Augmenting Prometheus"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Simplified metric collection"}),"\n",(0,s.jsx)(t.li,{children:"Events correlation and alerts"}),"\n",(0,s.jsx)(t.li,{children:"Troubleshooting and tracing"}),"\n",(0,s.jsx)(t.li,{children:"Security"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"metrics-collection-questions",children:"Metrics Collection Questions"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"How many metrics can your monitoring system ingest, and how many do you need?"}),"\n",(0,s.jsx)(t.li,{children:"What's your metrics cardinality? Cardinality is the number of labels that each metric can have. This is a common issue with metrics coming from dynamic environments, where containers get a different ID or name every time they start, restart, or are moved between nodes."}),"\n",(0,s.jsx)(t.li,{children:"Do you need high availability?"}),"\n",(0,s.jsx)(t.li,{children:"How long do you need to keep metrics and with what resolution?"}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"vertical-sharing-and-federation",children:"Vertical Sharing and Federation"}),"\n",(0,s.jsx)(t.h3,{id:"vertical-sharing",children:"Vertical Sharing"}),"\n",(0,s.jsx)(t.p,{children:"If a single Prometheus server cannot handle it all, one server per datacenter or availability zone can be run per cluster or even per application. It is not unusual to see Kubernetes with its own Prometheus server for cluster metrics while there is another server for service and application metrics. This way, you can scale down the requirements of each Prometheus server. This is known as vertical sharing."}),"\n",(0,s.jsx)(t.h3,{id:"federation",children:"Federation"}),"\n",(0,s.jsx)(t.p,{children:"Federation is another approach that allows for building a hierarchical tree to aggregate metrics. Some Prometheus servers collect high-resolution metrics (this could be per container metrics) and then the upstream server only stores the aggregated metrics (global service metrics)."}),"\n",(0,s.jsx)(t.h2,{id:"cortex-thanos-and-m3",children:"CORTEX, THANOS, AND M3"}),"\n",(0,s.jsx)(t.p,{children:"To solve some of these limitations, a lot of third-party open-source projects have appeared recently."}),"\n",(0,s.jsx)(t.h3,{id:"cortex",children:"Cortex"}),"\n",(0,s.jsx)(t.p,{children:"Cortex allows for storing time series data in a key-value store like Cassandra, AWS DynamoDB, or Google BigTable. It offers a Prometheus compatible query API, and you can push metrics into a write endpoint. This makes it best suited for cloud environments and multi-tenant scenarios like service providers building hosted and managed platforms."}),"\n",(0,s.jsx)(t.p,{children:"A multitenant, horizontally scalable Prometheus as a Service"}),"\n",(0,s.jsxs)(t.p,{children:["Cortex provides horizontally scalable, highly available, multi-tenant, long term storage for ",(0,s.jsx)(t.a,{href:"https://prometheus.io/",children:"Prometheus"}),"."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Horizontally scalable",":Cortex",' can run across multiple machines in a cluster, exceeding the throughput and storage of a single machine. This enables you to send the metrics from multiple Prometheus servers to a single Cortex cluster and run "globally aggregated" queries across all data in a single place.']}),"\n",(0,s.jsxs)(t.li,{children:["Highly available",":When"," run in a cluster, Cortex can replicate data between machines. This allows you to survive machine failure without gaps in your graphs."]}),"\n",(0,s.jsxs)(t.li,{children:["Multi-tenant",":Cortex"," can isolate data and queries from multiple different independent Prometheus sources in a single cluster, allowing untrusted parties to share the same cluster."]}),"\n",(0,s.jsxs)(t.li,{children:["Long term storage",":Cortex"," supports Amazon DynamoDB, Google Bigtable, Cassandra, S3 and GCS for long term storage of metric data. This allows you to durably store data for longer than the lifetime of any single machine, and use this data for long term capacity planning."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://github.com/cortexproject/cortex",children:"https://github.com/cortexproject/cortex"})}),"\n",(0,s.jsx)(t.h4,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(t.p,{children:"Cortex has a fundamentally service-based design, with its essential functions split up into single-purpose components that can be independently scaled:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Distributor-"})," Handles time series data written to Cortex by Prometheus instances using Prometheus'",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/prometheus/latest/storage/#remote-storage-integrations",children:"remote write API"}),". Incoming data is automatically replicated and sharded, and sent to multiple Cortex ingesters in parallel."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Ingester -"})," Receives time series data from distributor nodes and then writes that data to long-term storage backends, compressing data into Prometheus chunks for efficiency."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Ruler-"})," Executes rules and generates alerts, sending them to ",(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/alerting/alertmanager/",children:"Alertmanager"}),"(Cortex installations include Alertmanager)."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Querier-"})," Handles PromQL queries from clients (including ",(0,s.jsx)(t.a,{href:"https://grafana.com/",children:"Grafana"})," dashboards), abstracting over both ephemeral time series data and samples in long-term storage."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Each of these components can be managed independently, which is key to Cortex's scalability and operations story. You can see a basic diagram of Cortex and the systems it interacts with below:"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"image",src:r(94165).A+"",width:"1000",height:"899"})}),"\n",(0,s.jsx)(t.p,{children:'As the diagram shows, Cortex "completes" the Prometheus Monitoring System. To adapt it to existing Prometheus installations, you just need to re-configure your Prometheus instances to remote write to your Cortex cluster and Cortex handles the rest.'}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://www.cncf.io/blog/2018/12/18/cortex-a-multi-tenant-horizontally-scalable-prometheus-as-a-service",children:"https://www.cncf.io/blog/2018/12/18/cortex-a-multi-tenant-horizontally-scalable-prometheus-as-a-service"})}),"\n",(0,s.jsx)(t.h3,{id:"thanos",children:"Thanos"}),"\n",(0,s.jsx)(t.p,{children:"Thanos stores time series data in an object store like AWS S3, Google Cloud Storage, etc. Thanos pushes metrics through a side-car container from each Prometheus server through the gRPC store API to the query service in order to provide a global query view. The side-car container also pushes immutable data blocks to the object storage. When you need to retrieve data that is on block storage, the store component takes care of that. The compactor component takes care of compaction and downsampling."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"image",src:r(18442).A+"",width:"664",height:"332"})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://thanos.io/",children:"Thanos - Highly available Prometheus setup with long term storage capabilities"})}),"\n",(0,s.jsx)(t.h3,{id:"m3",children:"M3"}),"\n",(0,s.jsx)(t.p,{children:"M3 is an open source, large-scale metrics platform developed by Uber. It has its own time series database, M3DB. Like Thanos, M3 also uses a side-car container to push the metrics to the DB. In addition, it supports metric deduplication and merging, and provides distributed query support."}),"\n",(0,s.jsx)(t.h2,{id:"links",children:"Links"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.a,{href:"https://devopscube.com/prometheus-architecture",children:"Prometheus Architecture: Complete Breakdown Of Key Components"})})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},94165:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/DevOps-Monitoring-Prometheus-Architecture-image1-b0528c909a92f2c622ac15b91905b1c9.jpg"},18442:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/DevOps-Monitoring-Prometheus-Architecture-image2-7dfe6ba4fc1ebcdab905e5dd7e820be7.jpg"},28453:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>a});var n=r(296540);const s={},i=n.createContext(s);function o(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);