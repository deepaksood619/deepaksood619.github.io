"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[30244],{271805:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"data-warehouses/snowflake/data-loading-using-copy-into-from-aws-s3","title":"Data Loading Using COPY INTO from AWS S3","description":"Overview","source":"@site/docs/data-warehouses/snowflake/data-loading-using-copy-into-from-aws-s3.md","sourceDirName":"data-warehouses/snowflake","slug":"/data-warehouses/snowflake/data-loading-using-copy-into-from-aws-s3","permalink":"/data-warehouses/snowflake/data-loading-using-copy-into-from-aws-s3","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/data-warehouses/snowflake/data-loading-using-copy-into-from-aws-s3.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1760616071000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Compute","permalink":"/data-warehouses/snowflake/compute"},"next":{"title":"Documentation","permalink":"/data-warehouses/snowflake/documentation"}}');var i=s(474848),t=s(28453);const l={},r="Data Loading Using COPY INTO from AWS S3",d={},o=[{value:"Overview",id:"overview",level:2},{value:"When to Use COPY INTO",id:"when-to-use-copy-into",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Steps",id:"steps",level:2},{value:"Step 1: Create Warehouse, Database, and Schema",id:"step-1-create-warehouse-database-and-schema",level:3},{value:"Step 2: Create Target Table",id:"step-2-create-target-table",level:3},{value:"Step 3: Configure AWS S3 External Stage",id:"step-3-configure-aws-s3-external-stage",level:3},{value:"Option A: Using AWS Access Key",id:"option-a-using-aws-access-key",level:4},{value:"Option B: Using AWS IAM Role",id:"option-b-using-aws-iam-role",level:4},{value:"Step 4: Define File Format",id:"step-4-define-file-format",level:3},{value:"Step 5: Validate File Visibility",id:"step-5-validate-file-visibility",level:3},{value:"Step 6: Load Data Using COPY INTO",id:"step-6-load-data-using-copy-into",level:3},{value:"Step 7: Verify Successful Load",id:"step-7-verify-successful-load",level:3},{value:"Example: COPY INTO Script",id:"example-copy-into-script",level:2},{value:"1. Select Warehouse, Database &amp; Schema",id:"1-select-warehouse-database--schema",level:3},{value:"2. Create Target Table",id:"2-create-target-table",level:3},{value:"3. Create File Format (CSV with settings)",id:"3-create-file-format-csv-with-settings",level:3},{value:"4. Create STAGE to connect to S3",id:"4-create-stage-to-connect-to-s3",level:3},{value:"5. Validate connectivity by listing files",id:"5-validate-connectivity-by-listing-files",level:3},{value:"6. Load data using COPY INTO",id:"6-load-data-using-copy-into",level:3},{value:"7. Verify load",id:"7-verify-load",level:3}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"data-loading-using-copy-into-from-aws-s3",children:"Data Loading Using COPY INTO from AWS S3"})}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"COPY INTO is a bulk loading command in Snowflake used to load data on demand from external storage like Amazon S3 into Snowflake tables. Unlike Snowpipe (which provides continuous auto-ingestion), COPY INTO is manual or scheduled but gives more control, better error handling, and batch loading performance."}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-copy-into",children:"When to Use COPY INTO"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Use Case"}),(0,i.jsx)(n.th,{children:"Choose COPY INTO"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"One-time or periodic batch loads"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Scheduled ETL/ELT jobs"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Need more control over loading"}),(0,i.jsx)(n.td,{children:"Yes"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Continuous streaming-like ingestion"}),(0,i.jsx)(n.td,{children:"Use Snowpipe instead"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before you start, ensure:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Snowflake account is set up"}),"\n",(0,i.jsx)(n.li,{children:"Warehouse and database exist"}),"\n",(0,i.jsx)(n.li,{children:"IAM role for S3 access configured"}),"\n",(0,i.jsx)(n.li,{children:"Data files prepared (CSV, JSON, Parquet etc.)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-create-warehouse-database-and-schema",children:"Step 1: Create Warehouse, Database, and Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE WAREHOUSE IF NOT EXISTS COPY_WH WAREHOUSE_SIZE = 'XSMALL'\xa0\n\nCREATE DATABASE IF NOT EXISTS COPY_DB;\n\nCREATE SCHEMA IF NOT EXISTS COPY_SCHEMA;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-2-create-target-table",children:"Step 2: Create Target Table"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE TABLE CUSTOMER_DATA (\n\xa0\xa0\xa0\xa0CUSTOMER_ID INT,\n\xa0\xa0\xa0\xa0FIRST_NAME STRING,\n\xa0\xa0\xa0\xa0LAST_NAME STRING,\n\xa0\xa0\xa0\xa0EMAIL STRING,\n\xa0\xa0\xa0\xa0COUNTRY STRING,\n\xa0\xa0\xa0\xa0CREATED_AT TIMESTAMP\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-configure-aws-s3-external-stage",children:"Step 3: Configure AWS S3 External Stage"}),"\n",(0,i.jsx)(n.h4,{id:"option-a-using-aws-access-key",children:"Option A: Using AWS Access Key\xa0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE STAGE CUSTOMER_S3_STAGE\nURL='s3://my-bucket/customer-data/'\nCREDENTIALS = (AWS_KEY_ID='YOUR_AWS_KEY' AWS_SECRET_KEY='YOUR_AWS_SECRET');\n"})}),"\n",(0,i.jsx)(n.h4,{id:"option-b-using-aws-iam-role",children:"Option B: Using AWS IAM Role\xa0"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE STAGE CUSTOMER_S3_STAGE\nURL='s3://my-bucket/customer-data/'\nCREDENTIALS = (AWS_ROLE='arn:aws:iam::123456789012:role/mySnowflakeRole');\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-define-file-format",children:"Step 4: Define File Format"}),"\n",(0,i.jsx)(n.p,{children:"Example for CSV:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FILE FORMAT CSV_FMT\nTYPE = 'CSV'\nFIELD_DELIMITER = ','\nSKIP_HEADER = 1\nNULL_IF = ('NULL', 'null')\nEMPTY_FIELD_AS_NULL = TRUE;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-5-validate-file-visibility",children:"Step 5: Validate File Visibility"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"LIST @CUSTOMER_S3_STAGE;"})}),"\n",(0,i.jsx)(n.h3,{id:"step-6-load-data-using-copy-into",children:"Step 6: Load Data Using COPY INTO"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"COPY INTO CUSTOMER_DATA\nFROM @CUSTOMER_S3_STAGE\nFILE_FORMAT = (FORMAT_NAME = CSV_FMT)\nON_ERROR = 'CONTINUE';\n"})}),"\n",(0,i.jsx)(n.p,{children:"Optional Parameters"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Purpose"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"ON_ERROR"}),(0,i.jsx)(n.td,{children:"Continue or abort on errors"}),(0,i.jsx)(n.td,{children:"ON_ERROR='SKIP_FILE'"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"PATTERN"}),(0,i.jsx)(n.td,{children:"Load only matching filenames"}),(0,i.jsxs)(n.td,{children:["PATTERN='.",(0,i.jsx)(n.em,{children:"2025."}),".csv'"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"FORCE"}),(0,i.jsx)(n.td,{children:"Reload already loaded files"}),(0,i.jsx)(n.td,{children:"FORCE=TRUE"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"step-7-verify-successful-load",children:"Step 7: Verify Successful Load"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT COUNT(*) FROM CUSTOMER_DATA;\n\nSELECT * FROM TABLE(INFORMATION_SCHEMA.LOAD_HISTORY()) ORDER BY LAST_LOAD_TIME DESC;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"example-copy-into-script",children:"Example: COPY INTO Script"}),"\n",(0,i.jsx)(n.h3,{id:"1-select-warehouse-database--schema",children:"1. Select Warehouse, Database & Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"USE WAREHOUSE COPY_WH;\xa0 \xa0 \xa0 \xa0-- Warehouse for running COPY INTO\nUSE DATABASE COPY_DB;\nUSE SCHEMA COPY_SCHEMA;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-create-target-table",children:"2. Create Target Table"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE TABLE CUSTOMER_DATA (\n\xa0\xa0\xa0\xa0CUSTOMER_ID INT,\n\xa0\xa0\xa0\xa0FIRST_NAME STRING,\n\xa0\xa0\xa0\xa0LAST_NAME STRING,\n\xa0\xa0\xa0\xa0EMAIL STRING,\n\xa0\xa0\xa0\xa0COUNTRY STRING,\n\xa0\xa0\xa0\xa0CREATED_AT TIMESTAMP\n);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-create-file-format-csv-with-settings",children:"3. Create File Format (CSV with settings)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE FILE FORMAT CSV_FMT\n\xa0\xa0\xa0\xa0TYPE = 'CSV'\n\xa0\xa0\xa0\xa0FIELD_DELIMITER = ','\n\xa0\xa0\xa0\xa0SKIP_HEADER = 1\n\xa0\xa0\xa0\xa0NULL_IF = ('NULL', 'null', '')\n\xa0\xa0\xa0\xa0EMPTY_FIELD_AS_NULL = TRUE\n\xa0\xa0\xa0\xa0FIELD_OPTIONALLY_ENCLOSED_BY = '\"';\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-create-stage-to-connect-to-s3",children:"4. Create STAGE to connect to S3"}),"\n",(0,i.jsx)(n.p,{children:"Best practice: Use IAM role, not access keys."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE OR REPLACE STAGE CUSTOMER_S3_STAGE\n\xa0\xa0\xa0\xa0URL = 's3://my-bucket/customer-data/'\n\xa0\xa0\xa0\xa0CREDENTIALS = (AWS_ROLE = 'arn:aws:iam::123456789012:role/mySnowflakeRole')\n\xa0\xa0\xa0\xa0FILE_FORMAT = CSV_FMT;\n"})}),"\n",(0,i.jsx)(n.p,{children:"\xa0(Optional: if S3 bucket is in a different region add endpoint)"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"ENDPOINT = 's3.us-west-1.amazonaws.com';"})}),"\n",(0,i.jsx)(n.h3,{id:"5-validate-connectivity-by-listing-files",children:"5. Validate connectivity by listing files"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"LIST @CUSTOMER_S3_STAGE;"})}),"\n",(0,i.jsx)(n.h3,{id:"6-load-data-using-copy-into",children:"6. Load data using COPY INTO"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Duplicate prevention"}),"\n",(0,i.jsx)(n.li,{children:"ON_ERROR handling"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"COPY INTO CUSTOMER_DATA\nFROM @CUSTOMER_S3_STAGE\nFILE_FORMAT = (FORMAT_NAME = CSV_FMT)\nON_ERROR = 'CONTINUE'\xa0 \xa0 \xa0 \xa0 \xa0 \xa0-- Skip bad rows\n"})}),"\n",(0,i.jsx)(n.p,{children:"Prevent loading the same file twice:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"MATCH_BY_COLUMN_NAME = CASE_INSENSITIVE;"})}),"\n",(0,i.jsx)(n.h3,{id:"7-verify-load",children:"7. Verify load"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"SELECT COUNT(*) AS TOTAL_ROWS FROM CUSTOMER_DATA;"})}),"\n",(0,i.jsx)(n.p,{children:"View load history"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"SELECT * FROM TABLE(INFORMATION_SCHEMA.LOAD_HISTORY(\n\xa0\xa0\xa0\xa0TABLE_NAME => 'CUSTOMER_DATA',\n\xa0\xa0\xa0\xa0START_TIME => DATEADD(hour, -24, CURRENT_TIMESTAMP())\n))\nORDER BY LAST_LOAD_TIME DESC;\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var a=s(296540);const i={},t=a.createContext(i);function l(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);