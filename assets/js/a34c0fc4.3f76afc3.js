"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[22485],{481184:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var t=s(785893),i=s(511151);const a={},o="Others",r={id:"languages/sql/others",title:"Others",description:"When should I use a unique constraint instead of a unique index",source:"@site/docs/languages/sql/others.md",sourceDirName:"languages/sql",slug:"/languages/sql/others",permalink:"/languages/sql/others",draft:!1,unlisted:!1,editUrl:"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/languages/sql/others.md",tags:[],version:"current",lastUpdatedAt:1726144090,formattedLastUpdatedAt:"Sep 12, 2024",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Operators / Wildcards",permalink:"/languages/sql/operators-wildcards"},next:{title:"PartiQL",permalink:"/languages/sql/partiql"}},l={},d=[{value:"When should I use a unique constraint instead of a unique index",id:"when-should-i-use-a-unique-constraint-instead-of-a-unique-index",level:2},{value:"Performance",id:"performance",level:2},{value:"single vs multiple row inserts",id:"single-vs-multiple-row-inserts",level:3},{value:"Enable incremental ETL",id:"enable-incremental-etl",level:2},{value:"System Tables",id:"system-tables",level:2},{value:"Others",id:"others-1",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"others",children:"Others"}),"\n",(0,t.jsx)(n.h2,{id:"when-should-i-use-a-unique-constraint-instead-of-a-unique-index",children:"When should I use a unique constraint instead of a unique index"}),"\n",(0,t.jsx)(n.p,{children:"Under the hood a unique constraint is implemented the same way as a unique index - an index is needed to efficiently fulfil the requirement to enforce the constraint. Even if the index is created as a result of a UNIQUE constraint, the query planner can use it like any other index if it sees it as the best way to approach a given query."}),"\n",(0,t.jsx)(n.p,{children:"So for a database that supports both features the choice of which to use will often come down to preferred style and consistency."}),"\n",(0,t.jsx)(n.p,{children:"If you are planning to use the index as an index (i.e. your code may rely on searching/sorting/filtering on that field to be quick) I would explicitly use a unique index (and comment the source) rather than a constraint to make that clear - this way if the uniqueness requirement is changed in a later revision of the application you (or some other coder) will know to make sure a non-unique index is put in place of the unique one (just removing a unique constraint would remove the index completely). Also a specific index can be named in an index hint (i.e. WITH(INDEX(ix_index_name)), which I don't think is the case for the index created behind the scenes for managing uniqueness as you are unlikely to know its name."}),"\n",(0,t.jsx)(n.p,{children:"Likewise if you are only needing to enforce uniqueness as a business rule rather than the field needing to be searched or used for sorting then I'd use the constraint, again to make the intended use more obvious when someone else looks at your table definition."}),"\n",(0,t.jsx)(n.p,{children:"Note that if you use both a unique constraint and a unique index on the same field the database will not be bright enough to see the duplication, so you will end up with two indexes which will consume extra space and slow down row inserts/updates."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://dba.stackexchange.com/questions/144/when-should-i-use-a-unique-constraint-instead-of-a-unique-index",children:"https://dba.stackexchange.com/questions/144/when-should-i-use-a-unique-constraint-instead-of-a-unique-index"})}),"\n",(0,t.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,t.jsx)(n.h3,{id:"single-vs-multiple-row-inserts",children:"single vs multiple row inserts"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"2 rows at a time: 3.5 - 3.5 seconds"}),"\n",(0,t.jsx)(n.li,{children:"5 rows at a time: 2.2 - 2.2 seconds"}),"\n",(0,t.jsx)(n.li,{children:"10 rows at a time: 1.7 - 1.7 seconds"}),"\n",(0,t.jsx)(n.li,{children:"50 rows at a time: 1.17 - 1.18 seconds"}),"\n",(0,t.jsx)(n.li,{children:"100 rows at a time: 1.1 - 1.4 seconds"}),"\n",(0,t.jsx)(n.li,{children:"500 rows at a time: 1.1 - 1.2 seconds"}),"\n",(0,t.jsx)(n.li,{children:"1000 rows at a time: 1.17 - 1.17 seconds"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The time required for inserting a row is determined by the following factors, where the numbers indicate approximate proportions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Connecting: (3)"}),"\n",(0,t.jsx)(n.li,{children:"Sending query to server: (2)"}),"\n",(0,t.jsx)(n.li,{children:"Parsing query: (2)"}),"\n",(0,t.jsx)(n.li,{children:"Inserting row: (1 \xd7 size of row)"}),"\n",(0,t.jsx)(n.li,{children:"Inserting indexes: (1 \xd7 number of indexes)"}),"\n",(0,t.jsx)(n.li,{children:"Closing: (1)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"From this it should be obvious, that sending one large statement will save you an overhead of 7 per insert statement, which in further reading the text also says:"}),"\n",(0,t.jsx)(n.p,{children:"If you are inserting many rows from the same client at the same time, use INSERT statements with multiple VALUES lists to insert several rows at a time. This is considerably faster (many times faster in some cases) than using separate single-row INSERT statements."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/5.7/en/insert-optimization.html",children:"https://dev.mysql.com/doc/refman/5.7/en/insert-optimization.html"})}),"\n",(0,t.jsx)(n.h2,{id:"enable-incremental-etl",children:"Enable incremental ETL"}),"\n",(0,t.jsx)(n.p,{children:"By enabling data engineers to identify new & updated records by accessing simple fields likecreated_timestampandupdated_timestamp. Make sure that both these fields are populated by the database and not the application. You should have a separate datetime or timestamp field if you want to populate it from the application."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://towardsdatascience.com/table-design-best-practices-for-etl-200accee9cc9",children:"https://towardsdatascience.com/table-design-best-practices-for-etl-200accee9cc9"})}),"\n",(0,t.jsx)(n.h2,{id:"system-tables",children:"System Tables"}),"\n",(0,t.jsxs)(n.p,{children:["In SQL Server these are often referred to as system tables and views. They can be found in the master database, which holds\xa0",(0,t.jsx)(n.a,{href:"https://www.helenanderson.co.nz/search-sys-tables/",children:"data about the database"}),". And in the system views within each database for specific information about each database."]}),"\n",(0,t.jsx)(n.p,{children:"In PostgreSQL, a similar collection of tables can be found in the information_schema and PostgreSQL catalog."}),"\n",(0,t.jsx)(n.p,{children:"Examples of system views:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"sys.objects - shows each object, its type and created date"}),"\n",(0,t.jsx)(n.li,{children:"sys.indexes - shows each index and type"}),"\n",(0,t.jsx)(n.li,{children:"information_schema.columns - shows each column, it\u2019s position and datatype"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Examples of catalog objects:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"information_schema.tables - shows each object, its type and created date"}),"\n",(0,t.jsx)(n.li,{children:"pg_index - shows each index and type"}),"\n",(0,t.jsx)(n.li,{children:"information_schema.columns - shows each column, it\u2019s position and datatype."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"select user,host,plugin from mysql.user where plugin like '%native%';\n\nALTER USER '<dbuser>'@'localhost' IDENTIFIED WITH caching_sha2_password BY '<OLD PSWD here>';\n\nCREATE USER '<dbuser>'@'%' IDENTIFIED WITH caching_sha2_password BY '<new_password>';\n"})}),"\n",(0,t.jsx)(n.h2,{id:"others-1",children:"Others"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5",children:"https://towardsdatascience.com/6-sql-tricks-every-data-scientist-should-know-f84be499aea5"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://blog.moertel.com/posts/2024-08-23-sampling-with-sql.html",children:"Sampling with SQL - Tom Moertel\u2019s Blog"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},511151:(e,n,s)=>{s.d(n,{Z:()=>r,a:()=>o});var t=s(667294);const i={},a=t.createContext(i);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);