"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[75920],{104065:(e,a,i)=>{i.r(a),i.d(a,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"devops/terraform/variables","title":"Variables","description":"Defining Variables","source":"@site/docs/devops/terraform/variables.md","sourceDirName":"devops/terraform","slug":"/devops/terraform/variables","permalink":"/devops/terraform/variables","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/devops/terraform/variables.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1705054005000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Others","permalink":"/devops/terraform/others"},"next":{"title":"Economics","permalink":"/economics/"}}');var n=i(474848),r=i(28453);const t={},l="Variables",o={},d=[{value:"Defining Variables",id:"defining-variables",level:2},{value:"Assigning Variables",id:"assigning-variables",level:2},{value:"Command-line flags",id:"command-line-flags",level:2},{value:"From a file",id:"from-a-file",level:2},{value:"From environment variables",id:"from-environment-variables",level:2},{value:"UI Input",id:"ui-input",level:2},{value:"Variable Defaults",id:"variable-defaults",level:2},{value:"Data Types",id:"data-types",level:2},{value:"Lists",id:"lists",level:3},{value:"Maps",id:"maps",level:3},{value:"Assigning Maps",id:"assigning-maps",level:4},{value:"Output Variables",id:"output-variables",level:2}];function c(e){const a={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.header,{children:(0,n.jsx)(a.h1,{id:"variables",children:"Variables"})}),"\n",(0,n.jsx)(a.h2,{id:"defining-variables",children:"Defining Variables"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:(0,n.jsx)(a.strong,{children:"variables.tf"})}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"assigning-variables",children:"Assigning Variables"}),"\n",(0,n.jsx)(a.p,{children:"There are multiple ways to assign variables. Below is also the order in which variable values are chosen. The following is the descending order of precedence in which variables are considered."}),"\n",(0,n.jsx)(a.h2,{id:"command-line-flags",children:"Command-line flags"}),"\n",(0,n.jsx)(a.p,{children:"You can set variables directly on the command-line with the varflag. Any command in Terraform that inspects the configuration accepts this flag, such as apply, plan, and refresh:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:"$ terraform apply -var 'region=us-east-2'"})}),"\n",(0,n.jsx)(a.p,{children:"Once again, setting variables this way will not save them, and they'll have to be input repeatedly as commands are executed."}),"\n",(0,n.jsx)(a.h2,{id:"from-a-file",children:"From a file"}),"\n",(0,n.jsx)(a.p,{children:"To persist variable values, create a file and assign variables within this file. Create a file named terraform.tf vars with the following contents:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:'region = "us-east-2"'})}),"\n",(0,n.jsxs)(a.p,{children:["For all files which match terraform.tfvars or ",(0,n.jsx)(a.code,{children:"*.auto.tfvars"})," present in the current directory, Terraform automatically loads them to populate variables. If the file is named something else, you can use the var-file flag directly to specify a file. These files are the same syntax as Terraform configuration files. And like Terraform configuration files, these files can also be JSON."]}),"\n",(0,n.jsx)(a.p,{children:"We don't recommend saving usernames and password to version control, but you can create a local secret variables file and use-var-file to load it."}),"\n",(0,n.jsx)(a.p,{children:"You can use multiple-var-file arguments in a single command, with some checked in to version control and others not checked in. For example:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:'terraform apply -var-file="secret.tfvars" -var-file="production.tfvars"'})}),"\n",(0,n.jsx)(a.h2,{id:"from-environment-variables",children:"From environment variables"}),"\n",(0,n.jsx)(a.p,{children:"Terraform will read environment variables in the form of TF_VAR_name to find the value for a variable. For example, the TF_VAR_region variable can be set to set the region variable."}),"\n",(0,n.jsx)(a.p,{children:"Note: Environment variables can only populate string-type variables. List and map type variables must be populated via one of the other mechanisms."}),"\n",(0,n.jsx)(a.h2,{id:"ui-input",children:"UI Input"}),"\n",(0,n.jsxs)(a.p,{children:["If you execute ",(0,n.jsx)(a.code,{children:"terraform apply"})," with certain variables unspecified, Terraform will ask you to input their values interactively. These values are not saved, but this provides a convenient workflow when getting started with Terraform. UI input is not recommended for everyday use of Terraform."]}),"\n",(0,n.jsx)(a.h2,{id:"variable-defaults",children:"Variable Defaults"}),"\n",(0,n.jsx)(a.p,{children:"If no value is assigned to a variable via any of these methods and the variable has a default key in its declaration, that value will be used for the variable."}),"\n",(0,n.jsx)(a.h2,{id:"data-types",children:"Data Types"}),"\n",(0,n.jsx)(a.h3,{id:"lists",children:"Lists"}),"\n",(0,n.jsx)(a.p,{children:"Lists are defined either explicitly or implicitly"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:'# implicitly by using brackets [...]\nvariable "cidrs" { default = [] }\n\n# explicitly\nvariable "cidrs" { type = list }\n\n# You can specify lists in a terraform.tfvars file:\ncidrs = [ "10.0.0.0/16", "10.1.0.0/16" ]\n'})}),"\n",(0,n.jsx)(a.h3,{id:"maps",children:"Maps"}),"\n",(0,n.jsx)(a.p,{children:"We've replaced our sensitive strings with variables, but we still are hard-coding AMIs. Unfortunately, AMIs are specific to the region that is in use. One option is to just ask the user to input the proper AMI for the region, but Terraform can do better than that with maps."}),"\n",(0,n.jsx)(a.p,{children:"Maps are a way to create variables that are lookup tables. An example will show this best. Let's extract our AMIs into a map and add support for the us-west-2 region as well:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'variable "amis" {\n  type = "map"\n  default = {\n    "us-east-1" = "ami-b374d5a5"\n    "us-west-2" = "ami-4b32be2b"\n  }\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:"A variable can have a map type assigned explicitly, or it can be implicitly declared as a map by specifying a default value that is a map. The above demonstrates both."}),"\n",(0,n.jsx)(a.p,{children:"Then, replace the aws_instance with the following:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'resource "aws_instance" "example" {\n  ami           = var.amis[var.region]\n  instance_type = "t2.micro"\n}\n'})}),"\n",(0,n.jsxs)(a.p,{children:["The square-bracket index notation used here is an example of how themaptype expression is accessed as a variable, with ",(0,n.jsx)(a.code,{children:"[var.region]"})," referencing the var.amis declaration for dynamic lookup."]}),"\n",(0,n.jsxs)(a.p,{children:["Although it is not used in this example, the map type expression can also use a static value lookup directly with ",(0,n.jsx)(a.code,{children:'var.amis["us-east-1"]'})]}),"\n",(0,n.jsx)(a.h4,{id:"assigning-maps",children:"Assigning Maps"}),"\n",(0,n.jsx)(a.p,{children:"We set defaults above, but maps can also be set using the var and var-file values. For example:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:'$ terraform apply -var \'amis={ us-east-1 = "foo", us-west-2 = "bar" }\''})}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsxs)(a.em,{children:["Note: Even if every key will be assigned as input, the variable must be established as a map by setting its default to ","."]})}),"\n",(0,n.jsx)(a.p,{children:"Here is an example of setting a map's keys from a file. Starting with these variable definitions:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'variable "region" {}\n\nvariable "amis" {\ntype = "map"\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:"You can specify keys in aterraform.tfvarsfile:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'amis = {\n    "us-east-1" = "ami-abc123"\n    "us-west-2" = "ami-def456"\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:"And access them via resource interpolation:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'output "ami" {\n    value = aws_instance.example.ami\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:"Like so:"}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.code,{children:"terraform apply -var region=us-west-2"})}),"\n",(0,n.jsx)(a.h2,{id:"output-variables",children:"Output Variables"}),"\n",(0,n.jsx)(a.p,{children:"Outputs are a way to tell Terraform what data is important. This data is outputted when apply is called, and can be queried using the terraform output command."}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-json",children:'output "ip" {\n    value = aws_eip.ip.public_ip\n}\n'})}),"\n",(0,n.jsx)(a.p,{children:'This defines an output variable named "ip". The name of the variable must conform to Terraform variable naming conventions if it is to be used as an input to other modules. The value field specifies what the value will be, and almost always contains one or more interpolations, since the output data is typically dynamic. In this case, we\'re outputting the public_ip attribute of the elastic IP address.'}),"\n",(0,n.jsx)(a.p,{children:"Multiple output blocks can be defined to specify multiple output variables."})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},28453:(e,a,i)=>{i.d(a,{R:()=>t,x:()=>l});var s=i(296540);const n={},r=s.createContext(n);function t(e){const a=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);