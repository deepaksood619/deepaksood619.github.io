"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[32405],{826416:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"data-warehouses/bigquery/data-masking","title":"Data Masking","description":"Upon inspecting the data available across different tables in BigQuery and the number of users with access to it, the need to mask sensitive information\u2014such as payment details, user information, and vendor contact details\u2014becomes evident. The most direct approach is to set up custom roles in BigQuery and configure specific permissions to control access to different datasets.","source":"@site/docs/data-warehouses/bigquery/data-masking.md","sourceDirName":"data-warehouses/bigquery","slug":"/data-warehouses/bigquery/data-masking","permalink":"/data-warehouses/bigquery/data-masking","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/data-warehouses/bigquery/data-masking.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1749575438000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"BigLake","permalink":"/data-warehouses/bigquery/biglake"},"next":{"title":"Documentation","permalink":"/data-warehouses/bigquery/documentation"}}');var t=i(474848),a=i(28453);const o={},r="Data Masking",l={},c=[{value:"Setting Up Policy Tags",id:"setting-up-policy-tags",level:3},{value:"Creating Taxonomy",id:"creating-taxonomy",level:3},{value:"Masked User and Masking Rules",id:"masked-user-and-masking-rules",level:3},{value:"Links",id:"links",level:2}];function d(e){const s={a:"a",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"data-masking",children:"Data Masking"})}),"\n",(0,t.jsx)(s.p,{children:"Upon inspecting the data available across different tables in BigQuery and the number of users with access to it, the need to mask sensitive information\u2014such as payment details, user information, and vendor contact details\u2014becomes evident. The most direct approach is to set up custom roles in BigQuery and configure specific permissions to control access to different datasets."}),"\n",(0,t.jsx)(s.p,{children:"However, this approach presents a significant issue: instead of restricting access to specific columns, it restricts access to entire tables for certain users. Additionally, there is a more subtle challenge\u2014a trade-off between flexibility and security when managing database access. While time-bound access can be granted to different user groups, the fundamental issue of table-level restrictions still remains."}),"\n",(0,t.jsx)(s.h3,{id:"setting-up-policy-tags",children:"Setting Up Policy Tags"}),"\n",(0,t.jsx)(s.p,{children:"So providing dynamic column level access is the best approach for masking sensitive information. With this approach we don\u2019t have to restrict the access to the entire table, only the columns containing the sensitive information will be masked."}),"\n",(0,t.jsx)(s.p,{children:"This can be done by making use of Policy Tags in BigQuery. In order to manage Policy Tags and setup different masking rules there are certain APIs that needs to be enabled in the BigQuery interface:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.em,{children:"Big Query Data Policy API"})}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.em,{children:"Dataplex Catalog"})," (Google Data Catalog API was used earlier but has been deprecated since February 3,2025)"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Also for a user to setup the taxonomy required to manage the policy tags, the user should have the following permissions:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.em,{children:"Policy Tag Admin"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.em,{children:"BigQuery Admin or Owner"})}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"creating-taxonomy",children:"Creating Taxonomy"}),"\n",(0,t.jsxs)(s.p,{children:["Taxonomy allow us to create and manage policy tags with different masking rules. Some basic guidelines to follow while creating a taxonomy is listed on the following ",(0,t.jsx)(s.a,{href:"https://cloud.google.com/bigquery/docs/best-practices-policy-tags",title:"https://cloud.google.com/bigquery/docs/best-practices-policy-tags",children:"page"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Using the following guidelines we can setup a taxonomy called ",(0,t.jsx)(s.em,{children:"Dealshare Data"}),", with the main generic policy tag node being ",(0,t.jsx)(s.em,{children:"Sensitive."})," Under this main policy tag we can create sub policy tag nodes, such as ",(0,t.jsx)(s.em,{children:"user_id, bank_account_number"})," etc for different columns. It is a good practice to create sub nodes to add another layer of specification. Along with that creating sub policy tags also allow us to apply different masking rules to different tags, i.e. say for payment information you might want to apply SHA256 masking, however for email a simple email masking would work."]}),"\n",(0,t.jsxs)(s.p,{children:["Once the taxonomy has been made one can make use of these policy tags by enabling ",(0,t.jsx)(s.em,{children:"Enforce Access Control"}),". This will complete the process of setting up the taxonomy and now we can add policy tags to different columns by:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Going to the table in the BigQuery console."}),"\n",(0,t.jsxs)(s.li,{children:["Clicking on ",(0,t.jsx)(s.em,{children:"Edit Schema"}),"."]}),"\n",(0,t.jsx)(s.li,{children:"Selecting the column we want to add the tag to."}),"\n",(0,t.jsxs)(s.li,{children:["Clicking on ",(0,t.jsx)(s.em,{children:"Add Policy Tag"})]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Note that BigQuery allow one to add masking rules once a taxonomy has been made."}),"\n",(0,t.jsx)(s.h3,{id:"masked-user-and-masking-rules",children:"Masked User and Masking Rules"}),"\n",(0,t.jsxs)(s.p,{children:["Once a column has been masked, only users with the ",(0,t.jsx)(s.em,{children:"Full Grain Reader"})," permission can view the unmasked data. Users without this permission will receive an ",(0,t.jsx)(s.em,{children:"Access Denied"})," error when attempting to query the data."]}),"\n",(0,t.jsxs)(s.p,{children:["This is where the ",(0,t.jsx)(s.em,{children:"Masked User"})," permission and ",(0,t.jsx)(s.em,{children:"Masking Rules"})," come into play. Instead of displaying an error each time an unauthorized user queries the masked data, a cleaner approach is available. Depending on the masking rules applied through the policy tag, unauthorized users will see either ",(0,t.jsx)(s.em,{children:"hashed values or nulls"})," in place of the original data, rather than encountering an error."]}),"\n",(0,t.jsxs)(s.p,{children:["Users granted the ",(0,t.jsx)(s.em,{children:"Masked User"})," permission can view the hashed data, whereas users without this permission will continue to receive an error message. The ",(0,t.jsx)(s.em,{children:"Masked User"})," role provides a middle ground between granting full access to masked data and completely restricting access with an error."]}),"\n",(0,t.jsx)(s.p,{children:"Following steps need to be followed to add masking rules to different policy tags:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Go to the taxonomy page."}),"\n",(0,t.jsx)(s.li,{children:"Select the main tag or sub tag to which you want to apply the masking rules."}),"\n",(0,t.jsxs)(s.li,{children:["Click on ",(0,t.jsx)(s.em,{children:"Manage Data Policies."})]}),"\n",(0,t.jsx)(s.li,{children:"Select the masking rule from the drop down menu."}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Following steps need to be followed to give ",(0,t.jsx)(s.em,{children:"Masked User"})," permissions:"]}),"\n",(0,t.jsxs)(s.ol,{start:"5",children:["\n",(0,t.jsxs)(s.li,{children:["Grant the ",(0,t.jsx)(s.em,{children:"Masked User"})," permission from the project permission page."]}),"\n",(0,t.jsx)(s.li,{children:"Then follow step until step 3 of creating masking rules."}),"\n",(0,t.jsxs)(s.li,{children:["Add the user email id to whom you want to give the ",(0,t.jsx)(s.em,{children:"Masked User"})," permission in the ",(0,t.jsx)(s.em,{children:"Principals"})," tab."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"This will give the user to view the masked data at project level for the policy tag to which the user was added as principal."}),"\n",(0,t.jsxs)(s.p,{children:["Note: To provide ",(0,t.jsx)(s.em,{children:"Full Grain Reader"})," permission, simply give the user the permission from the project permission page, no further steps are required."]}),"\n",(0,t.jsx)(s.h2,{id:"links",children:"Links"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://cloud.google.com/bigquery/docs/column-data-masking-intro",children:"Introduction to data masking \xa0|\xa0 BigQuery \xa0|\xa0 Google Cloud"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://youtu.be/Ymazg3XI-lk?si=Bgc-E7ioJvKeJakG",title:"https://youtu.be/Ymazg3XI-lk?si=Bgc-E7ioJvKeJakG",children:"Project Level Roles and Permissions"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://youtu.be/eZ2eMMwOd84?si=P9oE9SibybTMbepO",title:"https://youtu.be/eZ2eMMwOd84?si=P9oE9SibybTMbepO",children:"Limiting Access with Dataset Tags"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://youtu.be/-SuzbZpLlro?si=pPvCAXHg4FXNeLRS",title:"https://youtu.be/-SuzbZpLlro?si=pPvCAXHg4FXNeLRS",children:"Column Level Access Control"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://youtu.be/14m05YLj3jE?si=5vg7zs_pe-ej40am",title:"https://youtu.be/14m05YLj3jE?si=5vg7zs_pe-ej40am",children:"Dynamic Data Masking"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://cloud.google.com/bigquery/docs/column-level-security-intro",title:"https://cloud.google.com/bigquery/docs/column-level-security-intro",children:"Documentation for column level access"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,s,i)=>{i.d(s,{R:()=>o,x:()=>r});var n=i(296540);const t={},a=n.createContext(t);function o(e){const s=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function r(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);