"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[59909],{36447:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"python/others/boto-and-boto3/readme","title":"boto & boto3","description":"AWS SDK for python","source":"@site/docs/python/others/boto-and-boto3/readme.md","sourceDirName":"python/others/boto-and-boto3","slug":"/python/others/boto-and-boto3/","permalink":"/python/others/boto-and-boto3/","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/python/others/boto-and-boto3/readme.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1705642844000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Others","permalink":"/python/others/"},"next":{"title":"Slides","permalink":"/python/others/boto-and-boto3/slides"}}');var s=t(474848),i=t(28453);const r={},a="boto & boto3",l={},c=[{value:"Security",id:"security",level:2},{value:"Catching Exceptions",id:"catching-exceptions",level:2},{value:"Client - RDS",id:"client---rds",level:2},{value:"Client S3",id:"client-s3",level:2},{value:"Boto3 Error handling",id:"boto3-error-handling",level:2},{value:"AWS",id:"aws",level:2},{value:"Client",id:"client",level:3},{value:"Resource",id:"resource",level:3},{value:"Session",id:"session",level:3},{value:"Retries",id:"retries",level:2},{value:"References",id:"references",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"boto--boto3",children:"boto & boto3"})}),"\n",(0,s.jsx)(n.p,{children:"AWS SDK for python"}),"\n",(0,s.jsx)(n.h2,{id:"security",children:"Security"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["There should never be a need to put access credentials in your code (it is bad for security). If the code is running on an Amazon EC2 instance, simply assign an IAM Role to the instance. If the code is running on your own computer, use the",(0,s.jsx)(n.a,{href:"http://aws.amazon.com/cli/",children:"AWS Command-Line Interface (CLI)"})," aws configurecommand to store the credentials in a local configuration file."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"catching-exceptions",children:"Catching Exceptions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from botocore.exceptions import ClientError\n\ntry:\n    iam = boto3.client('iam')\n    user = iam.create_user(UserName='fred')\n    print(\"Created user: %s\" % user)\nexcept ClientError as e:\n    if e.response['Error']['Code'] == 'EntityAlreadyExists':\n        print(\"User already exists\")\n    else:\n        print(\"Unexpected error: %s\" % e)\n\n# ['Error']['Code'] e.g. 'EntityAlreadyExists' or 'ValidationError'\n# ['ResponseMetadata']['HTTPStatusCode'] e.g. 400\n# ['ResponseMetadata']['RequestId'] e.g. 'd2b06652-88d7-11e5-99d0-812348583a35'\n# ['Error']['Message'] e.g. \"An error occurred (EntityAlreadyExists) ...\"\n# ['Error']['Type'] e.g. 'Sender'\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/33068055/how-to-handle-errors-with-boto3",children:"https://stackoverflow.com/questions/33068055/how-to-handle-errors-with-boto3"})}),"\n",(0,s.jsx)(n.h2,{id:"client---rds",children:"Client - RDS"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"client = boto3.client('rds')\n\nresponse = client.delete_db_instance(\nDBInstanceIdentifier=db_cluster_identifier,\nSkipFinalSnapshot=True,\n)\n\nresponse = client.delete_db_cluster(\nDBClusterIdentifier=db_cluster_identifier,\nSkipFinalSnapshot=True,\n)\n\nresponse = client.restore_db_cluster_to_point_in_time(\nDBClusterIdentifier=db_cluster_identifier,\nRestoreType='copy-on-write',\nSourceDBClusterIdentifier=source_db_cluster_identifier,\nUseLatestRestorableTime=True,\nVpcSecurityGroupIds=[\n'sg-d1d6adbe',\n'sg-0f708a9e0b68bc732',\n],\nDBClusterParameterGroupName='aurora-analytics-cluster-group',\n)\n\nresponse = client.create_db_instance(\nDBInstanceIdentifier=db_cluster_identifier,\nDBInstanceClass='db.r5.large',\nEngine='aurora-mysql',\nAvailabilityZone='ap-south-1a',\nDBParameterGroupName='aurora-data-analytics-group',\nAutoMinorVersionUpgrade=True,\nPubliclyAccessible=True,\nDBClusterIdentifier=db_cluster_identifier,\n)\n\nresponse = client.add_role_to_db_cluster(\nDBClusterIdentifier=db_cluster_identifier,\nRoleArn='arn:aws:iam::331916247734:role/rds_s3_migration_role',\n)\n\nresponse = client.modify_db_parameter_group(\n    DBParameterGroupName='aurora-prod-db-write-group',\n    Parameters=[\n        {\n            'ParameterName': 'max_execution_time',\n            'ParameterValue': '1500000',\n            'Description': 'string',\n            'Source': 'string',\n            'ApplyType': 'string',\n            'DataType': 'string',\n            'AllowedValues': 'string',\n            'IsModifiable': True|False,\n            'MinimumEngineVersion': 'string',\n            'ApplyMethod': 'immediate'|'pending-reboot',\n            'SupportedEngineModes': [\n                'string',\n            ]\n        },\n    ]\n)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"client-s3",children:"Client S3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import boto3\ns3_client = boto3.client('s3', aws_access_key_id = 'XXX', aws_secret_access_key = 'XXX')\n\nkey = f\"test/{datetime.now().strftime('%Y%m%d')}/{payload['cust_id']}-{datetime.now().strftime('%Y%m%d%H%M%S%f')}.json\"\n\ns3_client.put_object(Body=json.dumps(payload), Bucket='stashfin-migration-data', Key=key)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"upload_file"})," method is handled by the S3 Transfer Manager, this means that it will automatically handle multipart uploads behind the scenes for you, if necessary."]}),"\n",(0,s.jsx)(n.p,{children:"The put_object method maps directly to the low-level S3 API request. It does not handle multipart uploads for you. It will attempt to send the entire body in one request."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def uploadFileTos3Bucket(self,fileName):\n    response ={}\n    try:\n        client = boto3.client('s3',aws_access_key_id=AWS_ACC_KEY,\n                                aws_secret_access_key=AWS_SEC_ACC_KEY,\n                                region_name=\"ap-south-1\")\n\n        date = datetime.now().strftime(\"%Y-%m-%d\")\n\n        response = client.upload_file(fileName, 'stasfin-pinpoint-segmant-bucket', date+'/'+fileName)\n    except ClientError as e:\n        logging.error(e.response['Error']['Message'])\n        return \"error\"\n    else:\n        logging.info(f'response {response}')\n    return response\n\n# fetch json from s3 using boto3 client\nresult = client.get_object(Bucket=BUCKET, Key=FILE_TO_READ)\ntext = result[\"Body\"].read().decode()\nprint(text['Details']) # Use your desired JSON Key for your value\n\n# fetch json from s3 using boto3 resource\ns3 = boto3.resource('s3')\ncontent_object = s3.Object('test', 'sample_json.txt')\nfile_content = content_object.get()['Body'].read().decode('utf-8')\njson_content = json.loads(file_content)\nprint(json_content['Details'])\n\n# download file\nimport boto3\ns3 = boto3.client('s3')\ns3.download_file('BUCKET_NAME', 'OBJECT_NAME', 'FILE_NAME')\n\ndownload_file(Bucket, Key, Filename, ExtraArgs=None, Callback=None, Config=None)\n\n# Download an S3 object to a file.\ns3 = boto3.client('s3')\nwith open('FILE_NAME', 'wb') as f:\ns3.download_fileobj('BUCKET_NAME', 'OBJECT_NAME', f)\n\ndownload_fileobj(Bucket, Key, Fileobj, ExtraArgs=None, Callback=None, Config=None)\n    # Download an object from S3 to a file-like object. The file-like object must be in binary mode. This is a managed transfer which will perform a multipart download in multiple threads if necessary.\n\nhttps://boto3.amazonaws.com/v1/documentation/api/latest/guide/s3-example-download-file.html\n\n# create signed url\nurl = s3_client.generate_presigned_url(\n        ClientMethod=\"get_object\",\n        Params={\"Bucket\": bucket, \"Key\": path},\n        ExpiresIn=settings.REPORT_TTL,\n    )\n"})}),"\n",(0,s.jsx)(n.h2,{id:"boto3-error-handling",children:"Boto3 Error handling"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/error-handling.html",children:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/error-handling.html"})}),"\n",(0,s.jsx)(n.h2,{id:"aws",children:"AWS"}),"\n",(0,s.jsxs)(n.p,{children:["Here's some more detailed information on what",(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/clients.html",children:"Client"}),", ",(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/resources.html",children:"Resource"}),", and",(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/session.html",children:"Session"})," are all about."]}),"\n",(0,s.jsx)(n.h3,{id:"client",children:"Client"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"low-level AWS service access"}),"\n",(0,s.jsx)(n.li,{children:"generated from AWSservicedescription"}),"\n",(0,s.jsx)(n.li,{children:"exposes botocore client to the developer"}),"\n",(0,s.jsx)(n.li,{children:"typically maps 1:1 with the AWS service API"}),"\n",(0,s.jsx)(n.li,{children:"all AWS service operations are supported by clients"}),"\n",(0,s.jsx)(n.li,{children:"snake-cased method names (e.g. ListBuckets API => list_buckets method)"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here's an example of client-level access to an S3 bucket's objects (at most 1000**):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import boto3\n\nclient = boto3.client('s3')\nresponse = client.list_objects_v2(Bucket='mybucket')\n\nfor content in response['Contents']:\n    obj_dict = client.get_object(Bucket='mybucket', Key=content['Key'])\n    print(content['Key'], obj_dict['LastModified'])\n"})}),"\n",(0,s.jsxs)(n.p,{children:["** you would have to use a ",(0,s.jsx)(n.a,{href:"http://boto3.readthedocs.io/en/latest/guide/paginators.html",children:"paginator"}),", or implement your own loop, calling list_objects() repeatedly with a continuation marker if there were more than 1000."]}),"\n",(0,s.jsx)(n.h3,{id:"resource",children:"Resource"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"higher-level, object-oriented API"}),"\n",(0,s.jsx)(n.li,{children:"generated from resource description"}),"\n",(0,s.jsx)(n.li,{children:"uses identifiers and attributes"}),"\n",(0,s.jsx)(n.li,{children:"has actions (operations on resources)"}),"\n",(0,s.jsx)(n.li,{children:"exposes subresources and collections of AWS resources"}),"\n",(0,s.jsx)(n.li,{children:"does not provide 100% API coverage of AWS services"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Here's the equivalent example using resource-level access to an S3 bucket's objects (all):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import boto3\n\ns3 = boto3.resource('s3')\nbucket = s3.Bucket('mybucket')\n\nfor obj in bucket.objects.all():\n    print(obj.key, obj.last_modified)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Note that in this case you do not have to make a second API call to get the objects; they're available to you as a collection on the bucket. These collections of sub-resources are lazily-loaded."}),"\n",(0,s.jsx)(n.p,{children:"You can see that the Resource version of the code is much simpler, more compact, and has more capability (it does pagination for you). The Client version of the code would actually be more complicated than shown above if you wanted to include pagination."}),"\n",(0,s.jsx)(n.h3,{id:"session",children:"Session"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"stores configuration information (primarily credentials and selected region)"}),"\n",(0,s.jsx)(n.li,{children:"allows you to create service clients and resources"}),"\n",(0,s.jsx)(n.li,{children:"boto3 creates a default session for you when needed"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/42809096/difference-in-boto3-between-resource-client-and-session",children:"https://stackoverflow.com/questions/42809096/difference-in-boto3-between-resource-client-and-session"})}),"\n",(0,s.jsx)(n.h2,{id:"retries",children:"Retries"}),"\n",(0,s.jsx)(n.p,{children:"Your AWS client might see calls to AWS services fail due to unexpected issues on the client side. Or calls might fail due to rate limiting from the AWS service you're attempting to call. In either case, these kinds of failures often don't require special handling and the call should be made again, often after a brief waiting period. Boto3 provides many features to assist in retrying client calls to AWS services when these kinds of errors or exceptions are experienced."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html",children:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/retries.html"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/general/latest/gr/api-retries.html",children:"https://docs.aws.amazon.com/general/latest/gr/api-retries.html"})}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/boto/boto3",children:"https://github.com/boto/boto3"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/migrations3.html#creating-the-connection",children:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/migrations3.html#creating-the-connection"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html",children:"https://boto3.amazonaws.com/v1/documentation/api/latest/guide/configuration.html"})}),"\n",(0,s.jsxs)(n.li,{children:["Example for sending email - ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-using-sdk-python.html",children:"https://docs.aws.amazon.com/ses/latest/DeveloperGuide/send-using-sdk-python.html"})]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/rds.html",children:"https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/rds.html"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.youtube.com/watch?v=Cb2czfCV4Dg",children:"https://www.youtube.com/watch?v=Cb2czfCV4Dg"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://medium.com/tysonworks/concurrency-with-boto3-41cfa300aab4",children:"https://medium.com/tysonworks/concurrency-with-boto3-41cfa300aab4"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var o=t(296540);const s={},i=o.createContext(s);function r(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);