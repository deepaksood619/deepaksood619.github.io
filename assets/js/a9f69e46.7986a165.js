"use strict";(self.webpackChunkdeep_notes=self.webpackChunkdeep_notes||[]).push([[76421],{456817:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>c,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"python/others/pymysql","title":"PyMySQL","description":"https://github.com/PyMySQL/PyMySQL","source":"@site/docs/python/others/pymysql.md","sourceDirName":"python/others","slug":"/python/others/pymysql","permalink":"/python/others/pymysql","draft":false,"unlisted":false,"editUrl":"https://github.com/deepaksood619/deepaksood619.github.io/tree/master/docs/python/others/pymysql.md","tags":[],"version":"current","lastUpdatedBy":"Deepak","lastUpdatedAt":1719081324000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Libraries","permalink":"/python/others/libraries"},"next":{"title":"Requests","permalink":"/python/others/requests"}}');var o=s(474848),r=s(28453);const c={},a="PyMySQL",l={},i=[{value:"Connections Object",id:"connections-object",level:2},{value:"Cursors Object",id:"cursors-object",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Connection Pooling",id:"connection-pooling",level:2},{value:"# Singleton Class",id:"-singleton-class",level:2},{value:"DBClass",id:"dbclass",level:2},{value:"Others",id:"others",level:2},{value:"psycopg2",id:"psycopg2",level:2}];function p(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"pymysql",children:"PyMySQL"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://github.com/PyMySQL/PyMySQL",children:"https://github.com/PyMySQL/PyMySQL"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pymysql.readthedocs.io/en/latest",children:"https://pymysql.readthedocs.io/en/latest"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pypi.org/project/PyMySQL",children:"https://pypi.org/project/PyMySQL"})}),"\n",(0,o.jsx)(e.p,{children:"pip install PyMySQL==0.9.3"}),"\n",(0,o.jsx)(e.h2,{id:"connections-object",children:"Connections Object"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pymysql.readthedocs.io/en/latest/modules/connections.html",children:"https://pymysql.readthedocs.io/en/latest/modules/connections.html"})}),"\n",(0,o.jsx)(e.h2,{id:"cursors-object",children:"Cursors Object"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pymysql.readthedocs.io/en/latest/modules/cursors.html",children:"https://pymysql.readthedocs.io/en/latest/modules/cursors.html"})}),"\n",(0,o.jsx)(e.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:" import pymysql.cursors\n\n # Connect to the database\n    connection = pymysql.connect(host='localhost',\n                             user='user',\n                             password='passwd',\n                             db='db',\n                             charset='utf8mb4',\n                             cursorclass=pymysql.cursors.DictCursor)\n\n try:\n    with connection.cursor() as cursor:\n  # Create a new record\n  sql = \"INSERT INTO `users` (`email`, `password`) VALUES (%s, %s)\"\n  cursor.execute(sql, ('webmaster@python.org', 'very-secret'))\n\n  # connection is not autocommit by default. So you must commit to save your changes.\n   connection.commit()\n\n  with connection.cursor() as cursor:\n        # Read a single record\n        sql = \"SELECT `id`, `password` FROM `users` WHERE `email`=%s\"\n        cursor.execute(sql, ('webmaster@python.org',))\n        result = cursor.fetchone()\n        print(result)\n finally:\n    connection.close()\n"})}),"\n",(0,o.jsx)(e.h2,{id:"connection-pooling",children:"Connection Pooling"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pythontic.com/database/mysql/connection%20pooling",children:"https://pythontic.com/database/mysql/connection%20pooling"})}),"\n",(0,o.jsx)(e.h2,{id:"-singleton-class",children:"# Singleton Class"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:' import pymysql.cursors\n import logging\n\n from constants import (\n     AURORA_DB_DBNAME,\n     AURORA_DB_HOST,\n     AURORA_DB_PASSWORD,\n     AURORA_DB_USER,\n     AWS_ACCESS_KEY_ID,\n     AWS_SECRET_ACCESS_KEY,\n     DEBUG,\n )\n\n mysql_conn = None\n\n def getdb():\n     global mysql_conn\n     if not mysql_conn:\n         try:\n             mysql_conn = pymysql.connect(\n                 host=AURORA_DB_HOST,\n                 user=AURORA_DB_USER,\n                 password=AURORA_DB_PASSWORD,\n                 db=AURORA_DB_DBNAME,\n                 charset="utf8mb4",\n                 cursorclass=pymysql.cursors.DictCursor,\n             )\n         except Exception as e:\n             logging.exception(f"Some error in establishing mysql connection.")\n             raise e\n\n     return mysql_conn\n'})}),"\n",(0,o.jsx)(e.h2,{id:"dbclass",children:"DBClass"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-python",children:' import sys\nimport pymysql\nimport logging\n\n class Database:\n\n  def __init__(self, config):\n        self.host = config.db_host\n        self.username = config.db_user\n        self.password = config.db_password\n        self.port = config.db_port\n        self.dbname = config.db_name\n        self.conn = None\n\n  def open_connection(self):\n        """Connect to MySQL Database."""\n        try:\n            if self.conn is None:\n                self.conn = pymysql.connect(self.host,\n                                            user=self.username,\n                                            passwd=self.password,\n                                            db=self.dbname,\n                                            connect_timeout=5)\n        except pymysql.MySQLError as e:\n            logging.error(e)\n            sys.exit()\n        finally:\n            logging.info(\'Connection opened successfully.\')\n\n  def run_query(self, query):\n        """Execute SQL query."""\n        try:\n            self.open_connection()\n            with self.conn.cursor() as cur:\n                if \'SELECT\' in query:\n                    records = []\n                    cur.execute(query)\n                    result = cur.fetchall()\n                    for row in result:\n                        records.append(row)\n                    cur.close()\n                    return records\n                else:\n                    result = cur.execute(query)\n                    self.conn.commit()\n                    affected = f"{cur.rowcount} rows affected."\n                    cur.close()\n                    return affected\n        except pymysql.MySQLError as e:\n            print(e)\n        finally:\n            if self.conn:\n                self.conn.close()\n                self.conn = None\n                logging.info(\'Database connection closed.\')\n\n class PostgresClient:\n     host: str\n     database_name: str\n     table_name: str\n     port: int\n     username: str\n     password: str\n     conn = None\n\n     def __init__(self, host, database_name, port, username,\n                  password):\n         self.host = host\n         self.database_name = database_name\n         self.port = port\n         self.username = username\n         self.password = password\n\n     def connect(self):\n         try:\n             logger.info(f"connecting to {self.host}")\n             self.conn = pg8000.connect(\n                 host=self.host, port=self.port, database=self.database_name,\n                 user=self.username, password=self.password\n             )\n             return True\n         except Exception as e:\n             logger.error(f"Couldn\'t connect to the db {self.host}- {e}")\n\n         return False\n\n     def insert(self, insert_strings: list, record_to_insert: tuple):\n         if not self.conn:\n             logger.error("No able to connect to the database")\n             return None\n         cur = self.conn.cursor()\n         for insert_string in insert_strings:\n             cur.execute(f"{insert_string}", record_to_insert)\n         self.conn.commit()\n         cur.close()\n\n     def close(self):\n         if self.conn:\n             self.conn.close()\n             self.conn = None\n'})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://hackersandslackers.com/python-mysql-pymysql",children:"https://hackersandslackers.com/python-mysql-pymysql"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://medium.com/@vipinc.007/python-a-database-interaction-class-using-pymysql-3338fb90f38c",children:"https://medium.com/@vipinc.007/python-a-database-interaction-class-using-pymysql-3338fb90f38c"})}),"\n",(0,o.jsx)(e.h2,{id:"others",children:"Others"}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pypi.org/project/mysql-connector-python",children:"https://pypi.org/project/mysql-connector-python"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://github.com/long2ice/asyncmy",children:"GitHub - long2ice/asyncmy: A fast asyncio MySQL/MariaDB driver with replication protocol support"})}),"\n",(0,o.jsx)(e.h2,{id:"psycopg2",children:"psycopg2"}),"\n",(0,o.jsx)(e.p,{children:'Psycopg is the most popular PostgreSQL database adapter for the Python programming language. Its main features are the complete implementation of the Python DB API 2.0 specification and the thread safety (several threads can share the same connection). It was designed for heavily multi-threaded applications that create and destroy lots of cursors and make a large number of concurrent "INSERT"s or "UPDATE"s.'}),"\n",(0,o.jsx)(e.p,{children:'Psycopg 2 is mostly implemented in C as a libpq wrapper, resulting in being both efficient and secure. It features client-side and server-side cursors, asynchronous communication and notifications, "COPY TO/COPY FROM" support. Many Python types are supported out-of-the-box and adapted to matching PostgreSQL data types; adaptation can be extended and customized thanks to a flexible objects adaptation system.'}),"\n",(0,o.jsx)(e.p,{children:"Psycopg 2 is both Unicode and Python 3 friendly."}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://pypi.org/project/psycopg2-binary",children:"https://pypi.org/project/psycopg2-binary"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://www.psycopg.org/docs",children:"https://www.psycopg.org/docs"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://www.psycopg.org/docs/usage.html",children:"https://www.psycopg.org/docs/usage.html"})}),"\n",(0,o.jsx)(e.p,{children:(0,o.jsx)(e.a,{href:"https://www.psycopg.org/docs/cursor.html",children:"https://www.psycopg.org/docs/cursor.html"})})]})}function d(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(p,{...n})}):p(n)}},28453:(n,e,s)=>{s.d(e,{R:()=>c,x:()=>a});var t=s(296540);const o={},r=t.createContext(o);function c(n){const e=t.useContext(r);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:c(n.components),t.createElement(r.Provider,{value:e},n.children)}}}]);